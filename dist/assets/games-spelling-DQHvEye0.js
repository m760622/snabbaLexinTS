import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              *//* empty css              */import"./loader-dpivfNje.js";import{s as L,a as k}from"./games-utils-BCKUWDty.js";import{A as i}from"./config-C2usAgi3.js";import{generateEducationalSentence as x}from"./utils-CfsGp8IC.js";import{T as u}from"./tts-BZUKiY6M.js";import{L as M,t as g}from"./i18n-D0OWfz62.js";import{S as D}from"./smart-selector-DkxipquW.js";import{m as T}from"./mistakes-review-DLeHaHPD.js";import"./db-CDJvXXn2.js";import"./toast-manager-B6dAfcdf.js";console.log("spellingGame.ts LOADED - VERSION DEBUG 1234");let r=null,C=0,E=0;function h(t=0){if(typeof dictionaryData>"u"||dictionaryData.length===0){console.log("Data not ready for Spelling. Waiting for dictionaryLoaded event...");const n=()=>{console.log("dictionaryLoaded event received in Spelling Game"),window.removeEventListener("dictionaryLoaded",n),h(0)};window.addEventListener("dictionaryLoaded",n),t<20?setTimeout(()=>{(typeof dictionaryData>"u"||dictionaryData.length===0)&&h(t+1)},500):(console.error("Critical: Data failed to load for Spelling."),typeof L=="function"&&L(g("common.error"),"error"));return}C=0,E=0,H(),I(),B()}function I(){const t=document.getElementById("spellingHint"),n=document.getElementById("spellingExample"),a=document.getElementById("spellingOptions"),l=document.getElementById("spellingFeedback"),o=document.getElementById("nextSpellingBtn"),m=document.getElementById("spHintBtn");if(window.spellingCountdownInterval&&(clearInterval(window.spellingCountdownInterval),window.spellingCountdownInterval=null),!t||!a||!l)return;l.innerHTML="",l.className="sp-feedback",o&&(o.classList.remove("hidden"),o.style.setProperty("display","flex","important"),o.innerHTML='<span data-i18n="games.next">NÃ¤sta</span> âžœ'),m&&m.classList.remove("hidden"),a.innerHTML=`<div class="sp-loading"><div class="sp-loading-spinner"></div><span>${g("common.loading")}</span></div>`;const w=dictionaryData.filter(e=>e&&e[i.COLUMNS.SWEDISH]&&e[i.COLUMNS.ARABIC]&&e[i.COLUMNS.SWEDISH].length>2&&e[i.COLUMNS.SWEDISH].length<15),d=D.select(w,1)[0];if(!d){t.textContent=g("details.noWordFound"),n&&(n.textContent=""),a.innerHTML=`<button class="spelling-option-btn" onclick="loadSpellingQuestion()">${g("learn.tryAgain")}</button>`;return}r=d;const c=d[i.COLUMNS.SWEDISH],v=d[i.COLUMNS.ARABIC];D.markAsSeen(c),t.textContent=v,n&&(n.textContent="");const p=[c];let y=0;for(;p.length<4&&y<100;){const e=dictionaryData[Math.floor(Math.random()*dictionaryData.length)];e&&e[i.COLUMNS.SWEDISH]&&e[i.COLUMNS.SWEDISH]!==c&&!p.includes(e[i.COLUMNS.SWEDISH])&&e[i.COLUMNS.SWEDISH].length>2&&p.push(e[i.COLUMNS.SWEDISH]),y++}p.sort(()=>Math.random()-.5),setTimeout(()=>{a.innerHTML="",p.forEach((e,S)=>{const s=document.createElement("button");s.className="spelling-option-btn",s.textContent=e,s.style.animationDelay=`${S*.1}s`,s.onclick=()=>{typeof soundManager<"u"&&(soundManager!=null&&soundManager.playClick)&&soundManager.playClick(),b(e,c,s)},a.appendChild(s)})},300);const f=document.getElementById("spSpeakHint");f&&(f.onclick=()=>{typeof u<"u"&&u&&u.speak(c,"sv")})}function b(t,n,a){console.log("checkSpellingAnswer CALLED",{selected:t,correct:n});const l=document.getElementById("spellingFeedback"),o=document.getElementById("nextSpellingBtn"),m=document.getElementById("spHintBtn"),w=document.querySelectorAll(".spelling-option-btn");if(!l||!r)return;w.forEach(e=>e.disabled=!0),m&&m.classList.add("hidden");const d=r[i.COLUMNS.ARABIC]||"",c=r[i.COLUMNS.EXAMPLE_SWE]||"",v=r[i.COLUMNS.EXAMPLE_ARB]||"",p=r[i.COLUMNS.DEFINITION]||"",y=r[i.COLUMNS.TYPE]||"ord";let f="";if(typeof x=="function"){const e=x(n,d,c,v,p,y);f+=`<div class="sp-example-sentence">
            <div class="sp-sentence-swe">ðŸ“– ${e.s}</div>
            <div class="sp-sentence-arb calc-text-size">${e.a}</div>
        </div>`}if(t===n){console.log("Correct answer selected - entering success block"),a.classList.add("correct"),C++,E++,H(),T.markAsLearned(n);try{typeof HapticManager<"u"&&HapticManager?HapticManager.trigger("success"):navigator.vibrate&&navigator.vibrate([50,30,50])}catch(e){console.error("Haptic error",e)}try{typeof soundManager<"u"&&(soundManager!=null&&soundManager.playSuccess)&&soundManager.playSuccess()}catch(e){console.error("Sound error",e)}l.innerHTML=f,l.className="sp-feedback success";try{window.TextSizeManager&&window.TextSizeManager.applyRules()}catch(e){console.error("TextSize error",e)}try{typeof k=="function"&&k("spelling",C)}catch(e){console.error("SaveScore error",e)}if(o){o.classList.remove("hidden"),o.style.setProperty("display","flex","important");let e=5;const S=o.innerHTML,s=()=>{e>0&&(o.innerHTML=`<span data-i18n="games.next">NÃ¤sta</span> (${e}s) âžœ`,e--)};s(),window.spellingCountdownInterval&&clearInterval(window.spellingCountdownInterval),window.spellingCountdownInterval=setInterval(()=>{e>0?s():(clearInterval(window.spellingCountdownInterval),o.innerHTML=S,I())},1e3)}}else if(a.classList.add("wrong"),T.addMistake({word:n,translation:d,game:"spelling"}),w.forEach(e=>{e.textContent===n&&setTimeout(()=>e.classList.add("correct"),300)}),l.innerHTML=f,l.className="sp-feedback",E=0,H(),typeof soundManager<"u"&&(soundManager!=null&&soundManager.playError)&&soundManager.playError(),o){o.classList.remove("hidden"),o.style.setProperty("display","flex","important");let e=5;const S=o.innerHTML,s=()=>{e>0&&(o.innerHTML=`<span data-i18n="games.next">NÃ¤sta</span> (${e}s) âžœ`,e--)};s(),window.spellingCountdownInterval&&clearInterval(window.spellingCountdownInterval),window.spellingCountdownInterval=setInterval(()=>{e>0?s():(clearInterval(window.spellingCountdownInterval),o.innerHTML=S,I())},1e3)}typeof u<"u"&&u&&u.speak(n,"sv")}function N(){if(!r)return;const n=r[i.COLUMNS.SWEDISH].charAt(0).toUpperCase();typeof L=="function"&&L(`ðŸ’¡ ${g("games.firstLetter").replace("{0}",n)}`,"info");const a=document.getElementById("spHintBtn");a&&(a.disabled=!0,a.style.opacity="0.5")}function H(){const t=document.getElementById("spellingScore"),n=document.getElementById("spellingStreak");t&&(t.textContent=String(C)),n&&(n.textContent=String(E))}function B(){const t=document.querySelector(".hud-btn");t&&(t.setAttribute("aria-label",g("nav.back")),t.setAttribute("title",g("nav.back"))),M&&M.updateTranslations()}document.addEventListener("DOMContentLoaded",()=>{M&&(M.onLanguageChange(()=>{B()}),B())});window.startSpellingGame=h;window.showSpellingHint=N;window.loadSpellingQuestion=I;
