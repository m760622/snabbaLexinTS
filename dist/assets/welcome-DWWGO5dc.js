var m=Object.defineProperty;var h=(r,t,e)=>t in r?m(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var c=(r,t,e)=>h(r,typeof t!="symbol"?t+"":t,e);import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css                            */import{A as o}from"./config-C2usAgi3.js";import{D as l}from"./db-CDJvXXn2.js";function g(r){return new Worker("/assets/init-db.worker-CxZp3iMg.js",{name:r==null?void 0:r.name})}class I{constructor(){c(this,"tipInterval",null);this.init()}async init(){this.startSplashUI(),setTimeout(()=>{console.warn("[Welcome] Timeout reached (15s). Forcing redirect..."),localStorage.setItem("snabbaLexin_dataReady","true"),localStorage.setItem("snabbaLexin_version",o.DATA_VERSION),this.redirectToApp()},15e3);try{console.log("[Welcome] Initializing DB..."),await l.init();const t=localStorage.getItem("snabbaLexin_dataReady")==="true",e=localStorage.getItem("snabbaLexin_version");if(t&&e===o.DATA_VERSION&&await l.hasCachedData()){console.log("[Welcome] Data valid, redirecting to app..."),this.redirectToApp();return}await this.startWorker()}catch(t){console.error("[Welcome] Init failed:",t),this.updateProgress(0,"Fel vid start / خطأ في البدء")}}redirectToApp(){const e=new URLSearchParams(window.location.search).get("redirect");e&&(e.startsWith("/")||e.startsWith("http"))?window.location.replace(decodeURIComponent(e)):window.location.replace("index.html")}startSplashUI(){console.log("[Welcome] UI started"),this.updateProgress(10,"Ansluter... / جاري الاتصال...");const t=o.LOADING_TIPS,e=document.getElementById("splashTip");e&&(e.textContent=t[0],this.tipInterval&&clearInterval(this.tipInterval),this.tipInterval=setInterval(()=>{e.style.opacity="0",setTimeout(()=>{const a=Math.floor(Math.random()*t.length);e.textContent=t[a],e.style.opacity="1"},500)},o.SPLASH.TIP_ROTATION_INTERVAL))}updateProgress(t,e){const a=document.getElementById("splashProgressBar"),n=document.getElementById("splashPercent"),s=document.getElementById("splashStatus");a&&(a.style.width=`${t}%`),n&&(n.textContent=`${Math.round(t)}%`),s&&e&&(s.textContent=e)}async startWorker(){return new Promise((t,e)=>{const a=new g;a.onmessage=n=>{const{type:s,value:d,status:p,error:i}=n.data;s==="progress"?this.updateProgress(d,p):s==="complete"?(localStorage.setItem("snabbaLexin_dataReady","true"),localStorage.setItem("snabbaLexin_version",o.DATA_VERSION),this.updateProgress(100,"Klar! / تم!"),setTimeout(()=>this.redirectToApp(),500),a.terminate(),t()):s==="error"&&(console.error("[Welcome] Worker error:",i),this.updateProgress(100,"Fel vid data / خطأ في البيانات"),a.terminate(),e(new Error(i)))},a.postMessage({type:"init",url:o.DATA_PATH.root})})}}new I;
