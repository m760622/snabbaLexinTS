import"./modulepreload-polyfill-B5Qt9EMX.js";import"./loader-CKTsN5EW.js";import"./pwa-Bxh5GLjF.js";import"./db-TWgxRddZ.js";import"./utils-B-9iATqE.js";const m={colors:{gridLine:"#2a2a35",block:"#00f3ff",palette:["#00f3ff","#bc13fe","#ff0055","#ffe600"],bomb:"#ff0000",bombText:"#ffffff",ice:"#aaddff",rock:"#555566",ghost:"rgba(255, 255, 255, 0.2)",particles:["#00f3ff","#bc13fe","#ffffff"]},storageKeys:{highScore:"neonBlocks_highScore",gameState:"neonBlocks_state"}},p=[[[1]],[[1,1]],[[1],[1]],[[1,1,1]],[[1],[1],[1]],[[1,1],[1,1]],[[1,1,1],[0,1,0]],[[0,1,0],[1,1,1]],[[1,1,1],[1,0,0]],[[1,1,1],[0,0,1]],[[1,1],[1,0]],[[1,1,1,1]],[[1],[1],[1],[1]],[[1,1,1],[1,1,1]],[[0,1,0],[1,1,1],[0,1,0]],[[1,0,1],[1,1,1]],[[1,1,1],[1,0,1]],[[1,0,0],[1,0,0],[1,1,1]],[[0,0,1],[0,0,1],[1,1,1]],[[1,1,1],[0,1,0],[0,1,0]],[[1,0],[0,1]],[[0,1],[1,0]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]]];class x{constructor(){this.ctx=null,this.enabled=!0}init(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext)),this.ctx.state==="suspended"&&this.ctx.resume()}playTone(t,e,r,h=0,s=.1){if(!this.enabled||!this.ctx)return;const o=this.ctx.createOscillator(),i=this.ctx.createGain();o.type=e,o.frequency.setValueAtTime(t,this.ctx.currentTime+h),i.gain.setValueAtTime(s,this.ctx.currentTime+h),i.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+h+r),o.connect(i),i.connect(this.ctx.destination),o.start(this.ctx.currentTime+h),o.stop(this.ctx.currentTime+h+r)}playPickup(){this.playTone(400,"sine",.1,0,.05)}playPlace(){this.playTone(200,"triangle",.1,0,.1)}playClear(t=1){[1,1.25,1.5,2].forEach((r,h)=>this.playTone(440*r*(1+t*.1),"sine",.4,h*.05,.1)),t>1&&this.playTone(880,"square",.2,.2,.05)}playGameOver(){this.playTone(300,"sawtooth",.5,0,.1),this.playTone(250,"sawtooth",.5,.4,.1),this.playTone(200,"sawtooth",1,.8,.1)}playTick(){this.playTone(800,"square",.05,0,.05)}playIceCrack(){this.playTone(1200,"sawtooth",.1,0,.1)}playRotate(){this.playTone(600,"sine",.1,0,.05)}}class y{constructor(){this.particles=[],this.texts=[],this.shake=0}spawnExplosion(t,e,r,h){for(let s=0;s<r;s++)this.particles.push({x:t,y:e,color:h||m.colors.particles[0],vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4,life:1,decay:.02+Math.random()*.03,size:2+Math.random()*4})}spawnText(t,e,r,h){this.texts.push({x:t,y:e,text:r,color:h,life:1,vy:-1})}triggerShake(t){this.shake=t}update(){this.particles.forEach(t=>{t.x+=t.vx,t.y+=t.vy,t.life-=t.decay,t.size*=.95}),this.particles=this.particles.filter(t=>t.life>0),this.texts.forEach(t=>{t.y+=t.vy,t.life-=.02}),this.texts=this.texts.filter(t=>t.life>0),this.shake>0&&(this.shake*=.9,this.shake<.5&&(this.shake=0))}draw(t){this.particles.forEach(e=>{t.globalAlpha=e.life,t.fillStyle=e.color,t.beginPath(),t.arc(e.x,e.y,e.size,0,Math.PI*2),t.fill()}),this.texts.forEach(e=>{t.globalAlpha=e.life,t.fillStyle=e.color,t.font="bold 20px Inter",t.textAlign="center",t.fillText(e.text,e.x,e.y)}),t.globalAlpha=1}getShake(){return this.shake>0?{x:(Math.random()-.5)*this.shake,y:(Math.random()-.5)*this.shake}:{x:0,y:0}}}class S{constructor(){this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.scoreEl=document.getElementById("score"),this.highScoreEl=document.getElementById("highScore"),this.finalScoreEl=document.getElementById("finalScore"),this.timerContainer=document.getElementById("timerContainer"),this.timerValue=document.getElementById("timerValue"),this.mode="classic",this.grid=Array(9).fill().map(()=>Array(9).fill(null)),this.hand=[null,null,null],this.score=0,this.highScore=0,this.moves=0,this.timeLeft=120,this.timerInterval=null,this.fx=new y,this.sound=new x,this.metrics={scale:1,gridSize:0,cellSize:0,gridX:0,gridY:0,handY:0},this.loadHighScore(),this.resize(),window.addEventListener("resize",()=>this.resize()),this.initInput(),localStorage.getItem(m.storageKeys.gameState)&&(document.getElementById("resumeBtn").style.display="block"),this.loop()}startMode(t){this.mode=t,this.restart(),document.getElementById("mainMenu").classList.remove("active"),this.mode==="time"?(this.timeLeft=120,this.timerContainer.style.display="block",this.startTimer()):this.timerContainer.style.display="none"}showMenu(){document.getElementById("gameOverModal").classList.remove("active"),document.getElementById("mainMenu").classList.add("active"),this.stopTimer()}resume(){this.loadState()&&(document.getElementById("mainMenu").classList.remove("active"),this.mode==="time"&&(this.timerContainer.style.display="block",this.startTimer()))}rotateHand(){this.sound.playRotate();for(let t=0;t<3;t++)if(this.hand[t]){const e=this.hand[t].shape,r=e.length,h=e[0].length,s=Array(h).fill().map(()=>Array(r).fill(0));for(let o=0;o<r;o++)for(let i=0;i<h;i++)s[i][r-1-o]=e[o][i];this.hand[t].shape=s}}startTimer(){this.stopTimer(),this.timerInterval=setInterval(()=>{this.timeLeft--,this.timerValue.textContent=this.timeLeft,this.timeLeft<=10&&this.sound.playTick(),this.timeLeft<=0&&this.endGame()},1e3)}stopTimer(){this.timerInterval&&clearInterval(this.timerInterval)}resize(){const t=document.getElementById("game-container"),e=window.devicePixelRatio||1;this.canvas.width=t.clientWidth*e,this.canvas.height=t.clientHeight*e,this.canvas.style.width=`${t.clientWidth}px`,this.canvas.style.height=`${t.clientHeight}px`,this.ctx.scale(e,e);const r=20,h=t.clientWidth-r*2;this.metrics.cellSize=Math.floor(h/9),this.metrics.gridSize=this.metrics.cellSize*9,this.metrics.gridX=(t.clientWidth-this.metrics.gridSize)/2,this.metrics.gridY=r+(this.mode==="time"?40:0),this.metrics.handY=this.metrics.gridY+this.metrics.gridSize+40}spawnShapes(){for(let t=0;t<3;t++){const e=p[Math.floor(Math.random()*p.length)];let r=m.colors.block;this.mode==="color"&&(r=m.colors.palette[Math.floor(Math.random()*m.colors.palette.length)]),this.hand[t]={shape:e,color:r}}}placeShape(t,e,r){const{shape:h,color:s}=t;let o=0;this.moves++;for(let i=0;i<h.length;i++)for(let l=0;l<h[0].length;l++)if(h[i][l]===1){this.grid[e+i][r+l]={color:s,bomb:null,ice:!1,rock:!1},o++;const a=this.metrics.gridX+(r+l)*this.metrics.cellSize+this.metrics.cellSize/2,g=this.metrics.gridY+(e+i)*this.metrics.cellSize+this.metrics.cellSize/2;this.fx.spawnExplosion(a,g,3,s)}this.addScore(o*10),this.sound.playPlace(),this.fx.triggerShake(2),this.mode==="bomb"&&this.moves%5===0&&this.spawnBomb(),this.moves%15===0&&this.spawnIce(),this.moves%30===0&&this.spawnRock(),this.mode==="bomb"&&this.updateBombs()}spawnBomb(){let t=this.getFilledCells().filter(e=>!e.cell.bomb&&!e.cell.rock&&!e.cell.ice);if(t.length>0){const e=t[Math.floor(Math.random()*t.length)];e.cell.bomb=9,this.sound.playTick()}}spawnIce(){let t=this.getFilledCells().filter(e=>!e.cell.bomb&&!e.cell.rock&&!e.cell.ice);if(t.length>0){const e=t[Math.floor(Math.random()*t.length)];e.cell.ice=!0}}spawnRock(){let t=this.getEmptyCells();if(t.length>0){const e=t[Math.floor(Math.random()*t.length)];this.grid[e.r][e.c]={color:m.colors.rock,rock:!0},this.fx.spawnExplosion(this.metrics.gridX+e.c*this.metrics.cellSize+this.metrics.cellSize/2,this.metrics.gridY+e.r*this.metrics.cellSize+this.metrics.cellSize/2,5,m.colors.rock)}}getFilledCells(){let t=[];for(let e=0;e<9;e++)for(let r=0;r<9;r++)this.grid[e][r]&&t.push({r:e,c:r,cell:this.grid[e][r]});return t}getEmptyCells(){let t=[];for(let e=0;e<9;e++)for(let r=0;r<9;r++)this.grid[e][r]||t.push({r:e,c:r});return t}updateBombs(){for(let t=0;t<9;t++)for(let e=0;e<9;e++)if(this.grid[t][e]&&this.grid[t][e].bomb!==null&&(this.grid[t][e].bomb--,this.grid[t][e].bomb<=0)){this.endGame();return}}checkClear(){let t=[],e=[],r=[];for(let s=0;s<9;s++)this.grid[s].every(o=>o!==null)&&t.push(s);for(let s=0;s<9;s++){let o=!0;for(let i=0;i<9;i++)this.grid[i][s]||(o=!1);o&&e.push(s)}for(let s=0;s<3;s++)for(let o=0;o<3;o++){let i=!0;for(let l=0;l<3;l++)for(let a=0;a<3;a++)this.grid[s*3+l][o*3+a]||(i=!1);i&&r.push({r:s,c:o})}const h=t.length+e.length+r.length;if(h>0){this.sound.playClear(h),this.fx.triggerShake(h*4),this.mode==="time"&&(this.timeLeft+=h*5,this.timerValue.textContent=this.timeLeft,this.fx.spawnText(this.metrics.gridX+this.metrics.gridSize/2,this.metrics.gridY,`+${h*5}s`,"#0f0"));let s=1,o=new Set;const i=(d,n)=>o.add(`${d},${n}`);t.forEach(d=>{this.mode==="color"&&this.grid[d].every(n=>n.color===this.grid[d][0].color)&&(s+=2);for(let n=0;n<9;n++)i(d,n)}),e.forEach(d=>{let n=[];for(let c=0;c<9;c++)n.push(this.grid[c][d]);this.mode==="color"&&n.every(c=>c.color===n[0].color)&&(s+=2);for(let c=0;c<9;c++)i(c,d)}),r.forEach(d=>{let n=[];for(let c=0;c<3;c++)for(let f=0;f<3;f++)n.push(this.grid[d.r*3+c][d.c*3+f]);this.mode==="color"&&n.every(c=>c.color===n[0].color)&&(s+=2);for(let c=0;c<3;c++)for(let f=0;f<3;f++)i(d.r*3+c,d.c*3+f)}),o.forEach(d=>{const[n,c]=d.split(",").map(Number),f=this.grid[n][c];f.rock||(f.ice?(f.ice=!1,this.sound.playIceCrack(),this.fx.spawnExplosion(this.metrics.gridX+c*this.metrics.cellSize+this.metrics.cellSize/2,this.metrics.gridY+n*this.metrics.cellSize+this.metrics.cellSize/2,5,m.colors.ice)):(this.spawnClearFX(n,c,f.color),this.grid[n][c]=null))});const l=h*100*s;this.addScore(l);const a=this.metrics.gridX+this.metrics.gridSize/2,g=this.metrics.gridY+this.metrics.gridSize/2;this.fx.spawnText(a,g,`+${l}`,"#fff"),s>1&&this.fx.spawnText(a,g-30,"COLOR MATCH!",m.colors.palette[3])}}spawnClearFX(t,e,r){const h=this.metrics.gridX+e*this.metrics.cellSize+this.metrics.cellSize/2,s=this.metrics.gridY+t*this.metrics.cellSize+this.metrics.cellSize/2;this.fx.spawnExplosion(h,s,5,r)}initInput(){const t=()=>{this.sound.init(),window.removeEventListener("touchstart",t),window.removeEventListener("mousedown",t)};window.addEventListener("touchstart",t),window.addEventListener("mousedown",t),this.isDragging=!1;const e=o=>{const i=this.canvas.getBoundingClientRect(),l=o.touches?o.touches[0]:o;return{x:l.clientX-i.left,y:l.clientY-i.top}},r=o=>{if(document.querySelector(".modal-overlay.active")&&!document.getElementById("mainMenu").classList.contains("active")||document.getElementById("mainMenu").classList.contains("active"))return;const i=e(o);if(i.y>this.metrics.handY){const l=this.canvas.width/3/(window.devicePixelRatio||1),a=Math.floor(i.x/l);a>=0&&a<3&&this.hand[a]&&(this.isDragging=!0,this.dragIdx=a,this.dragPos=i,this.dragOffset={x:0,y:-50},this.sound.playPickup())}},h=o=>{this.isDragging&&(this.dragPos=e(o))},s=()=>{if(!this.isDragging)return;const o=this.hand[this.dragIdx],i=this.getGridPos(this.dragPos.x+this.dragOffset.x,this.dragPos.y+this.dragOffset.y,o.shape);i&&this.canPlace(o.shape,i.r,i.c)&&(this.placeShape(o,i.r,i.c),this.hand[this.dragIdx]=null,this.checkClear(),this.saveState(),this.hand.every(l=>l===null)&&(this.spawnShapes(),this.saveState()),this.checkGameOver()&&this.endGame()),this.isDragging=!1,this.dragIdx=-1};this.canvas.addEventListener("mousedown",r),window.addEventListener("mousemove",h),window.addEventListener("mouseup",s),this.canvas.addEventListener("touchstart",o=>{o.preventDefault(),r(o)},{passive:!1}),this.canvas.addEventListener("touchmove",o=>{o.preventDefault(),h(o)},{passive:!1}),this.canvas.addEventListener("touchend",s)}getGridPos(t,e,r){const h=r[0].length*this.metrics.cellSize,s=r.length*this.metrics.cellSize,o=t-this.metrics.gridX-h/2+this.metrics.cellSize/2,i=e-this.metrics.gridY-s/2+this.metrics.cellSize/2;return{r:Math.round(i/this.metrics.cellSize),c:Math.round(o/this.metrics.cellSize)}}canPlace(t,e,r){for(let h=0;h<t.length;h++)for(let s=0;s<t[0].length;s++)if(t[h][s]&&(e+h<0||e+h>=9||r+s<0||r+s>=9||this.grid[e+h][r+s]))return!1;return!0}checkGameOver(){for(let t=0;t<3;t++)if(this.hand[t]){for(let e=0;e<9;e++)for(let r=0;r<9;r++)if(this.canPlace(this.hand[t].shape,e,r))return!1}return!0}endGame(){this.stopTimer(),this.finalScoreEl.textContent=this.score,this.score>=this.highScore&&this.score>0?document.getElementById("newHighScoreLabel").style.display="block":document.getElementById("newHighScoreLabel").style.display="none",document.getElementById("gameOverModal").classList.add("active"),this.sound.playGameOver(),localStorage.removeItem(m.storageKeys.gameState)}restart(){this.grid=Array(9).fill().map(()=>Array(9).fill(null)),this.score=0,this.moves=0,this.scoreEl.textContent="0",document.getElementById("gameOverModal").classList.remove("active"),this.spawnShapes(),this.saveState()}addScore(t){this.score+=t,this.scoreEl.textContent=this.score,this.score>this.highScore&&(this.highScore=this.score,this.highScoreEl.textContent=this.highScore,localStorage.setItem(m.storageKeys.highScore,this.highScore))}saveState(){if(this.timeLeft<=0)return;const t={grid:this.grid,hand:this.hand,score:this.score,mode:this.mode,timeLeft:this.timeLeft};localStorage.setItem(m.storageKeys.gameState,JSON.stringify(t))}loadState(){const t=localStorage.getItem(m.storageKeys.gameState);if(t)try{const e=JSON.parse(t);return this.grid=e.grid,this.hand=e.hand,this.score=e.score,this.mode=e.mode||"classic",this.timeLeft=e.timeLeft||120,this.scoreEl.textContent=this.score,!0}catch(e){return console.error(e),!1}return!1}loadHighScore(){const t=localStorage.getItem(m.storageKeys.highScore);t&&(this.highScore=parseInt(t),this.highScoreEl.textContent=this.highScore)}loop(){this.fx.update(),this.draw(),requestAnimationFrame(()=>this.loop())}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const t=this.fx.getShake();this.ctx.save(),this.ctx.translate(t.x,t.y);const{gridX:e,gridY:r,gridSize:h,cellSize:s}=this.metrics;this.ctx.strokeStyle=m.colors.gridLine,this.ctx.lineWidth=1;for(let i=0;i<=9;i++)this.ctx.beginPath(),this.ctx.moveTo(e+i*s,r),this.ctx.lineTo(e+i*s,r+h),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e,r+i*s),this.ctx.lineTo(e+h,r+i*s),this.ctx.stroke();this.ctx.lineWidth=3,this.ctx.strokeStyle="#3a3a4a";for(let i=0;i<=3;i++)this.ctx.beginPath(),this.ctx.moveTo(e+i*s*3,r),this.ctx.lineTo(e+i*s*3,r+h),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e,r+i*s*3),this.ctx.lineTo(e+h,r+i*s*3),this.ctx.stroke();for(let i=0;i<9;i++)for(let l=0;l<9;l++)if(this.grid[i][l]){const a=this.grid[i][l];this.drawBlock(e+l*s,r+i*s,s,a.color,!1,a.ice,a.rock),a.bomb&&(this.ctx.fillStyle=m.colors.bombText,this.ctx.font="bold 20px Inter",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(a.bomb,e+l*s+s/2,r+i*s+s/2),this.ctx.strokeStyle=m.colors.bomb,this.ctx.lineWidth=2,this.ctx.strokeRect(e+l*s+2,r+i*s+2,s-4,s-4))}const o=this.canvas.width/3/(window.devicePixelRatio||1);for(let i=0;i<3;i++)if(this.hand[i]&&i!==this.dragIdx){const{shape:l,color:a}=this.hand[i],g=l[0].length*(s*.6);l.length*(s*.6),this.drawShape(l,i*o+(o-g)/2,this.metrics.handY,s*.6,a)}if(this.isDragging&&this.dragIdx!==-1){const{shape:i,color:l}=this.hand[this.dragIdx],a=this.dragPos.x+this.dragOffset.x,g=this.dragPos.y+this.dragOffset.y,d=this.getGridPos(a,g,i);d&&this.canPlace(i,d.r,d.c)&&this.drawShape(i,e+d.c*s,r+d.r*s,s,m.colors.ghost);const n=i[0].length*s,c=i.length*s;this.drawShape(i,a-n/2+s/2,g-c/2+s/2,s,l,!0)}this.fx.draw(this.ctx),this.ctx.restore()}drawShape(t,e,r,h,s,o){for(let i=0;i<t.length;i++)for(let l=0;l<t[0].length;l++)t[i][l]&&this.drawBlock(e+l*h,r+i*h,h,s,o)}drawBlock(t,e,r,h,s,o,i){this.ctx.fillStyle=h,s&&(this.ctx.shadowColor=h,this.ctx.shadowBlur=15),this.ctx.fillRect(t+2,e+2,r-2*2,r-2*2),o&&(this.ctx.fillStyle="rgba(255, 255, 255, 0.4)",this.ctx.fillRect(t+2,e+2,r-2*2,r-2*2),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=2,this.ctx.strokeRect(t+2+2,e+2+2,r-2*2-4,r-2*2-4)),i&&(this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(t+2,e+2,r-2*2,r-2*2),this.ctx.fillStyle="#333",this.ctx.beginPath(),this.ctx.arc(t+r/2,e+r/2,r/4,0,Math.PI*2),this.ctx.fill()),this.ctx.shadowBlur=0}}window.onload=()=>{new S};localStorage.getItem("mobileView")==="true"&&(document.body.classList.add("iphone-view"),document.addEventListener("DOMContentLoaded",()=>{const u=document.getElementById("mobileToggle");u&&u.classList.add("active")}));
