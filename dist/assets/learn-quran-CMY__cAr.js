var L=Object.defineProperty;var T=(g,t,e)=>t in g?L(g,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[t]=e;var c=(g,t,e)=>T(g,typeof t!="symbol"?t+"":t,e);import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import{q as u}from"./quranData-CkCN_2Mi.js";import{ThemeManager as S,MobileViewManager as M,TextSizeManager as m,showToast as C}from"./utils-CfsGp8IC.js";import{T as x}from"./tts-BZUKiY6M.js";import{F as p,Q as v}from"./quiz-stats-BL77K9JB.js";import{t as w}from"./i18n-D0OWfz62.js";import{c as q}from"./LearnViewManager-RsT_Dh_9.js";import"./toast-manager-B6dAfcdf.js";class z{constructor(){c(this,"userData",{xp:0,streak:0,srs:{},favorites:[],theme:"emerald"});c(this,"viewManager");c(this,"currentMode","browse");c(this,"fcIndex",0);c(this,"fcFlipped",!1);c(this,"fcDirection","sv-ar");c(this,"filteredData",[...u]);c(this,"quizScore",0);c(this,"quizStreak",0);c(this,"currentQuizItem",null);c(this,"quizDirection","sv-ar");c(this,"mediaRecorder",null);c(this,"audioChunks",[]);c(this,"surahMap",{Ø§Ù„ÙØ§ØªØ­Ø©:"001",Ø§Ù„Ø¨Ù‚Ø±Ø©:"002","Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†":"003",Ø§Ù„Ù†Ø³Ø§Ø¡:"004",Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©:"005",Ø§Ù„Ø£Ù†Ø¹Ø§Ù…:"006",Ø§Ù„Ø£Ø¹Ø±Ø§Ù:"007",Ø§Ù„Ø£Ù†ÙØ§Ù„:"008",Ø§Ù„ØªÙˆØ¨Ø©:"009",ÙŠÙˆÙ†Ø³:"010",Ù‡ÙˆØ¯:"011",ÙŠÙˆØ³Ù:"012",Ø§Ù„Ø±Ø¹Ø¯:"013",Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…:"014",Ø§Ù„Ø­Ø¬Ø±:"015",Ø§Ù„Ù†Ø­Ù„:"016",Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡:"017",Ø§Ù„ÙƒÙ‡Ù:"018",Ù…Ø±ÙŠÙ…:"019",Ø·Ù‡:"020",Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡:"021",Ø§Ù„Ø­Ø¬:"022",Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†:"023",Ø§Ù„Ù†ÙˆØ±:"024",Ø§Ù„ÙØ±Ù‚Ø§Ù†:"025",Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡:"026",Ø§Ù„Ù†Ù…Ù„:"027",Ø§Ù„Ù‚ØµØµ:"028",Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª:"029",Ø§Ù„Ø±ÙˆÙ…:"030",Ù„Ù‚Ù…Ø§Ù†:"031",Ø§Ù„Ø³Ø¬Ø¯Ø©:"032",Ø§Ù„Ø£Ø­Ø²Ø§Ø¨:"033",Ø³Ø¨Ø£:"034",ÙØ§Ø·Ø±:"035",ÙŠØ³:"036",Ø§Ù„ØµØ§ÙØ§Øª:"037",Øµ:"038",Ø§Ù„Ø²Ù…Ø±:"039",ØºØ§ÙØ±:"040",ÙØµÙ„Øª:"041",Ø§Ù„Ø´ÙˆØ±Ù‰:"042",Ø§Ù„Ø²Ø®Ø±Ù:"043",Ø§Ù„Ø¯Ø®Ø§Ù†:"044",Ø§Ù„Ø¬Ø§Ø«ÙŠØ©:"045",Ø§Ù„Ø£Ø­Ù‚Ø§Ù:"046",Ù…Ø­Ù…Ø¯:"047",Ø§Ù„ÙØªØ­:"048",Ø§Ù„Ø­Ø¬Ø±Ø§Øª:"049",Ù‚:"050",Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª:"051",Ø§Ù„Ø·ÙˆØ±:"052",Ø§Ù„Ù†Ø¬Ù…:"053",Ø§Ù„Ù‚Ù…Ø±:"054",Ø§Ù„Ø±Ø­Ù…Ù†:"055",Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©:"056",Ø§Ù„Ø­Ø¯ÙŠØ¯:"057",Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©:"058",Ø§Ù„Ø­Ø´Ø±:"059",Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©:"060",Ø§Ù„ØµÙ:"061",Ø§Ù„Ø¬Ù…Ø¹Ø©:"062",Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†:"063",Ø§Ù„ØªØºØ§Ø¨Ù†:"064",Ø§Ù„Ø·Ù„Ø§Ù‚:"065",Ø§Ù„ØªØ­Ø±ÙŠÙ…:"066",Ø§Ù„Ù…Ù„Ùƒ:"067",Ø§Ù„Ù‚Ù„Ù…:"068",Ø§Ù„Ø­Ø§Ù‚Ø©:"069",Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬:"070",Ù†ÙˆØ­:"071",Ø§Ù„Ø¬Ù†:"072",Ø§Ù„Ù…Ø²Ù…Ù„:"073",Ø§Ù„Ù…Ø¯Ø«Ø±:"074",Ø§Ù„Ù‚ÙŠØ§Ù…Ø©:"075",Ø§Ù„Ø¥Ù†Ø³Ø§Ù†:"076",Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª:"077",Ø§Ù„Ù†Ø¨Ø£:"078",Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª:"079",Ø¹Ø¨Ø³:"080",Ø§Ù„ØªÙƒÙˆÙŠØ±:"081",Ø§Ù„Ø¥Ù†ÙØ·Ø§Ø±:"082",Ø§Ù„Ù…Ø·ÙÙÙŠÙ†:"083",Ø§Ù„Ø¥Ù†Ø´Ù‚Ø§Ù‚:"084",Ø§Ù„Ø¨Ø±ÙˆØ¬:"085",Ø§Ù„Ø·Ø§Ø±Ù‚:"086",Ø§Ù„Ø£Ø¹Ù„Ù‰:"087",Ø§Ù„ØºØ§Ø´ÙŠØ©:"088",Ø§Ù„ÙØ¬Ø±:"089",Ø§Ù„Ø¨Ù„Ø¯:"090",Ø§Ù„Ø´Ù…Ø³:"091",Ø§Ù„Ù„ÙŠÙ„:"092",Ø§Ù„Ø¶Ø­Ù‰:"093",Ø§Ù„Ø´Ø±Ø­:"094",Ø§Ù„ØªÙŠÙ†:"095",Ø§Ù„Ø¹Ù„Ù‚:"096",Ø§Ù„Ù‚Ø¯Ø±:"097",Ø§Ù„Ø¨ÙŠÙ†Ø©:"098",Ø§Ù„Ø²Ù„Ø²Ù„Ø©:"099",Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª:"100",Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©:"101",Ø§Ù„ØªÙƒØ§Ø«Ø±:"102",Ø§Ù„Ø¹ØµØ±:"103",Ø§Ù„Ù‡Ù…Ø²Ø©:"104",Ø§Ù„ÙÙŠÙ„:"105",Ù‚Ø±ÙŠØ´:"106",Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†:"107",Ø§Ù„ÙƒÙˆØ«Ø±:"108",Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†:"109",Ø§Ù„Ù†ØµØ±:"110",Ø§Ù„Ù…Ø³Ø¯:"111",Ø§Ù„Ø¥Ø®Ù„Ø§Øµ:"112",Ø§Ù„ÙÙ„Ù‚:"113",Ø§Ù„Ù†Ø§Ø³:"114"});c(this,"ITEMS_PER_BATCH",20);c(this,"currentBatchIndex",0);c(this,"loadMoreObserver",null);c(this,"currentItems",[]);c(this,"icons",{play:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-sm"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>',pause:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-sm"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>',mic:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-sm"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>',info:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-sm"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>',volume:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-sm"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>',share:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-sm"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>',heart:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-sm"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>'});c(this,"fillQuizQuestions",[]);c(this,"fillCurrentIndex",0);c(this,"fillScore",0);c(this,"fillTotalQuestions",10);c(this,"fillAutoAdvanceTimer",null);this.viewManager=q(),this.loadProgress(),this.init()}loadProgress(){const t=localStorage.getItem("quranUserProgress");if(t)try{this.userData={...this.userData,...JSON.parse(t)},this.userData.favorites||(this.userData.favorites=[])}catch(e){console.error("Failed to parse quran progress",e)}}saveProgress(){localStorage.setItem("quranUserProgress",JSON.stringify(this.userData)),this.updateXPDisplay()}init(){this.setupDOM(),this.initFilters(),this.initViewManager(),this.initFlashcards(),this.initQuiz(),S.setColorTheme(this.userData.theme,!1),this.updateXPDisplay(),this.switchMode("browse"),this.renderCards(u),window.switchMode=this.switchMode.bind(this),window.openInfoModal=this.openInfoModal.bind(this),window.closeInfoModal=this.closeInfoModal.bind(this),window.toggleFavorite=this.toggleFavorite.bind(this),window.playTTS=this.playTTS.bind(this),window.shareCard=this.shareCard.bind(this),window.startRecording=this.startRecording.bind(this),window.stopRecording=this.stopRecording.bind(this),window.showRelatedList=this.showRelatedList.bind(this),window.renderCards=()=>this.renderCards(u)}initViewManager(){this.viewManager.registerViews({browse:{viewId:"browseView",onActivate:()=>{var t;this.renderCards(this.filteredData),(t=document.getElementById("filterBar"))==null||t.classList.remove("hidden")}},flashcard:{viewId:"flashcardView",onActivate:()=>{var t;this.loadFlashcard(this.fcIndex),(t=document.getElementById("filterBar"))==null||t.classList.remove("hidden")}},quiz:{viewId:"quizView",onActivate:()=>{var t;this.nextQuizQuestion(),(t=document.getElementById("filterBar"))==null||t.classList.add("hidden")}},"quiz-fill":{viewId:"quizFillView",onActivate:()=>{var t;this.initFillQuiz(),(t=document.getElementById("filterBar"))==null||t.classList.add("hidden")}}})}setupDOM(){const t=document.getElementById("settingsBtn"),e=document.getElementById("settingsModal"),n=document.getElementById("closeSettingsBtn"),i=document.getElementById("themeSelector"),s=document.getElementById("mobileViewToggle");t&&t.addEventListener("click",()=>{e==null||e.classList.remove("hidden");const o=document.body.getAttribute("data-quran-theme"),r=e==null?void 0:e.querySelector(".settings-content");r&&(o?r.setAttribute("data-quran-theme",o):r.removeAttribute("data-quran-theme"))}),n&&n.addEventListener("click",()=>{e==null||e.classList.add("hidden")}),i&&(i.value=this.userData.theme,i.addEventListener("change",o=>{const r=o.target.value;S.setColorTheme(r),this.userData.theme=r,this.saveProgress()})),s&&(s.checked=document.body.classList.contains("iphone-view"),s.addEventListener("change",o=>{M.apply(o.target.checked)}));const a=document.getElementById("searchInput");a&&a.addEventListener("input",()=>this.filterData()),window.addEventListener("click",o=>{o.target===e&&(e==null||e.classList.add("hidden"))})}updateXPDisplay(){const t=document.getElementById("userXP");t&&(t.textContent=this.userData.xp.toString());const e=document.getElementById("xpDonut");if(e){const n=this.userData.xp%100;e.style.setProperty("--p",n.toString())}}initFilters(){const t=document.getElementById("surahFilter"),e=document.getElementById("typeFilter"),n=s=>s?s.replace(/\s*\(\d+\)$/,"").trim():"";[...new Set(u.map(s=>n(s.surah)))].filter(Boolean).sort().forEach(s=>{const a=document.createElement("option");a.value=s,a.textContent=s,t.appendChild(a)}),t==null||t.addEventListener("change",()=>this.filterData()),e==null||e.addEventListener("change",()=>this.filterData())}filterData(){const t=document.getElementById("searchInput"),e=document.getElementById("surahFilter"),n=document.getElementById("typeFilter"),i=(t==null?void 0:t.value.toLowerCase())||"",s=(e==null?void 0:e.value)||"all",a=(n==null?void 0:n.value)||"all",o=r=>r?r.replace(/\s*\(\d+\)$/,"").trim():"";this.filteredData=u.filter(r=>{const l=r.word&&r.word.includes(i)||r.word_sv&&r.word_sv.toLowerCase().includes(i)||r.meaning_ar&&r.meaning_ar.includes(i)||r.ayah_full&&r.ayah_full.includes(i)||r.ayah_sv&&r.ayah_sv.toLowerCase().includes(i);let d=!0;s!=="all"&&(s==="favorites"?d=p.has(r.id):d=o(r.surah)===s);const f=a==="all"||r.type===a;return l&&d&&f}),this.currentMode==="browse"?this.renderCards(this.filteredData):this.currentMode==="flashcard"&&(this.fcIndex=0,this.loadFlashcard(this.fcIndex))}switchMode(t){const n={list:"browse",flashcards:"flashcard"}[t]||t;this.currentMode=n,this.viewManager.switchTo(n),document.querySelectorAll(".mode-btn").forEach(s=>s.classList.remove("active"));const i=document.getElementById(`btn-${n}`);i&&(i.classList.add("active"),this.updateModeIndicator(i))}updateModeIndicator(t){const e=document.getElementById("modeIndicator"),n=document.getElementById("modeSelectionBar");if(!e||!n)return;const i=n.getBoundingClientRect(),s=t.getBoundingClientRect(),a=s.left-i.left;e.style.width=`${s.width}px`,e.style.transform=`translateX(${a-6}px)`}renderCards(t){const e=document.getElementById("quranList");if(e){if(this.currentItems=t,this.currentBatchIndex=0,e.innerHTML="",t.length===0){e.innerHTML=`<div style="text-align:center; color:#ccc; padding:2rem;">${w("quran.noResults")}</div>`;return}this.renderBatch(e),this.setupLazyLoading(e)}}renderBatch(t){const e=this.currentBatchIndex*this.ITEMS_PER_BATCH,n=Math.min(e+this.ITEMS_PER_BATCH,this.currentItems.length);if(e>=this.currentItems.length)return;const i=document.createDocumentFragment();for(let r=e;r<n;r++){const l=this.currentItems[r],d=this.createCardElement(l);i.appendChild(d)}const s=Array.from(i.children),a=t.querySelector(".load-more-sentinel");if(a&&a.remove(),t.appendChild(i),this.currentBatchIndex++,n<this.currentItems.length){const r=document.createElement("div");r.className="load-more-sentinel",r.style.cssText="height: 50px; display: flex; align-items: center; justify-content: center; color: var(--quran-gold); opacity: 0.7;";const l=Math.min(this.ITEMS_PER_BATCH,this.currentItems.length-n);r.innerHTML=`<span>â³ ${w("quran.loadingMore").replace("{0}",l.toString())}</span>`,t.appendChild(r)}else{const r=document.createElement("div");r.className="end-of-list",r.style.cssText="text-align: center; padding: 1rem; color: var(--quran-gold); opacity: 0.6;";const l=w("quran.wordsDisplayed").replace("{0}",this.currentItems.length.toString());r.innerHTML=`âœ¨ ${l}`,t.appendChild(r)}requestAnimationFrame(()=>{s.forEach(r=>{m.applyToContainer(r)})});const o=t.querySelector(".load-more-sentinel");o&&this.loadMoreObserver&&this.loadMoreObserver.observe(o)}setupLazyLoading(t){this.loadMoreObserver&&this.loadMoreObserver.disconnect(),this.loadMoreObserver=new IntersectionObserver(n=>{n.forEach(i=>{i.isIntersecting&&i.target.classList.contains("load-more-sentinel")&&this.renderBatch(t)})},{root:null,rootMargin:"200px",threshold:.1});const e=t.querySelector(".load-more-sentinel");e&&this.loadMoreObserver.observe(e)}createCardElement(t){const e=document.createElement("div");e.className="quran-card";let n=t.ayah_full;t.word&&n.includes(t.word)&&(n=n.replace(t.word,`<span class="highlight-word">${t.word}</span>`));const s=p.has(t.id)?"fav-btn active":"fav-btn",a=this.getAudioUrl(t.surah),o=t.word.replace(/[^\u0621-\u064A]/g,"").substring(0,3);return e.innerHTML=`
            <div class="card-header">
                <div class="left-actions">
                    <span class="badger surah-badge">${t.surah}</span>
                    <button class="badger root-badge" onclick="showRelatedList('${t.word}')">
                        <span class="badger-icon">ğŸŒ±</span>
                        <span class="sv-text">Rot: ${o}</span>
                        <span class="ar-text">Ø¬Ø°Ø±: ${o}</span>
                    </button>
                </div>
                <div class="action-group">
                    <button class="share-btn" title="Dela" onclick='shareCard(${JSON.stringify(t).replace(/'/g,"&apos;")}, event)'>
                        ${this.icons.share}
                    </button>
                    <button class="${s}" onclick="toggleFavorite('${t.id}')" data-id="${t.id}" title="Spara till favoriter">
                        ${this.icons.heart}
                    </button>
                </div>
            </div>
            
            <div class="main-word-section">
                <span class="target-word" data-auto-size>${t.word}</span>
                <span class="meaning-ar" data-auto-size>${t.meaning_ar}</span>
                <div class="word-sv-container">
                    <span class="word-sv-accent" data-auto-size>${t.word_sv}</span>
                    <div class="word-actions">
                        <button class="icon-btn" onclick="playTTS('${t.word_sv.replace(/'/g,"\\'")}', 'sv-SE', this, null, '${t.id}')">ğŸ”Š</button> 
                        <button class="icon-btn" onclick="openInfoModal('${t.id}')" title="Tafsir/Info">â„¹ï¸</button>
                    </div>
                </div>
             </div>

            <div class="ayah-section">
                <div class="ayah-full" data-auto-size>${n}</div>
                
                <div class="media-bar">
                    <button class="media-btn play-ayah-btn" onclick="playTTS('${t.ayah_full.replace(/'/g,"\\'")}', 'ar-SA', this, '${a}', '${t.id}')">
                        <span class="icon-lg">ğŸ•Œ</span> <span class="btn-text">Tilaawah</span>
                    </button>
                    
                    <div class="audio-visualizer hidden">
                        <span></span><span></span><span></span><span></span><span></span>
                    </div>

                    <button class="media-btn mic-btn" onmousedown="startRecording(this)" onmouseup="stopRecording(this)" ontouchstart="startRecording(this)" ontouchend="stopRecording(this)">
                        <span class="icon-lg">ğŸ™ï¸</span>
                    </button>
                </div>

                <div class="ayah-sv text-muted" data-auto-size>${t.ayah_sv}</div>
            </div>
        `,e}getAudioUrl(t){try{const e=t.match(/(.+)\s\((\d+)\)/);if(e&&e.length===3){const n=e[1].trim(),i=e[2].trim().padStart(3,"0"),s=this.surahMap[n];if(s)return`https://everyayah.com/data/Alafasy_128kbps/${s}${i}.mp3`}}catch(e){console.error("Error parsing audio URL:",e)}return null}openInfoModal(t){const e=u.find(a=>a.id===t);if(!e)return;const n=document.getElementById("infoModal"),i=document.getElementById("modalTitle"),s=document.getElementById("modalBody");i&&(i.innerHTML=`<span class="sv-text">Tafsir: ${e.word}</span><span class="ar-text">ØªÙØ³ÙŠØ±: ${e.word}</span>`),s&&(s.innerHTML=`
                <div class="tafsir-text">
                    <strong>ğŸ“ <span class="sv-text">Rot/Ursprung (Estimat):</span><span class="ar-text">Ø§Ù„Ø£ØµÙ„/Ø§Ù„Ø¬Ø°Ø± (ØªÙ‚Ø¯ÙŠØ±ÙŠ):</span></strong> ${e.word.replace(/[^\u0621-\u064A]/g,"").substring(0,3)}<br><br>
                    <strong>ğŸ“– <span class="sv-text">Kontext (Svenska):</span><span class="ar-text">Ø§Ù„Ø³ÙŠØ§Ù‚ (Ø§Ù„Ø³ÙˆÙŠØ¯ÙŠØ©):</span></strong><br> "${e.ayah_sv}"<br><br>
                    <strong>ğŸ’¡ <span class="sv-text">Betydelse (UtÃ¶kad):</span><span class="ar-text">Ø§Ù„Ù…Ø¹Ù†Ù‰ (Ù…ÙˆØ³Ø¹):</span></strong><br> ${e.meaning_ar}<br><br>
                    <em><span class="sv-text">(Tafsir Al-Jalalayn - Kommer snart)</span><span class="ar-text">(ØªÙØ³ÙŠØ± Ø§Ù„Ø¬Ù„Ø§Ù„ÙŠÙ† - Ù‚Ø§Ø¯Ù…Ø§Ù‹ Ù‚Ø±ÙŠØ¨Ø§Ù‹)</span></em>
                </div>
                <button class="control-btn" style="background:var(--quran-green); width:100%" onclick="closeInfoModal()">
                    <span class="sv-text">StÃ¤ng</span><span class="ar-text">Ø¥ØºÙ„Ø§Ù‚</span>
                </button>
            `),n==null||n.classList.remove("hidden")}closeInfoModal(){var t;(t=document.getElementById("infoModal"))==null||t.classList.add("hidden")}toggleFavorite(t){navigator.vibrate&&navigator.vibrate(10);const e=p.toggle(t);document.querySelectorAll(`.fav-btn[data-id="${t}"]`).forEach(i=>{p.updateButtonIcon(i,e)}),v.recordStudy(t)}playTTS(t,e,n,i=null,s){var r;navigator.vibrate&&navigator.vibrate(10),n&&n.classList.add("playing");const a=n.closest(".quran-card, .fc-inner"),o=a==null?void 0:a.querySelector(".audio-visualizer");if(o&&o.classList.remove("hidden"),e==="ar-SA"&&i){const l=new Audio(i);l.onended=()=>{var y;n.classList.remove("playing"),o&&o.classList.add("hidden");const f=n.closest(".quran-card, .fc-inner");(y=f==null?void 0:f.querySelector(".highlight-word"))==null||y.classList.remove("highlight-karaoke")},l.onerror=()=>{x.speak(t,e),n.classList.remove("playing"),o&&o.classList.add("hidden")},l.play().catch(()=>{x.speak(t,e),n.classList.remove("playing"),o&&o.classList.add("hidden")});const d=n.closest(".quran-card, .fc-inner");(r=d==null?void 0:d.querySelector(".highlight-word"))==null||r.classList.add("highlight-karaoke"),s&&v.recordStudy(s);return}x.speak(t,e),setTimeout(()=>{n.classList.remove("playing"),o&&o.classList.add("hidden")},2e3),s&&v.recordStudy(s)}async shareCard(t,e){navigator.vibrate&&navigator.vibrate(10),e&&(e.preventDefault(),e.stopPropagation());const n=`ğŸ”¹ ${t.word} (${t.surah})

Meaning: ${t.meaning_ar}

ğŸ“– ${t.ayah_full}

ğŸ‡¸ğŸ‡ª "${t.ayah_sv}"

- Snabbalexin Quran`;if(navigator.share)try{await navigator.share({title:"Koranord - SnabbaLexin",text:n})}catch(i){console.warn("Share failed",i)}else await navigator.clipboard.writeText(n),C("Text kopierad! / ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ! ğŸ“‹")}async startRecording(t){navigator.vibrate&&navigator.vibrate(20),t.classList.add("recording");const e=t.closest(".quran-card"),n=e==null?void 0:e.querySelector(".audio-visualizer");n&&n.classList.remove("hidden");try{const i=await navigator.mediaDevices.getUserMedia({audio:!0});this.mediaRecorder=new MediaRecorder(i),this.audioChunks=[],this.mediaRecorder.ondataavailable=s=>this.audioChunks.push(s.data),this.mediaRecorder.start()}catch{C("Mikrofon nekad / Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù…Ø±ÙÙˆØ¶ ğŸ¤âŒ"),t.classList.remove("recording"),n&&n.classList.add("hidden")}}stopRecording(t){if(navigator.vibrate&&navigator.vibrate(10),!this.mediaRecorder||this.mediaRecorder.state==="inactive")return;t.classList.remove("recording");const e=t.closest(".quran-card"),n=e==null?void 0:e.querySelector(".audio-visualizer");n&&n.classList.add("hidden"),this.mediaRecorder.stop(),this.mediaRecorder.onstop=()=>{const i=new Blob(this.audioChunks,{type:"audio/wav"}),s=URL.createObjectURL(i);new Audio(s).play()}}showRelatedList(t){this.switchMode("browse");const e=t.replace(/[^\u0621-\u064A]/g,"");if(e.length<3)return;const n=e.substring(0,3),i=u.filter(a=>a.word===t?!1:a.word.replace(/[^\u0621-\u064A]/g,"").includes(n)),s=document.getElementById("quranList");if(s){this.renderCards(i);const a=document.createElement("div");a.className="related-header",a.style.cssText="padding:1.5rem 1rem; text-align:center; border-bottom:1px solid var(--quran-gold-o2);",a.innerHTML=`
                <h3 style="color:var(--quran-gold); margin-bottom:12px; font-size:1.2rem;">
                    <span class="sv-text">Orden frÃ¥n samma rot "${t}"</span>
                    <span class="ar-text">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù…Ù† Ù†ÙØ³ Ø§Ù„Ø¬Ø°Ø± "${t}"</span>
                </h3>
                <button onclick="renderCards()" class="control-btn" style="padding: 0.6rem 1.2rem;">
                    <span class="sv-text">Visa alla</span>
                    <span class="ar-text">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</span>
                </button>`,s.prepend(a)}}initFlashcards(){const t=document.getElementById("quranFlashcard"),e=document.getElementById("prevCardBtn"),n=document.getElementById("nextCardBtn"),i=document.getElementById("globalFcLangToggle");t==null||t.addEventListener("click",s=>{var a;s.target.closest(".audio-btn, .fav-btn, .share-btn")||(this.fcFlipped=!this.fcFlipped,t.classList.toggle("flipped",this.fcFlipped),(a=document.getElementById("ratingControls"))==null||a.classList.toggle("visible",this.fcFlipped))}),e==null||e.addEventListener("click",()=>{this.fcIndex>0&&(this.fcIndex--,this.loadFlashcard(this.fcIndex))}),n==null||n.addEventListener("click",()=>{this.fcIndex<this.filteredData.length-1&&(this.fcIndex++,this.loadFlashcard(this.fcIndex))}),i==null||i.addEventListener("change",s=>{this.fcDirection=s.target.checked?"sv-ar":"ar-sv";const a=document.getElementById("fcModeLabel");a&&(this.fcDirection==="sv-ar"?a.innerHTML='<span class="sv-text">ğŸ‡¸ğŸ‡ª Svenska (Framsida)</span><span class="ar-text">ğŸ‡¸ğŸ‡ª Ø§Ù„Ø³ÙˆÙŠØ¯ÙŠØ© (Ø§Ù„Ø£Ù…Ø§Ù…)</span>':a.innerHTML='<span class="sv-text">ğŸ‡¸ğŸ‡¦ Arabiska (Framsida)</span><span class="ar-text">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Ø§Ù„Ø£Ù…Ø§Ù…)</span>'),this.loadFlashcard(this.fcIndex)}),document.querySelectorAll(".rate-btn").forEach(s=>{s.addEventListener("click",a=>{a.stopPropagation(),this.handleSRS(s.dataset.rating)})})}loadFlashcard(t){var y,b;if(!this.filteredData[t])return;const e=this.filteredData[t];this.fcFlipped=!1,(y=document.getElementById("quranFlashcard"))==null||y.classList.remove("flipped"),(b=document.getElementById("ratingControls"))==null||b.classList.remove("visible");const n=this.fcDirection==="ar-sv",i=p.has(e.id);document.querySelectorAll(".fav-btn").forEach(I=>{p.updateButtonIcon(I,i)});const s=document.getElementById("fcWord");s&&(s.textContent=n?e.word:e.word_sv);const a=document.getElementById("fcSurah");a&&(a.textContent=e.surah);const o=document.getElementById("fcMeaning");o&&(o.textContent=e.meaning_ar);const r=document.getElementById("fcAyah"),l=document.getElementById("fcTrans"),d=this.getAudioUrl(e.surah);if(r&&l){const I=`<button class="audio-btn" onclick="playTTS('${e.ayah_full.replace(/'/g,"\\'")}', 'ar-SA', this, '${d}', '${e.id}')">ğŸ•Œ</button>`,k=`<button class="audio-btn" onclick="playTTS('${e.word_sv.replace(/'/g,"\\'")}', 'sv-SE', this, null, '${e.id}')">ğŸ”Š</button>`,E=`<button class="audio-btn" onclick="openInfoModal('${e.id}')" title="Tafsir/Info">â„¹ï¸</button>`,B=e.ayah_full.replace(e.word,`<span class="highlight-word">${e.word}</span>`);n?(r.innerHTML=B+I+E,l.innerHTML=`<div style="margin-bottom:5px; font-weight:bold; color:var(--quran-gold)">${e.word_sv} ${k}</div><div>${e.ayah_sv}</div>`):(r.innerHTML=`<div style="font-size:1.4rem; margin-bottom:0.5rem; color:var(--quran-gold);">${e.word}</div>${B} ${I} ${E}`,l.innerHTML=`<div>${e.ayah_sv}</div>`),s&&m.apply(s,s.textContent||""),o&&m.apply(o,o.textContent||""),r.querySelectorAll("*").forEach(h=>{h.textContent&&h.textContent.length>20&&m.apply(h,h.textContent,2)}),l.querySelectorAll("*").forEach(h=>{h.textContent&&h.textContent.length>20&&m.apply(h,h.textContent,2)})}const f=document.getElementById("fcProgress");f&&(f.textContent=`${t+1} / ${this.filteredData.length}`),v.recordStudy(e.id)}handleSRS(t){var s;const e=this.filteredData[this.fcIndex];let n=1;t==="easy"?n=7:t==="good"?n=3:t==="again"&&(n=0);const i=Date.now()+n*24*60*60*1e3;this.userData.srs[e.id]={level:(((s=this.userData.srs[e.id])==null?void 0:s.level)||0)+(t==="again"?0:1),nextReview:i,lastRating:t},this.saveProgress(),t!=="again"&&this.fcIndex<this.filteredData.length-1&&(this.fcIndex++,this.loadFlashcard(this.fcIndex))}initQuiz(){var e;(e=document.getElementById("nextQuestionBtn"))==null||e.addEventListener("click",()=>this.nextQuizQuestion());const t=document.getElementById("quizLangToggle");t==null||t.addEventListener("change",n=>{this.quizDirection=n.target.checked?"sv-ar":"ar-sv";const i=document.getElementById("quizModeLabel");i&&(this.quizDirection==="sv-ar"?i.innerHTML='<span class="sv-text">ğŸ‡¸ğŸ‡ª Svenska â” ğŸ‡¸ğŸ‡¦ Arabiska</span><span class="ar-text">ğŸ‡¸ğŸ‡ª Ø§Ù„Ø³ÙˆÙŠØ¯ÙŠØ© â” ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>':i.innerHTML='<span class="sv-text">ğŸ‡¸ğŸ‡¦ Arabiska â” ğŸ‡¸ğŸ‡ª Svenska</span><span class="ar-text">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© â” ğŸ‡¸ğŸ‡ª Ø§Ù„Ø³ÙˆÙŠØ¯ÙŠØ©</span>'),this.nextQuizQuestion()})}nextQuizQuestion(){const t=document.getElementById("quizFeedback"),e=document.getElementById("nextQuestionBtn"),n=document.getElementById("quizOptions");t==null||t.classList.add("hidden"),t==null||t.classList.remove("correct","wrong"),e==null||e.classList.add("hidden"),n&&(n.innerHTML="");const i=Math.floor(Math.random()*u.length);this.currentQuizItem=u[i];const s=document.querySelector(".quiz-question-type"),a=document.getElementById("quizWord");if(this.quizDirection==="ar-sv"?(s&&(s.textContent="Ù…Ø§ Ù…Ø¹Ù†Ù‰ Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø©ØŸ"),a&&this.currentQuizItem&&(a.textContent=this.currentQuizItem.word)):(s&&(s.textContent="Vad heter detta pÃ¥ Arabiska?"),a&&this.currentQuizItem&&(a.textContent=this.currentQuizItem.word_sv)),!this.currentQuizItem)return;const o=[this.currentQuizItem];for(;o.length<4;){const r=u[Math.floor(Math.random()*u.length)];r&&!o.some(l=>l.id===r.id)&&o.push(r)}o.sort(()=>Math.random()-.5),o.forEach(r=>{const l=document.createElement("button");l.className="quiz-btn";const d=this.quizDirection==="ar-sv"?r.meaning_ar:r.word;l.textContent=d,l.onclick=()=>{this.currentQuizItem&&this.handleQuizAnswer(r,l)},n==null||n.appendChild(l),l&&m.apply(l,d)}),a&&a.textContent&&m.apply(a,a.textContent)}handleQuizAnswer(t,e){var a;if(!this.currentQuizItem)return;const n=document.querySelectorAll(".quiz-btn");n.forEach(o=>o.disabled=!0);const i=document.getElementById("quizFeedback");if(t.id===this.currentQuizItem.id)e.classList.add("correct"),i&&(i.textContent=w("quran.correctFeedback"),i.className="quiz-feedback correct"),this.quizScore+=10,this.userData.xp+=10,this.quizStreak++,this.userData.streak=Math.max(this.userData.streak,this.quizStreak),v.recordAnswer(this.currentQuizItem.id,!0);else{e.classList.add("wrong");const o=this.quizDirection==="ar-sv"?this.currentQuizItem.meaning_ar:this.currentQuizItem.word;n.forEach(r=>{r.textContent===o&&r.classList.add("correct")}),i&&(i.textContent=`${w("quran.wrongFeedback")} ${o}`,i.className="quiz-feedback wrong"),this.quizStreak=0,v.recordAnswer(this.currentQuizItem.id,!1)}this.saveProgress(),this.updateQuizUI(),(a=document.getElementById("nextQuestionBtn"))==null||a.classList.remove("hidden")}updateQuizUI(){const t=document.getElementById("quizScore"),e=document.getElementById("quizStreak");t&&(t.textContent=this.quizScore.toString()),e&&(e.textContent=this.quizStreak.toString())}initFillQuiz(){this.fillQuizQuestions=this.generateFillQuestions(this.fillTotalQuestions),this.fillCurrentIndex=0,this.fillScore=0;const t=document.getElementById("fillResults"),e=document.getElementById("fillQuestionCard"),n=document.getElementById("fillOptions"),i=document.getElementById("fillFeedback");t&&(t.style.display="none"),e&&(e.style.display="block"),n&&(n.style.display="grid"),i&&(i.style.display="none");const s=document.getElementById("fillNextBtn");if(s){s.replaceWith(s.cloneNode(!0));const a=document.getElementById("fillNextBtn");a==null||a.addEventListener("click",()=>this.nextFillQuestion())}this.showFillQuestion()}generateFillQuestions(t){return[...u].sort(()=>Math.random()-.5).slice(0,t).map(n=>({word:n.word,meaning:n.word_sv,ayah:n.ayah_full,translation:n.ayah_sv,correctAnswer:n.word_sv}))}showFillQuestion(){if(this.fillCurrentIndex>=this.fillQuizQuestions.length){this.showFillResults();return}const t=this.fillQuizQuestions[this.fillCurrentIndex],e=document.getElementById("fillCurrentQ"),n=document.getElementById("fillTotalQ"),i=document.getElementById("fillScore");e&&(e.textContent=(this.fillCurrentIndex+1).toString()),n&&(n.textContent=this.fillTotalQuestions.toString()),i&&(i.textContent=this.fillScore.toString());const s=document.getElementById("fillAyahArabic"),a=document.getElementById("fillAyahTranslation"),o=document.getElementById("fillTargetWord");if(s){const l=t.ayah.replace(t.word,`<span class="highlight-word">${t.word}</span>`);s.innerHTML=l}a&&(a.textContent="...",a.textContent="",a.style.visibility="hidden",a.style.visibility="hidden"),o&&(o.textContent=t.word),this.generateFillOptions(t);const r=document.getElementById("fillFeedback");r&&(r.style.display="none")}generateFillOptions(t){const e=document.getElementById("fillOptions");if(!e)return;const n=u.filter(s=>s.word_sv!==t.correctAnswer).sort(()=>Math.random()-.5).slice(0,3).map(s=>s.word_sv),i=[t.correctAnswer,...n].sort(()=>Math.random()-.5);e.innerHTML=i.map(s=>`<button class="fill-option-btn" data-answer="${s}">${s}</button>`).join(""),e.querySelectorAll(".fill-option-btn").forEach(s=>{s.addEventListener("click",a=>{const o=a.target.getAttribute("data-answer");this.checkFillAnswer(o,t.correctAnswer,t.translation)})})}checkFillAnswer(t,e,n){const i=document.getElementById("fillFeedback"),s=i==null?void 0:i.querySelector(".feedback-content"),a=document.getElementById("fillOptions"),o=document.getElementById("fillAyahTranslation");if(o&&(o.textContent=n,o.style.visibility="visible"),!i||!s)return;t===e&&this.fillScore++,a==null||a.querySelectorAll(".fill-option-btn").forEach(d=>{d.disabled=!0,d.getAttribute("data-answer")===e?d.classList.add("correct"):d.getAttribute("data-answer")===t&&d.classList.add("wrong")});const l=document.getElementById("fillScore");l&&(l.textContent=this.fillScore.toString()),this.fillAutoAdvanceTimer&&clearTimeout(this.fillAutoAdvanceTimer),this.fillAutoAdvanceTimer=setTimeout(()=>{this.nextFillQuestion()},5e3)}nextFillQuestion(){this.fillAutoAdvanceTimer&&(clearTimeout(this.fillAutoAdvanceTimer),this.fillAutoAdvanceTimer=null),this.fillCurrentIndex++,this.showFillQuestion()}showFillResults(){const t=document.getElementById("fillQuestionCard"),e=document.getElementById("fillOptions"),n=document.getElementById("fillFeedback"),i=document.getElementById("fillResults");t&&(t.style.display="none"),e&&(e.style.display="none"),n&&(n.style.display="none"),i&&(i.style.display="block");const s=document.getElementById("fillFinalScore"),a=document.getElementById("fillFinalTotal"),o=document.getElementById("fillPercentage");if(s&&(s.textContent=this.fillScore.toString()),a&&(a.textContent=this.fillTotalQuestions.toString()),o){const r=Math.round(this.fillScore/this.fillTotalQuestions*100);o.textContent=`${r}%`}}}document.addEventListener("DOMContentLoaded",()=>{new z});
