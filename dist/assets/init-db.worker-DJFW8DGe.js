(function(){"use strict";const o={DEBUG_MODE:!1,DATA_VERSION:"2026.01.12.1",DB_NAME:"snabba-lexin-db",DB_VERSION:2,DATA_PATH:{root:"/data/data.csv",games:"/data/data.json"},COLUMNS:{ID:0,TYPE:1,SWEDISH:2,ARABIC:3,ARABIC_EXT:4,DEFINITION:5,FORMS:6,EXAMPLE_SWE:7,EXAMPLE_ARB:8,IDIOM_SWE:9,IDIOM_ARB:10},SPLASH:{MIN_DISPLAY_TIME:2e3,TIP_ROTATION_INTERVAL:3e3},STORAGE_KEYS:{THEME:"theme",MOBILE_VIEW:"mobileView",FAVORITES:"favorites",WORD_ASSESSMENTS:"wordAssessments",SEARCH_HISTORY:"searchHistory"},LOADING_TIPS:["üí° Visste du? Du kan s√∂ka p√• b√•de svenska och arabiska!","üéÆ Prova v√•ra l√§randespel f√∂r att √∂va ordf√∂rr√•det!","‚≠ê Spara dina favoritord f√∂r snabb √•tkomst!","üîä Tryck p√• h√∂gtalarikonen f√∂r att h√∂ra uttalet!","üì± Installera appen f√∂r offline-anv√§ndning!","üåô ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä ŸÖÿ™ÿßÿ≠ ŸÅŸä ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™!","üìù ŸäŸÖŸÉŸÜŸÉ ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸÑŸÖÿßÿ™ŸÉ ÿßŸÑÿÆÿßÿµÿ©!"]},l={log:(...e)=>o.DEBUG_MODE&&console.log(...e),warn:(...e)=>o.DEBUG_MODE&&console.warn(...e),error:(...e)=>console.error(...e),info:(...e)=>o.DEBUG_MODE&&console.info(...e)};typeof window<"u"&&(window.AppConfig=o,window.Logger=l);const c={DB_NAME:o.DB_NAME,DB_VERSION:o.DB_VERSION,STORE_NAME:"words",META_STORE:"meta",NOTES_STORE:"notes",db:null,isReady:!1,async init(){return this.db?!0:new Promise((e,a)=>{const r=indexedDB.open(this.DB_NAME,this.DB_VERSION);r.onerror=t=>{console.error("[DB] Error opening database:",t.target.error),a(t.target.error)},r.onsuccess=t=>{this.db=t.target.result,this.isReady=!0,e(!0)},r.onupgradeneeded=t=>{const s=t.target.result;if(!s.objectStoreNames.contains(this.STORE_NAME)){const n=s.createObjectStore(this.STORE_NAME,{keyPath:"id"});n.createIndex("swedish","swe",{unique:!1}),n.createIndex("arabic","arb",{unique:!1}),n.createIndex("type","type",{unique:!1})}s.objectStoreNames.contains(this.META_STORE)||s.createObjectStore(this.META_STORE,{keyPath:"key"}),s.objectStoreNames.contains(this.NOTES_STORE)||s.createObjectStore(this.NOTES_STORE,{keyPath:"id"})}})},async getDataVersion(){return this.db||await this.init(),this.db?new Promise(e=>{try{const t=this.db.transaction([this.META_STORE],"readonly").objectStore(this.META_STORE).get("dataVersion");t.onsuccess=()=>{var s;e(((s=t.result)==null?void 0:s.value)||null)},t.onerror=()=>e(null)}catch{e(null)}}):null},async setDataVersion(e){return this.db||await this.init(),this.db?new Promise((a,r)=>{const t=this.db.transaction([this.META_STORE],"readwrite");t.objectStore(this.META_STORE).put({key:"dataVersion",value:e}),t.oncomplete=()=>a(!0),t.onerror=n=>r(n)}):!1},async getWordCount(){return this.db||await this.init(),this.db?new Promise(e=>{try{const t=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).count();t.onsuccess=()=>e(t.result),t.onerror=()=>e(0)}catch{e(0)}}):0},async saveWords(e,a=null){this.db||await this.init();const r=1e3,t=Math.ceil(e.length/r);for(let s=0;s<t;s++){const n=s*r,i=Math.min(n+r,e.length),d=e.slice(n,i);if(await this._saveBatch(d),a){const E=Math.round((s+1)/t*100);a(E)}}return!0},async _saveBatch(e){return this.db?new Promise((a,r)=>{const t=this.db.transaction([this.STORE_NAME],"readwrite"),s=t.objectStore(this.STORE_NAME);e.forEach(n=>{const i={id:n[o.COLUMNS.ID],type:n[o.COLUMNS.TYPE],swe:n[o.COLUMNS.SWEDISH],arb:n[o.COLUMNS.ARABIC],arbExt:n[o.COLUMNS.ARABIC_EXT],sweDef:n[o.COLUMNS.DEFINITION],forms:n[o.COLUMNS.FORMS],sweEx:n[o.COLUMNS.EXAMPLE_SWE],arbEx:n[o.COLUMNS.EXAMPLE_ARB],idiomSwe:n[o.COLUMNS.IDIOM_SWE],idiomArb:n[o.COLUMNS.IDIOM_ARB],raw:n};s.put(i)}),t.oncomplete=()=>a(!0),t.onerror=n=>r(n)}):!1},async getAllWords(e=null){return this.db||await this.init(),this.db?new Promise((a,r)=>{const n=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).getAll();n.onsuccess=()=>{const i=n.result.map(d=>d.raw);e&&e(100),a(i)},n.onerror=i=>{console.error("[DB] Error getting words:",i),r(i)}}):[]},async hasCachedData(){return await this.getWordCount()>0},async clearCache(){return this.db||await this.init(),this.db?new Promise((e,a)=>{const r=this.db.transaction([this.STORE_NAME,this.META_STORE],"readwrite");r.objectStore(this.STORE_NAME).clear(),r.objectStore(this.META_STORE).clear(),r.oncomplete=()=>{e(!0)},r.onerror=t=>a(t)}):!1},async getWordById(e){return this.db||await this.init(),this.db?new Promise(a=>{try{const s=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).get(e);s.onsuccess=()=>{s.result&&s.result.raw?a(s.result.raw):a(null)},s.onerror=()=>a(null)}catch(r){console.error("[DB] getWordById error:",r),a(null)}}):null},async saveWord(e){return this.db||await this.init(),this.db?new Promise((a,r)=>{const t=this.db.transaction([this.STORE_NAME],"readwrite");t.objectStore(this.STORE_NAME).put(e),t.oncomplete=()=>a(!0),t.onerror=n=>r(n)}):!1},async deleteWord(e){return this.db||await this.init(),this.db?new Promise((a,r)=>{const t=this.db.transaction([this.STORE_NAME],"readwrite");t.objectStore(this.STORE_NAME).delete(e),t.oncomplete=()=>a(!0),t.onerror=n=>r(n)}):!1},async getNote(e){return this.db||await this.init(),this.db?new Promise(a=>{try{const s=this.db.transaction([this.NOTES_STORE],"readonly").objectStore(this.NOTES_STORE).get(e);s.onsuccess=()=>{var n;a(((n=s.result)==null?void 0:n.text)||null)},s.onerror=()=>a(null)}catch{a(null)}}):null},async saveNote(e,a){return this.db||await this.init(),this.db?new Promise((r,t)=>{const s=this.db.transaction([this.NOTES_STORE],"readwrite");s.objectStore(this.NOTES_STORE).put({id:e,text:a,updatedAt:Date.now()}),s.oncomplete=()=>r(!0),s.onerror=i=>t(i)}):!1}},u={async loadDictionary(e=null,a=null){try{await c.init();const r=await c.getDataVersion();if(await c.hasCachedData()&&r===o.DATA_VERSION)return a&&a("Laddar fr√•n cache... / ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÜ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ©..."),await c.getAllWords(e);a&&a("Laddar ordbok... / ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇÿßŸÖŸàÿ≥...");const s=window.dictionaryData;if(typeof s>"u"||!s.length)throw new Error("dictionaryData not loaded from data.js");return a&&a("Sparar i cache... / ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ≠ŸÅÿ∏..."),await c.saveWords(s,e),await c.setDataVersion(o.DATA_VERSION),s}catch(r){console.error("[DataLoader] Error:",r);const t=window.dictionaryData;if(typeof t<"u")return t;throw r}},async refreshCache(e=null){return await c.clearCache(),this.loadDictionary(e)}};typeof window<"u"&&(window.DictionaryDB=c,window.DataLoader=u,window.DATA_VERSION=o.DATA_VERSION),self.onmessage=async e=>{const{type:a,url:r}=e.data;if(a==="init")try{const t=r;h(5,"Laddar data (CSV)... / ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...");const s=await fetch(t);if(!s.ok)throw new Error(`HTTP ${s.status}`);h(20,"L√§ser data... / ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...");const n=await s.text();h(30,"Bearbetar CSV... / ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...");const i=S(n);h(40,"Sparar data... / ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ≠ŸÅÿ∏..."),await c.init(),await c.saveWords(i,d=>{const E=40+d*.55;h(E,"Sparar data... / ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ≠ŸÅÿ∏...")}),await c.setDataVersion(o.DATA_VERSION),postMessage({type:"complete"})}catch(t){postMessage({type:"error",error:t.message||"Unknown error"})}};function h(e,a){postMessage({type:"progress",value:e,status:a})}function S(e){const a=[];let r=[],t="",s=!1;e=e.replace(/\r\n/g,`
`);for(let n=0;n<e.length;n++){const i=e[n],d=e[n+1];s?i==='"'?d==='"'?(t+='"',n++):s=!1:t+=i:i==='"'?s=!0:i===","?(r.push(t),t=""):i===`
`?(r.push(t),(r.length>1||r[0]!=="")&&a.push(r),r=[],t=""):t+=i}return(t||r.length>0)&&(r.push(t),a.push(r)),a}})();
