var p=Object.defineProperty;var x=(r,t,e)=>t in r?p(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var n=(r,t,e)=>x(r,typeof t!="symbol"?t+"":t,e);import"./modulepreload-polyfill-B5Qt9EMX.js";import"./loader-BOlof-UD.js";import"./pwa-Bxh5GLjF.js";import"./config-CfHoVMbv.js";import"./db-bEbbjtoI.js";import"./utils-B-9iATqE.js";class u{constructor(){n(this,"ctx");n(this,"enabled");this.ctx=new(window.AudioContext||window.webkitAudioContext),this.enabled=!0}playTone(t,e,s,i=.1,o=0){if(!this.enabled)return;const l=this.ctx.createOscillator(),a=this.ctx.createGain();l.type=e,l.frequency.setValueAtTime(t,this.ctx.currentTime),o!==0&&l.frequency.exponentialRampToValueAtTime(t+o,this.ctx.currentTime+s),a.gain.setValueAtTime(i,this.ctx.currentTime),a.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+s),l.connect(a),a.connect(this.ctx.destination),l.start(),l.stop(this.ctx.currentTime+s)}playSlide(){this.playTone(400,"sine",.1,.1,200)}playHit(){this.playTone(150,"square",.1,.05,-50)}playWin(){[523.25,659.25,783.99,1046.5,783.99,1046.5].forEach((t,e)=>{setTimeout(()=>this.playTone(t,"square",.1,.1),e*80)}),setTimeout(()=>this.playTone(1318.51,"square",.4,.1),480)}playUndo(){this.playTone(600,"sawtooth",.15,.1,-400)}}class v{constructor(t,e,s,i,o,l){n(this,"id");n(this,"x");n(this,"y");n(this,"length");n(this,"orientation");n(this,"type");n(this,"el");n(this,"tempX");n(this,"tempY");this.id=t,this.x=e,this.y=s,this.length=i,this.orientation=o,this.type=l,this.el=null}}class f{constructor(){n(this,"board");n(this,"cellSize");n(this,"gap");n(this,"gridSize");n(this,"blocks");n(this,"currentLevel");n(this,"moves");n(this,"history");n(this,"sound");n(this,"gameMode");n(this,"progress");n(this,"levels");n(this,"isDragging",!1);n(this,"draggedBlock",null);n(this,"startPos",{x:0,y:0});n(this,"blockStartPos",{x:0,y:0});n(this,"hasMoved",!1);this.board=document.getElementById("board"),this.cellSize=55,this.gap=4,this.gridSize=6,this.blocks=[],this.currentLevel=0,this.moves=0,this.history=[],this.sound=new u,this.gameMode="classic",this.progress=JSON.parse(localStorage.getItem("unblockMe_progress"))||{},this.levels=[{par:10,blocks:[{x:1,y:2,len:2,dir:"h",type:"target"},{x:0,y:0,len:3,dir:"v",type:"normal"},{x:1,y:0,len:2,dir:"h",type:"normal"},{x:3,y:0,len:3,dir:"v",type:"normal"},{x:4,y:2,len:2,dir:"v",type:"normal"},{x:0,y:4,len:2,dir:"h",type:"normal"},{x:2,y:4,len:2,dir:"v",type:"normal"},{x:4,y:4,len:2,dir:"h",type:"normal"}]},{par:15,blocks:[{x:0,y:2,len:2,dir:"h",type:"target"},{x:2,y:0,len:3,dir:"v",type:"normal"},{x:3,y:1,len:2,dir:"v",type:"normal"},{x:0,y:4,len:3,dir:"h",type:"normal"},{x:4,y:3,len:2,dir:"v",type:"normal"},{x:2,y:3,len:2,dir:"h",type:"normal"},{x:0,y:0,len:1,dir:"h",type:"fixed"},{x:5,y:5,len:1,dir:"h",type:"fixed"}]},{par:20,blocks:[{x:1,y:2,len:2,dir:"h",type:"target"},{x:0,y:0,len:2,dir:"h",type:"normal"},{x:2,y:0,len:2,dir:"h",type:"normal"},{x:4,y:0,len:2,dir:"v",type:"normal"},{x:0,y:1,len:2,dir:"v",type:"normal"},{x:3,y:1,len:3,dir:"v",type:"normal"},{x:1,y:3,len:2,dir:"v",type:"normal"},{x:0,y:4,len:2,dir:"h",type:"normal"},{x:4,y:4,len:2,dir:"v",type:"normal"},{x:2,y:2,len:1,dir:"h",type:"fixed"}]}],this.addEventListeners(),window.addEventListener("click",()=>{this.sound.ctx.state==="suspended"&&this.sound.ctx.resume()},{once:!0}),localStorage.getItem("unblockMe_nightMode")==="true"&&this.toggleNightMode(!0)}toggleNightMode(t=null){const e=document.body,s=t!==null?t:!e.classList.contains("night-mode");s?(e.classList.add("night-mode"),document.getElementById("theme-icon").innerHTML='<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>'):(e.classList.remove("night-mode"),document.getElementById("theme-icon").innerHTML='<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>'),localStorage.setItem("unblockMe_nightMode",s.toString())}startMode(t){this.gameMode=t,document.getElementById("start-screen").classList.add("hidden"),this.initLevel(this.currentLevel)}initLevel(t){this.currentLevel=t,this.moves=0,this.history=[],this.updateUI(),this.board.innerHTML='<div class="exit-gate"></div><div class="exit-arrow">➜</div>',this.blocks=[],this.levels[t%this.levels.length].blocks.forEach((s,i)=>{const o=new v(i,s.x,s.y,s.len,s.dir,s.type);this.createBlockElement(o),this.blocks.push(o)})}updateUI(){document.getElementById("level-display").textContent=(this.currentLevel+1).toString(),document.getElementById("moves-display").textContent=this.moves.toString();const t=`${this.gameMode}_${this.currentLevel}`,e=this.progress[t]?this.progress[t].moves.toString():"-";document.getElementById("best-display").textContent=e}createBlockElement(t){const e=document.createElement("div");let s=`block ${t.type} ${t.orientation==="h"?"horizontal":"vertical"}`;this.gameMode==="ice"&&(s+=" ice-theme"),e.className=s,t.orientation==="h"?(e.style.width=`calc(${t.length} * var(--cell-size) + ${t.length-1} * var(--gap))`,e.style.height="var(--cell-size)"):(e.style.width="var(--cell-size)",e.style.height=`calc(${t.length} * var(--cell-size) + ${t.length-1} * var(--gap))`),this.updateBlockPosition(e,t.x,t.y),e.dataset.id=t.id.toString(),this.board.appendChild(e),t.el=e}updateBlockPosition(t,e,s){const i=e*(this.cellSize+this.gap),o=s*(this.cellSize+this.gap);t.style.transform=`translate(${i}px, ${o}px)`}addEventListeners(){const t=i=>{if(!i.target.classList.contains("block"))return;const o=parseInt(i.target.dataset.id),l=this.blocks[o];if(l.type==="fixed"){this.sound.playHit();return}i.cancelable&&i.preventDefault(),this.isDragging=!0,this.draggedBlock=l;const a=i.touches?i.touches[0]:i;this.startPos={x:a.clientX,y:a.clientY},this.blockStartPos={x:this.draggedBlock.x,y:this.draggedBlock.y},this.hasMoved=!1},e=i=>{if(!this.isDragging||!this.draggedBlock)return;i.cancelable&&i.preventDefault();const o=i.touches?i.touches[0]:i,l=o.clientX-this.startPos.x,a=o.clientY-this.startPos.y;(Math.abs(l)>5||Math.abs(a)>5)&&(this.hasMoved=!0);const h=(this.draggedBlock.orientation==="h"?l:a)/(this.cellSize+this.gap);let d=this.blockStartPos.x,g=this.blockStartPos.y;this.draggedBlock.orientation==="h"?d+=h:g+=h;const c=this.constrainPosition(this.draggedBlock,d,g),y=c.x*(this.cellSize+this.gap),m=c.y*(this.cellSize+this.gap);this.draggedBlock.el&&(this.draggedBlock.el.style.transform=`translate(${y}px, ${m}px)`),this.draggedBlock.tempX=c.x,this.draggedBlock.tempY=c.y},s=()=>{if(!this.isDragging||!this.draggedBlock)return;let i,o;if(this.gameMode==="ice"&&this.hasMoved){const a=this.getLimits(this.draggedBlock),h=(this.draggedBlock.tempX||this.draggedBlock.x)-this.blockStartPos.x,d=(this.draggedBlock.tempY||this.draggedBlock.y)-this.blockStartPos.y;i=this.blockStartPos.x,o=this.blockStartPos.y,this.draggedBlock.orientation==="h"?h>.2?i=a.max:h<-.2&&(i=a.min):d>.2?o=a.max:d<-.2&&(o=a.min)}else i=Math.round(this.draggedBlock.tempX||this.draggedBlock.x),o=Math.round(this.draggedBlock.tempY||this.draggedBlock.y);(i!==this.blockStartPos.x||o!==this.blockStartPos.y)&&(this.history.push({id:this.draggedBlock.id,x:this.blockStartPos.x,y:this.blockStartPos.y}),this.moves++,this.updateUI(),this.sound.playSlide()),this.draggedBlock.x=i,this.draggedBlock.y=o;const l=this.draggedBlock;l.el&&(l.el.style.transition="transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94)",this.updateBlockPosition(l.el,i,o),setTimeout(()=>{l.el&&(l.el.style.transition="transform 0.1s")},200)),this.isDragging=!1,this.draggedBlock=null,this.checkWin()};this.board.addEventListener("mousedown",t),this.board.addEventListener("touchstart",t,{passive:!1}),window.addEventListener("mousemove",e),window.addEventListener("touchmove",e,{passive:!1}),window.addEventListener("mouseup",s),window.addEventListener("touchend",s)}getLimits(t){let e=0,s=this.gridSize-t.length;if(t.orientation==="h")for(let i of this.blocks)i!==t&&i.y<=t.y&&i.y+(i.orientation==="v"?i.length:1)>t.y&&(i.x+(i.orientation==="h"?i.length:1)<=this.blockStartPos.x&&(e=Math.max(e,i.x+(i.orientation==="h"?i.length:1))),i.x>=this.blockStartPos.x+t.length&&(s=Math.min(s,i.x-t.length)));else for(let i of this.blocks)i!==t&&i.x<=t.x&&i.x+(i.orientation==="h"?i.length:1)>t.x&&(i.y+(i.orientation==="v"?i.length:1)<=this.blockStartPos.y&&(e=Math.max(e,i.y+(i.orientation==="v"?i.length:1))),i.y>=this.blockStartPos.y+t.length&&(s=Math.min(s,i.y-t.length)));return{min:e,max:s}}constrainPosition(t,e,s){const i=this.getLimits(t);return t.orientation==="h"?(e=Math.max(i.min,Math.min(i.max,e)),{x:e,y:t.y}):(s=Math.max(i.min,Math.min(i.max,s)),{x:t.x,y:s})}undo(){if(this.history.length===0)return;const t=this.history.pop(),e=this.blocks[t.id];e.x=t.x,e.y=t.y,e.el&&this.updateBlockPosition(e.el,e.x,e.y),this.moves--,this.updateUI(),this.sound.playUndo()}checkWin(){const t=this.blocks.find(e=>e.type==="target");if(t&&t.x>=4){this.sound.playWin(),this.saveScore();const e=this.levels[this.currentLevel%this.levels.length].par;let s=1;this.moves<=e?s=3:this.moves<=e*1.5&&(s=2),document.getElementById("modal-stars").textContent="★".repeat(s)+"☆".repeat(3-s),document.getElementById("modal-moves").textContent=this.moves.toString(),document.getElementById("modal-moves-ar").textContent=this.moves.toString(),setTimeout(()=>{document.getElementById("win-modal").classList.add("active"),this.createConfetti()},200)}}saveScore(){const t=`${this.gameMode}_${this.currentLevel}`,e=this.progress[t]?this.progress[t].moves:1/0;this.moves<e&&(this.progress[t]={moves:this.moves},localStorage.setItem("unblockMe_progress",JSON.stringify(this.progress)))}nextLevel(){document.getElementById("win-modal").classList.remove("active"),this.initLevel(this.currentLevel+1)}resetLevel(){this.initLevel(this.currentLevel),this.sound.playUndo()}createConfetti(){for(let t=0;t<50;t++){const e=document.createElement("div");e.style.position="fixed",e.style.left=Math.random()*100+"vw",e.style.top="-10px",e.style.width="10px",e.style.height="10px",e.style.background=`hsl(${Math.random()*360}, 100%, 50%)`,e.style.zIndex="2000",e.style.pointerEvents="none",document.body.appendChild(e);const s=e.animate([{transform:"translate(0, 0) rotate(0deg)",opacity:1},{transform:`translate(${Math.random()*100-50}px, 100vh) rotate(${Math.random()*720}deg)`,opacity:0}],{duration:1e3+Math.random()*2e3,easing:"cubic-bezier(0.25, 0.46, 0.45, 0.94)"});s.onfinish=()=>e.remove()}}}window.onload=()=>{new f};localStorage.getItem("mobileView")==="true"&&(document.body.classList.add("iphone-view"),document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("mobileToggle");r&&r.classList.add("active")}));
