var S=Object.defineProperty;var y=(u,t,e)=>t in u?S(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var a=(u,t,e)=>y(u,typeof t!="symbol"?t+"":t,e);import"./modulepreload-polyfill-B5Qt9EMX.js";import"./loader-D9QoQlao.js";import"./pwa-Bxh5GLjF.js";import"./config-CfHoVMbv.js";import"./db-bEbbjtoI.js";import"./utils-DkwAXeNx.js";import"./toast-manager-CZ3snF2j.js";const g={colors:{gridLine:"#2a2a35",block:"#00f3ff",palette:["#00f3ff","#bc13fe","#ff0055","#ffe600"],bomb:"#ff0000",bombText:"#ffffff",ice:"#aaddff",rock:"#555566",ghost:"rgba(255, 255, 255, 0.2)",particles:["#00f3ff","#bc13fe","#ffffff"]},storageKeys:{highScore:"neonBlocks_highScore",gameState:"neonBlocks_state"}},x=[[[1]],[[1,1]],[[1],[1]],[[1,1,1]],[[1],[1],[1]],[[1,1],[1,1]],[[1,1,1],[0,1,0]],[[0,1,0],[1,1,1]],[[1,1,1],[1,0,0]],[[1,1,1],[0,0,1]],[[1,1],[1,0]],[[1,1,1,1]],[[1],[1],[1],[1]],[[1,1,1],[1,1,1]],[[0,1,0],[1,1,1],[0,1,0]],[[1,0,1],[1,1,1]],[[1,1,1],[1,0,1]],[[1,0,0],[1,0,0],[1,1,1]],[[0,0,1],[0,0,1],[1,1,1]],[[1,1,1],[0,1,0],[0,1,0]],[[1,0],[0,1]],[[0,1],[1,0]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]]];class v{constructor(){a(this,"ctx");a(this,"enabled");this.ctx=null,this.enabled=!0}init(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext)),this.ctx.state==="suspended"&&this.ctx.resume()}playTone(t,e,i,o=0,s=.1){if(!this.enabled||!this.ctx)return;const l=this.ctx.createOscillator(),r=this.ctx.createGain();l.type=e,l.frequency.setValueAtTime(t,this.ctx.currentTime+o),r.gain.setValueAtTime(s,this.ctx.currentTime+o),r.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+o+i),l.connect(r),r.connect(this.ctx.destination),l.start(this.ctx.currentTime+o),l.stop(this.ctx.currentTime+o+i)}playPickup(){this.playTone(400,"sine",.1,0,.05)}playPlace(){this.playTone(200,"triangle",.1,0,.1)}playClear(t=1){[1,1.25,1.5,2].forEach((i,o)=>this.playTone(440*i*(1+t*.1),"sine",.4,o*.05,.1)),t>1&&this.playTone(880,"square",.2,.2,.05)}playGameOver(){this.playTone(300,"sawtooth",.5,0,.1),this.playTone(250,"sawtooth",.5,.4,.1),this.playTone(200,"sawtooth",1,.8,.1)}playTick(){this.playTone(800,"square",.05,0,.05)}playIceCrack(){this.playTone(1200,"sawtooth",.1,0,.1)}playRotate(){this.playTone(600,"sine",.1,0,.05)}}class w{constructor(){a(this,"particles");a(this,"texts");a(this,"shake");this.particles=[],this.texts=[],this.shake=0}spawnExplosion(t,e,i,o){for(let s=0;s<i;s++)this.particles.push({x:t,y:e,color:o||g.colors.particles[0],vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4,life:1,decay:.02+Math.random()*.03,size:2+Math.random()*4})}spawnText(t,e,i,o){this.texts.push({x:t,y:e,text:i,color:o,life:1,vy:-1})}triggerShake(t){this.shake=t}update(){this.particles.forEach(t=>{t.x+=t.vx,t.y+=t.vy,t.life-=t.decay,t.size*=.95}),this.particles=this.particles.filter(t=>t.life>0),this.texts.forEach(t=>{t.y+=t.vy,t.life-=.02}),this.texts=this.texts.filter(t=>t.life>0),this.shake>0&&(this.shake*=.9,this.shake<.5&&(this.shake=0))}draw(t){this.particles.forEach(e=>{t.globalAlpha=e.life,t.fillStyle=e.color,t.beginPath(),t.arc(e.x,e.y,e.size,0,Math.PI*2),t.fill()}),this.texts.forEach(e=>{t.globalAlpha=e.life,t.fillStyle=e.color,t.font="bold 20px Inter",t.textAlign="center",t.fillText(e.text,e.x,e.y)}),t.globalAlpha=1}getShake(){return this.shake>0?{x:(Math.random()-.5)*this.shake,y:(Math.random()-.5)*this.shake}:{x:0,y:0}}}class b{constructor(){a(this,"canvas");a(this,"ctx");a(this,"scoreEl");a(this,"highScoreEl");a(this,"finalScoreEl");a(this,"timerContainer");a(this,"timerValue");a(this,"mode");a(this,"grid");a(this,"hand");a(this,"score");a(this,"highScore");a(this,"moves");a(this,"timeLeft");a(this,"timerInterval");a(this,"fx");a(this,"sound");a(this,"metrics");a(this,"isDragging",!1);a(this,"dragIdx",-1);a(this,"dragPos",{x:0,y:0});a(this,"dragOffset",{x:0,y:0});this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.scoreEl=document.getElementById("score"),this.highScoreEl=document.getElementById("highScore"),this.finalScoreEl=document.getElementById("finalScore"),this.timerContainer=document.getElementById("timerContainer"),this.timerValue=document.getElementById("timerValue"),this.mode="classic",this.grid=Array(9).fill(null).map(()=>Array(9).fill(null)),this.hand=[null,null,null],this.score=0,this.highScore=0,this.moves=0,this.timeLeft=120,this.timerInterval=null,this.fx=new w,this.sound=new v,this.metrics={scale:1,gridSize:0,cellSize:0,gridX:0,gridY:0,handY:0},this.loadHighScore(),this.resize(),window.addEventListener("resize",()=>this.resize()),this.initInput(),localStorage.getItem(g.storageKeys.gameState)&&(document.getElementById("resumeBtn").style.display="block"),this.loop()}startMode(t){this.mode=t,this.restart(),document.getElementById("mainMenu").classList.remove("active"),this.mode==="time"?(this.timeLeft=120,this.timerContainer.style.display="block",this.startTimer()):this.timerContainer.style.display="none"}showMenu(){document.getElementById("gameOverModal").classList.remove("active"),document.getElementById("mainMenu").classList.add("active"),this.stopTimer()}resume(){this.loadState()&&(document.getElementById("mainMenu").classList.remove("active"),this.mode==="time"&&(this.timerContainer.style.display="block",this.startTimer()))}rotateHand(){this.sound.playRotate();for(let t=0;t<3;t++){const e=this.hand[t];if(e){const i=e.shape,o=i.length,s=i[0].length,l=Array(s).fill(null).map(()=>Array(o).fill(0));for(let r=0;r<o;r++)for(let h=0;h<s;h++)l[h][o-1-r]=i[r][h];e.shape=l}}}startTimer(){this.stopTimer(),this.timerInterval=setInterval(()=>{this.timeLeft--,this.timerValue.textContent=this.timeLeft.toString(),this.timeLeft<=10&&this.sound.playTick(),this.timeLeft<=0&&this.endGame()},1e3)}stopTimer(){this.timerInterval&&clearInterval(this.timerInterval)}resize(){const t=document.getElementById("game-container"),e=window.devicePixelRatio||1;this.canvas.width=t.clientWidth*e,this.canvas.height=t.clientHeight*e,this.canvas.style.width=`${t.clientWidth}px`,this.canvas.style.height=`${t.clientHeight}px`,this.ctx.scale(e,e);const i=20,o=t.clientWidth-i*2;this.metrics.cellSize=Math.floor(o/9),this.metrics.gridSize=this.metrics.cellSize*9,this.metrics.gridX=(t.clientWidth-this.metrics.gridSize)/2,this.metrics.gridY=i+(this.mode==="time"?40:0),this.metrics.handY=this.metrics.gridY+this.metrics.gridSize+40}spawnShapes(){for(let t=0;t<3;t++){const e=x[Math.floor(Math.random()*x.length)];let i=g.colors.block;this.mode==="color"&&(i=g.colors.palette[Math.floor(Math.random()*g.colors.palette.length)]),this.hand[t]={shape:e,color:i}}}placeShape(t,e,i){const{shape:o,color:s}=t;let l=0;this.moves++;for(let r=0;r<o.length;r++)for(let h=0;h<o[0].length;h++)if(o[r][h]===1){this.grid[e+r][i+h]={color:s,bomb:null,ice:!1,rock:!1},l++;const d=this.metrics.gridX+(i+h)*this.metrics.cellSize+this.metrics.cellSize/2,p=this.metrics.gridY+(e+r)*this.metrics.cellSize+this.metrics.cellSize/2;this.fx.spawnExplosion(d,p,3,s)}this.addScore(l*10),this.sound.playPlace(),this.fx.triggerShake(2),this.mode==="bomb"&&this.moves%5===0&&this.spawnBomb(),this.moves%15===0&&this.spawnIce(),this.moves%30===0&&this.spawnRock(),this.mode==="bomb"&&this.updateBombs()}spawnBomb(){let t=this.getFilledCells().filter(e=>!e.cell.bomb&&!e.cell.rock&&!e.cell.ice);if(t.length>0){const e=t[Math.floor(Math.random()*t.length)];e.cell.bomb=9,this.sound.playTick()}}spawnIce(){let t=this.getFilledCells().filter(e=>!e.cell.bomb&&!e.cell.rock&&!e.cell.ice);if(t.length>0){const e=t[Math.floor(Math.random()*t.length)];e.cell.ice=!0}}spawnRock(){let t=this.getEmptyCells();if(t.length>0){const e=t[Math.floor(Math.random()*t.length)];this.grid[e.r][e.c]={color:g.colors.rock,rock:!0,bomb:null,ice:!1},this.fx.spawnExplosion(this.metrics.gridX+e.c*this.metrics.cellSize+this.metrics.cellSize/2,this.metrics.gridY+e.r*this.metrics.cellSize+this.metrics.cellSize/2,5,g.colors.rock)}}getFilledCells(){let t=[];for(let e=0;e<9;e++)for(let i=0;i<9;i++)this.grid[e][i]&&t.push({r:e,c:i,cell:this.grid[e][i]});return t}getEmptyCells(){let t=[];for(let e=0;e<9;e++)for(let i=0;i<9;i++)this.grid[e][i]||t.push({r:e,c:i});return t}updateBombs(){for(let t=0;t<9;t++)for(let e=0;e<9;e++){const i=this.grid[t][e];if(i&&i.bomb!==null&&(i.bomb--,i.bomb<=0)){this.endGame();return}}}checkClear(){let t=[],e=[],i=[];for(let s=0;s<9;s++)this.grid[s].every(l=>l!==null)&&t.push(s);for(let s=0;s<9;s++){let l=!0;for(let r=0;r<9;r++)this.grid[r][s]||(l=!1);l&&e.push(s)}for(let s=0;s<3;s++)for(let l=0;l<3;l++){let r=!0;for(let h=0;h<3;h++)for(let d=0;d<3;d++)this.grid[s*3+h][l*3+d]||(r=!1);r&&i.push({r:s,c:l})}const o=t.length+e.length+i.length;if(o>0){this.sound.playClear(o),this.fx.triggerShake(o*4),this.mode==="time"&&(this.timeLeft+=o*5,this.timerValue.textContent=this.timeLeft.toString(),this.fx.spawnText(this.metrics.gridX+this.metrics.gridSize/2,this.metrics.gridY,`+${o*5}s`,"#0f0"));let s=1,l=new Set;const r=(m,n)=>l.add(`${m},${n}`);t.forEach(m=>{this.mode==="color"&&this.grid[m].every(n=>n&&n.color===this.grid[m][0].color)&&(s+=2);for(let n=0;n<9;n++)r(m,n)}),e.forEach(m=>{let n=[];for(let c=0;c<9;c++)n.push(this.grid[c][m]);this.mode==="color"&&n.every(c=>c&&c.color===n[0].color)&&(s+=2);for(let c=0;c<9;c++)r(c,m)}),i.forEach(m=>{let n=[];for(let c=0;c<3;c++)for(let f=0;f<3;f++)n.push(this.grid[m.r*3+c][m.c*3+f]);this.mode==="color"&&n.every(c=>c&&c.color===n[0].color)&&(s+=2);for(let c=0;c<3;c++)for(let f=0;f<3;f++)r(m.r*3+c,m.c*3+f)}),l.forEach(m=>{const[n,c]=m.split(",").map(Number),f=this.grid[n][c];f&&!f.rock&&(f.ice?(f.ice=!1,this.sound.playIceCrack(),this.fx.spawnExplosion(this.metrics.gridX+c*this.metrics.cellSize+this.metrics.cellSize/2,this.metrics.gridY+n*this.metrics.cellSize+this.metrics.cellSize/2,5,g.colors.ice)):(this.spawnClearFX(n,c,f.color),this.grid[n][c]=null))});const h=o*100*s;this.addScore(h);const d=this.metrics.gridX+this.metrics.gridSize/2,p=this.metrics.gridY+this.metrics.gridSize/2;this.fx.spawnText(d,p,`+${h}`,"#fff"),s>1&&this.fx.spawnText(d,p-30,"COLOR MATCH!",g.colors.palette[3])}}spawnClearFX(t,e,i){const o=this.metrics.gridX+e*this.metrics.cellSize+this.metrics.cellSize/2,s=this.metrics.gridY+t*this.metrics.cellSize+this.metrics.cellSize/2;this.fx.spawnExplosion(o,s,5,i)}initInput(){const t=()=>{this.sound.init(),window.removeEventListener("touchstart",t),window.removeEventListener("mousedown",t)};window.addEventListener("touchstart",t),window.addEventListener("mousedown",t),this.isDragging=!1;const e=l=>{const r=this.canvas.getBoundingClientRect(),h=l.touches?l.touches[0]:l;return{x:h.clientX-r.left,y:h.clientY-r.top}},i=l=>{if(document.querySelector(".modal-overlay.active")&&!document.getElementById("mainMenu").classList.contains("active")||document.getElementById("mainMenu").classList.contains("active"))return;const r=e(l);if(r.y>this.metrics.handY){const h=this.canvas.width/3/(window.devicePixelRatio||1),d=Math.floor(r.x/h);d>=0&&d<3&&this.hand[d]&&(this.isDragging=!0,this.dragIdx=d,this.dragPos=r,this.dragOffset={x:0,y:-50},this.sound.playPickup())}},o=l=>{this.isDragging&&(this.dragPos=e(l))},s=()=>{if(!this.isDragging)return;const l=this.hand[this.dragIdx];if(!l)return;const r=this.getGridPos(this.dragPos.x+this.dragOffset.x,this.dragPos.y+this.dragOffset.y,l.shape);r&&this.canPlace(l.shape,r.r,r.c)&&(this.placeShape(l,r.r,r.c),this.hand[this.dragIdx]=null,this.checkClear(),this.saveState(),this.hand.every(h=>h===null)&&(this.spawnShapes(),this.saveState()),this.checkGameOver()&&this.endGame()),this.isDragging=!1,this.dragIdx=-1};this.canvas.addEventListener("mousedown",i),window.addEventListener("mousemove",o),window.addEventListener("mouseup",s),this.canvas.addEventListener("touchstart",l=>{l.preventDefault(),i(l)},{passive:!1}),this.canvas.addEventListener("touchmove",l=>{l.preventDefault(),o(l)},{passive:!1}),this.canvas.addEventListener("touchend",s)}getGridPos(t,e,i){const o=i[0].length*this.metrics.cellSize,s=i.length*this.metrics.cellSize,l=t-this.metrics.gridX-o/2+this.metrics.cellSize/2,r=e-this.metrics.gridY-s/2+this.metrics.cellSize/2;return{r:Math.round(r/this.metrics.cellSize),c:Math.round(l/this.metrics.cellSize)}}canPlace(t,e,i){for(let o=0;o<t.length;o++)for(let s=0;s<t[0].length;s++)if(t[o][s]&&(e+o<0||e+o>=9||i+s<0||i+s>=9||this.grid[e+o][i+s]))return!1;return!0}checkGameOver(){for(let t=0;t<3;t++){const e=this.hand[t];if(e&&e.shape){for(let i=0;i<9;i++)for(let o=0;o<9;o++)if(this.canPlace(e.shape,i,o))return!1}}return!0}endGame(){this.stopTimer(),this.finalScoreEl.textContent=this.score.toString(),this.score>=this.highScore&&this.score>0?document.getElementById("newHighScoreLabel").style.display="block":document.getElementById("newHighScoreLabel").style.display="none",document.getElementById("gameOverModal").classList.add("active"),this.sound.playGameOver(),localStorage.removeItem(g.storageKeys.gameState)}restart(){this.grid=Array(9).fill(null).map(()=>Array(9).fill(null)),this.score=0,this.moves=0,this.scoreEl.textContent="0",document.getElementById("gameOverModal").classList.remove("active"),this.spawnShapes(),this.saveState()}addScore(t){this.score+=t,this.scoreEl.textContent=this.score.toString(),this.score>this.highScore&&(this.highScore=this.score,this.highScoreEl.textContent=this.highScore.toString(),localStorage.setItem(g.storageKeys.highScore,this.highScore.toString()))}saveState(){if(this.timeLeft<=0)return;const t={grid:this.grid,hand:this.hand,score:this.score,mode:this.mode,timeLeft:this.timeLeft};localStorage.setItem(g.storageKeys.gameState,JSON.stringify(t))}loadState(){const t=localStorage.getItem(g.storageKeys.gameState);if(t)try{const e=JSON.parse(t);return this.grid=e.grid,this.hand=e.hand,this.score=e.score,this.mode=e.mode||"classic",this.timeLeft=e.timeLeft||120,this.scoreEl.textContent=this.score.toString(),!0}catch(e){return console.error(e),!1}return!1}loadHighScore(){const t=localStorage.getItem(g.storageKeys.highScore);t&&(this.highScore=parseInt(t),this.highScoreEl.textContent=this.highScore.toString())}loop(){this.fx.update(),this.draw(),requestAnimationFrame(()=>this.loop())}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const t=this.fx.getShake();this.ctx.save(),this.ctx.translate(t.x,t.y);const{gridX:e,gridY:i,gridSize:o,cellSize:s}=this.metrics;this.ctx.strokeStyle=g.colors.gridLine,this.ctx.lineWidth=1;for(let r=0;r<=9;r++)this.ctx.beginPath(),this.ctx.moveTo(e+r*s,i),this.ctx.lineTo(e+r*s,i+o),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e,i+r*s),this.ctx.lineTo(e+o,i+r*s),this.ctx.stroke();this.ctx.lineWidth=3,this.ctx.strokeStyle="#3a3a4a";for(let r=0;r<=3;r++)this.ctx.beginPath(),this.ctx.moveTo(e+r*s*3,i),this.ctx.lineTo(e+r*s*3,i+o),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e,i+r*s*3),this.ctx.lineTo(e+o,i+r*s*3),this.ctx.stroke();for(let r=0;r<9;r++)for(let h=0;h<9;h++){const d=this.grid[r][h];d&&(this.drawBlock(e+h*s,i+r*s,s,d.color,!1,d.ice,d.rock),d.bomb!==null&&(this.ctx.fillStyle=g.colors.bombText,this.ctx.font="bold 20px Inter",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(d.bomb.toString(),e+h*s+s/2,i+r*s+s/2),this.ctx.strokeStyle=g.colors.bomb,this.ctx.lineWidth=2,this.ctx.strokeRect(e+h*s+2,i+r*s+2,s-4,s-4)))}const l=this.canvas.width/3/(window.devicePixelRatio||1);for(let r=0;r<3;r++){const h=this.hand[r];if(h&&r!==this.dragIdx){const{shape:d,color:p}=h,m=d[0].length*(s*.6);d.length*(s*.6),this.drawShape(d,r*l+(l-m)/2,this.metrics.handY,s*.6,p)}}if(this.isDragging&&this.dragIdx!==-1){const r=this.hand[this.dragIdx];if(r){const{shape:h,color:d}=r,p=this.dragPos.x+this.dragOffset.x,m=this.dragPos.y+this.dragOffset.y,n=this.getGridPos(p,m,h);n&&this.canPlace(h,n.r,n.c)&&this.drawShape(h,e+n.c*s,i+n.r*s,s,g.colors.ghost);const c=h[0].length*s,f=h.length*s;this.drawShape(h,p-c/2+s/2,m-f/2+s/2,s,d,!0)}}this.fx.draw(this.ctx),this.ctx.restore()}drawShape(t,e,i,o,s,l=!1){for(let r=0;r<t.length;r++)for(let h=0;h<t[0].length;h++)t[r][h]&&this.drawBlock(e+h*o,i+r*o,o,s,l)}drawBlock(t,e,i,o,s,l=!1,r=!1){this.ctx.fillStyle=o,s&&(this.ctx.shadowColor=o,this.ctx.shadowBlur=15),this.ctx.fillRect(t+2,e+2,i-2*2,i-2*2),l&&(this.ctx.fillStyle="rgba(255, 255, 255, 0.4)",this.ctx.fillRect(t+2,e+2,i-2*2,i-2*2),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=2,this.ctx.strokeRect(t+2+2,e+2+2,i-2*2-4,i-2*2-4)),r&&(this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(t+2,e+2,i-2*2,i-2*2),this.ctx.fillStyle="#333",this.ctx.beginPath(),this.ctx.arc(t+i/2,e+i/2,i/4,0,Math.PI*2),this.ctx.fill()),this.ctx.shadowBlur=0}}window.onload=()=>{new b};localStorage.getItem("mobileView")==="true"&&(document.body.classList.add("iphone-view"),document.addEventListener("DOMContentLoaded",()=>{const u=document.getElementById("mobileToggle");u&&u.classList.add("active")}));
