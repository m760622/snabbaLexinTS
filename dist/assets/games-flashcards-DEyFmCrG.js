import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              *//* empty css              */import{s as l,a as $}from"./games-utils-BCKUWDty.js";import"./loader-dpivfNje.js";import{T as W}from"./tts-BZUKiY6M.js";import{TextSizeManager as O}from"./utils-Bk2xb2al.js";import{m as C}from"./mistakes-review-DLeHaHPD.js";import"./config-C2usAgi3.js";import"./i18n-D0OWfz62.js";import"./toast-manager-B6dAfcdf.js";import"./db-CDJvXXn2.js";console.log("flashcardsGame.ts LOADED - Professional Edition");let g=[],d=0,M=0,m=0,G=0,E={correct:0,wrong:0,totalTime:0},I=0,L=0,T=0,F=0,y=localStorage.getItem("fc_autoplay")!=="false";const b=0,N=1,f=2,X=3,q=7,Y=8,p={STORAGE_KEY:"flashcard_leitner_data",BOX_INTERVALS:[1,3,7,14,30],getData(){try{return JSON.parse(localStorage.getItem(this.STORAGE_KEY)||"{}")}catch{return{}}},saveData(e){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))},getWordBox(e){var n;return((n=this.getData()[e])==null?void 0:n.box)||1},promoteWord(e){var s;const t=this.getData(),n=((s=t[e])==null?void 0:s.box)||1,o=Math.min(n+1,5);return t[e]={box:o,lastReview:Date.now(),nextReview:Date.now()+this.BOX_INTERVALS[o-1]*24*60*60*1e3},this.saveData(t),o},demoteWord(e){const t=this.getData();return t[e]={box:1,lastReview:Date.now(),nextReview:Date.now()+24*60*60*1e3},this.saveData(t),1},getBoxIcon(e){const t=["â„ï¸","ğŸŒ±","ğŸŒ¿","ğŸŒ³","ğŸ”¥"];return t[e-1]||t[0]},getDueWords(){const e=this.getData(),t=Date.now();return Object.entries(e).filter(([,n])=>n.nextReview<=t).map(([n])=>n)}};function V(){const e=document.getElementById("flashcardsGame");if(!e)return;const t=["#3b82f6","#0ea5e9","#22c55e","#f59e0b","#ef4444"],n=50;for(let o=0;o<n;o++){const s=document.createElement("div");s.className="confetti-piece",s.style.cssText=`
            position: fixed;
            width: 10px;
            height: 10px;
            background: ${t[Math.floor(Math.random()*t.length)]};
            left: ${Math.random()*100}%;
            top: -10px;
            border-radius: ${Math.random()>.5?"50%":"2px"};
            animation: confettiFall ${2+Math.random()*2}s linear forwards;
            animation-delay: ${Math.random()*.5}s;
            z-index: 9999;
            pointer-events: none;
        `,e.appendChild(s),setTimeout(()=>s.remove(),2e3)}}function z(e=0){const n=new URLSearchParams(window.location.search).get("mode")==="review",o=document.getElementById("flashcardTypeFilter"),s=(o==null?void 0:o.value)||"all";if(typeof dictionaryData>"u"||!Array.isArray(dictionaryData)||dictionaryData.length===0){if(e<5)console.log(`Data not ready, retrying... (${e+1}/5)`),typeof l=="function"&&e===0&&l("Laddar data... / Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...","default"),setTimeout(()=>z(e+1),500);else{console.error("dictionaryData failed to load."),typeof l=="function"&&l("Kunde inte ladda data. Kontrollera din anslutning. / ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.","error");const a=document.getElementById("flashcardWord");a&&(a.innerHTML='<span style="color:red; font-size: 1rem;">Datafel / Error</span>')}return}try{let a=[...dictionaryData];if(n){const r=C.getMistakes();if(r.length>0){const h=new Set(r.map(i=>i.word));g=a.filter(i=>i&&i[f]&&h.has(i[f]));const u=new Map(r.map(i=>[i.word,i.attempts]));if(g.sort((i,S)=>(u.get(S[f])||0)-(u.get(i[f])||0)),g.length===0){typeof l=="function"&&l("Kunde inte hitta dina fel i databasen.","error");return}}else{typeof l=="function"&&l("Inga fel att repetera! / Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©!","default");return}}else{if(s!=="all"&&(a=a.filter(r=>r?(r[N]||"").toLowerCase().includes(s):!1)),a=a.filter(r=>r&&r[f]&&r[f].length>0),a.length===0){console.warn("No words found for filter:",s),typeof l=="function"&&l("Inga ord hittades fÃ¶r detta filter.","error");return}a.sort((r,h)=>{const u=p.getWordBox(String(r[b])),i=p.getWordBox(String(h[b]));return u-i}),g=a.sort(()=>.5-Math.random()).slice(0,50)}d=0,M=0,m=g.length,E={correct:0,wrong:0,totalTime:0};const c=document.getElementById("flashcardsGame");c&&c.style.display!=="block"&&(c.style.display="block"),A(0),J();const w=document.getElementById("flashcardProgress");w&&(w.textContent=`0/${m}`);const x=document.getElementById("flashcard");x&&x.classList.remove("flipped"),U(),R(),ne(),console.log("Flashcards initialized successfully with",m,"cards.")}catch(a){console.error("Critical error starting Flashcards:",a),typeof l=="function"&&l("Ett fel uppstod. / Ø­Ø¯Ø« Ø®Ø·Ø£.","error")}}function J(){const e=document.getElementById("fcSegmentedProgress");if(e){e.innerHTML="";for(let t=0;t<m;t++){const n=document.createElement("div");n.className="fc-progress-segment",n.id=`fc-seg-${t}`,e.appendChild(n)}}}function k(e,t){const n=document.getElementById(`fc-seg-${e}`);n&&(document.querySelectorAll(".fc-progress-segment").forEach(o=>o.classList.remove("active")),t?(n.classList.add("completed"),n.classList.add(t)):n.classList.add("active"))}function A(e){const t=document.querySelector(".fc-progress-ring-circle");if(!t)return;const n=2*Math.PI*45,o=n-e/100*n;t.style.strokeDashoffset=String(o)}function U(){const e=document.getElementById("flashcard");e&&(e.addEventListener("touchstart",t=>{I=t.changedTouches[0].screenX,L=I,T=Date.now()},{passive:!0}),e.addEventListener("touchmove",t=>{L=t.changedTouches[0].screenX;const n=L-I;Math.abs(n)>30&&(e.style.transform=`translateX(${n*.3}px) rotate(${n*.02}deg)`,e.style.opacity=String(Math.max(.5,1-Math.abs(n)/500)))},{passive:!0}),e.addEventListener("touchend",()=>{const t=L-I,n=Date.now()-T;e.style.transform="",e.style.opacity="",Math.abs(t)>100?(typeof HapticManager<"u"&&HapticManager.trigger("medium"),t>0?D(4):D(0)):Math.abs(t)<30&&n<500&&P()}),e.addEventListener("click",()=>{Date.now()-F<300||T>0&&Date.now()-T<500||P()}))}function P(){if(Date.now()-F<300)return;F=Date.now();const e=document.getElementById("flashcard");e&&(e.classList.toggle("flipped"),typeof HapticManager<"u"&&HapticManager.trigger("selection"),typeof SoundManager<"u"&&SoundManager.play("flip"))}function R(){if(d>=g.length){te();return}const e=g[d],t=e[f]||"",n=e[X]||"",o=e[q]||"",s=e[N]||"",a=String(e[b]),c=p.getWordBox(a);G=Date.now(),k(d,null);const w=document.getElementById("flashcardWord");w&&(w.textContent=t,typeof O<"u"&&O.apply(w,t,1,1.6));const x=document.getElementById("flashcardTranslation");x&&(x.textContent=n);const r=document.getElementById("flashcardMastery");r&&(r.innerHTML=`${p.getBoxIcon(c)} Box ${c}`);const h=document.getElementById("flashcardType");h&&(h.textContent=s);const u=document.getElementById("flashcard");u&&(c>=5?u.classList.add("shimmering"):u.classList.remove("shimmering"));const i=document.getElementById("flashcardBackWord");i&&(i.textContent=t);const S=document.getElementById("flashcardBackSentence");S&&(o?(S.textContent=o,S.style.display="block"):S.style.display="none");const H=e[Y]||"",v=document.getElementById("flashcardExampleArb");v&&(H?(v.textContent=H,v.style.display="block"):v.style.display="none");const j=d/m*100;A(j);const _=document.getElementById("flashcardProgress");_&&(_.textContent=`${d+1}/${m}`);const B=document.getElementById("flashcard");B&&(B.classList.remove("flipped"),B.classList.remove("swiping-left","swiping-right","slide-out-right","slide-out-left"),B.style.transform="",B.style.opacity=""),setTimeout(()=>{typeof W<"u"&&y&&W.speak(t,"sv")},500),setTimeout(Q,50)}function Q(){const e=document.querySelector(".fc-front-pro"),t=document.querySelector(".fc-back-pro"),n=document.getElementById("flashcard");if(!e||!t||!n)return;const o=e.scrollHeight,s=t.scrollHeight,a=Math.max(o,s,320);n.style.height=`${a}px`}function Z(){y=!y,localStorage.setItem("fc_autoplay",String(y)),K(),typeof l=="function"&&l(y?"Auto-play: PÃ… ğŸ”Š":"Auto-play: AV ğŸ”‡")}function K(){const e=document.getElementById("fcAutoPlayToggle");e&&(e.textContent=y?"ğŸ”Š":"ğŸ”‡",e.classList.toggle("muted",!y))}function D(e){try{console.log("HandleRating CALLED with:",e),ee(e)}catch(t){console.error("CRITICAL ERROR in handleFlashcardRating:",t)}}function ee(e){const t=g[d];if(!t){console.error("No card found at index",d);return}const n=String(t[b]),o=Date.now()-G;if(E.totalTime+=o,e>=3?(p.promoteWord(n),C.markAsLearned(t[f]),M++,E.correct++,typeof HapticManager<"u"&&HapticManager.trigger("success"),typeof SoundManager<"u"&&SoundManager.play("success"),k(d,"correct"),p.getWordBox(n)):(p.demoteWord(n),C.addMistake({word:t[f],translation:t[X],game:"flashcards"}),E.wrong++,typeof HapticManager<"u"&&HapticManager.trigger("error"),typeof SoundManager<"u"&&SoundManager.play("error"),k(d,"wrong")),e===0&&typeof FavoritesManager<"u"){const a=String(n);FavoritesManager.isFavorite(a)||FavoritesManager.toggle(a)}const s=document.getElementById("flashcard");if(s){const a=s.classList.contains("flipped");let c="";a?c=e>=3?"slide-out-right":"slide-out-left":c=e>=3?"slide-out-right-front":"slide-out-left-front",s.classList.add(c),setTimeout(()=>{s.classList.remove("slide-out-right","slide-out-left","slide-out-right-front","slide-out-left-front"),d++,R()},300)}else d++,R()}function te(){const e=Math.round(M/m*100),t=Math.round(E.totalTime/m/1e3);e>=70&&(V(),typeof HapticManager<"u"&&HapticManager.trigger("success"),typeof SoundManager<"u"&&SoundManager.play("success"));const n=document.getElementById("flashcard");n&&(n.classList.remove("flipped"),n.onclick=null);const o=document.getElementById("flashcardWord");o&&(o.innerHTML=`
            <span style="font-size: 3rem;">${e>=80?"ğŸ†":e>=60?"ğŸ‘":"ğŸ’ª"}</span>
            <div style="font-size: 2.5rem; font-weight: 700; margin-top: 0.5rem;">${e}%</div>
        `);const s=document.getElementById("flashcardTranslation");s&&(s.innerHTML=`
            <div style="margin-bottom: 1rem;">Du kunde ${M} av ${m} ord!</div>
            <div style="display: flex; gap: 1rem; justify-content: center; font-size: 0.9rem;">
                <span>âœ… ${E.correct}</span>
                <span>âŒ ${E.wrong}</span>
                <span>â±ï¸ ${t}s/kort</span>
            </div>
        `);const a=document.getElementById("flashcardExample");a&&(a.innerHTML=`
            <div style="margin-top: 1rem; display: flex; gap: 0.5rem; justify-content: center;">
                <button onclick="initFlashcards()" class="fc-action-btn">ğŸ”„ Igen</button>
                <button onclick="showGameMenu()" class="fc-action-btn secondary">ğŸ  Meny</button>
            </div>
        `,a.style.display="block");const c=document.getElementById("flashcardRatingBtns");c&&(c.style.display="none"),A(100),typeof $=="function"&&$("flashcards",M),typeof updateGamesStats=="function"&&updateGamesStats(e>=70,M),ae()}function ne(){const e=document.getElementById("flashcardsGame");e&&window.innerWidth<768&&e.classList.add("fullscreen-mode")}function ae(){const e=document.getElementById("flashcardsGame");e&&e.classList.remove("fullscreen-mode")}document.addEventListener("DOMContentLoaded",K);window.initFlashcards=z;window.handleFlashcardResult=D;window.handleFlashcardRating=D;window.LeitnerSystem=p;window.toggleAutoPlay=Z;
