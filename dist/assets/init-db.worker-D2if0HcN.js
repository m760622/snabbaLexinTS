(function(){"use strict";const n={DEBUG_MODE:!1,DATA_VERSION:"2026.01.12.1",DB_NAME:"snabba-lexin-db",DB_VERSION:2,DATA_PATH:{root:"/data/data.csv",games:"/data/data.json"},COLUMNS:{ID:0,TYPE:1,SWEDISH:2,ARABIC:3,ARABIC_EXT:4,DEFINITION:5,FORMS:6,EXAMPLE_SWE:7,EXAMPLE_ARB:8,IDIOM_SWE:9,IDIOM_ARB:10},SPLASH:{MIN_DISPLAY_TIME:2e3,TIP_ROTATION_INTERVAL:3e3},STORAGE_KEYS:{THEME:"theme",MOBILE_VIEW:"mobileView",FAVORITES:"favorites",WORD_ASSESSMENTS:"wordAssessments",SEARCH_HISTORY:"searchHistory"},LOADING_TIPS:["üí° Visste du? Du kan s√∂ka p√• b√•de svenska och arabiska!","üéÆ Prova v√•ra l√§randespel f√∂r att √∂va ordf√∂rr√•det!","‚≠ê Spara dina favoritord f√∂r snabb √•tkomst!","üîä Tryck p√• h√∂gtalarikonen f√∂r att h√∂ra uttalet!","üì± Installera appen f√∂r offline-anv√§ndning!","üåô ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä ŸÖÿ™ÿßÿ≠ ŸÅŸä ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™!","üìù ŸäŸÖŸÉŸÜŸÉ ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸÑŸÖÿßÿ™ŸÉ ÿßŸÑÿÆÿßÿµÿ©!"]},E={log:(...e)=>n.DEBUG_MODE&&console.log(...e),warn:(...e)=>n.DEBUG_MODE&&console.warn(...e),error:(...e)=>console.error(...e),info:(...e)=>n.DEBUG_MODE&&console.info(...e)};typeof window<"u"&&(window.AppConfig=n,window.Logger=E);const c={DB_NAME:n.DB_NAME,DB_VERSION:n.DB_VERSION,STORE_NAME:"words",META_STORE:"meta",NOTES_STORE:"notes",db:null,isReady:!1,async init(){return this.db?!0:new Promise((e,o)=>{const r=indexedDB.open(this.DB_NAME,this.DB_VERSION);r.onerror=t=>{console.error("[DB] Error opening database:",t.target.error),o(t.target.error)},r.onsuccess=t=>{this.db=t.target.result,this.isReady=!0,console.log("[DB] Database opened successfully"),e(!0)},r.onupgradeneeded=t=>{const s=t.target.result;if(!s.objectStoreNames.contains(this.STORE_NAME)){const a=s.createObjectStore(this.STORE_NAME,{keyPath:"id"});a.createIndex("swedish","swe",{unique:!1}),a.createIndex("arabic","arb",{unique:!1}),a.createIndex("type","type",{unique:!1}),console.log("[DB] Words store created")}s.objectStoreNames.contains(this.META_STORE)||(s.createObjectStore(this.META_STORE,{keyPath:"key"}),console.log("[DB] Meta store created")),s.objectStoreNames.contains(this.NOTES_STORE)||(s.createObjectStore(this.NOTES_STORE,{keyPath:"id"}),console.log("[DB] Notes store created"))}})},async getDataVersion(){return this.db||await this.init(),this.db?new Promise(e=>{try{const t=this.db.transaction([this.META_STORE],"readonly").objectStore(this.META_STORE).get("dataVersion");t.onsuccess=()=>{var s;e(((s=t.result)==null?void 0:s.value)||null)},t.onerror=()=>e(null)}catch{e(null)}}):null},async setDataVersion(e){return this.db||await this.init(),this.db?new Promise((o,r)=>{const t=this.db.transaction([this.META_STORE],"readwrite");t.objectStore(this.META_STORE).put({key:"dataVersion",value:e}),t.oncomplete=()=>o(!0),t.onerror=a=>r(a)}):!1},async getWordCount(){return this.db||await this.init(),this.db?new Promise(e=>{try{const t=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).count();t.onsuccess=()=>e(t.result),t.onerror=()=>e(0)}catch{e(0)}}):0},async saveWords(e,o=null){this.db||await this.init();const r=1e3,t=Math.ceil(e.length/r);console.log(`[DB] Saving ${e.length} words in ${t} batches...`);for(let s=0;s<t;s++){const a=s*r,i=Math.min(a+r,e.length),d=e.slice(a,i);if(await this._saveBatch(d),o){const h=Math.round((s+1)/t*100);o(h)}}return console.log("[DB] All words saved successfully"),!0},async _saveBatch(e){return this.db?new Promise((o,r)=>{const t=this.db.transaction([this.STORE_NAME],"readwrite"),s=t.objectStore(this.STORE_NAME);e.forEach(a=>{const i={id:a[n.COLUMNS.ID],type:a[n.COLUMNS.TYPE],swe:a[n.COLUMNS.SWEDISH],arb:a[n.COLUMNS.ARABIC],arbExt:a[n.COLUMNS.ARABIC_EXT],sweDef:a[n.COLUMNS.DEFINITION],forms:a[n.COLUMNS.FORMS],sweEx:a[n.COLUMNS.EXAMPLE_SWE],arbEx:a[n.COLUMNS.EXAMPLE_ARB],idiomSwe:a[n.COLUMNS.IDIOM_SWE],idiomArb:a[n.COLUMNS.IDIOM_ARB],raw:a};s.put(i)}),t.oncomplete=()=>o(!0),t.onerror=a=>r(a)}):!1},async getAllWords(e=null){return this.db||await this.init(),this.db?new Promise((o,r)=>{const a=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).getAll();a.onsuccess=()=>{const i=a.result.map(d=>d.raw);e&&e(100),console.log(`[DB] Retrieved ${i.length} words from cache`),o(i)},a.onerror=i=>{console.error("[DB] Error getting words:",i),r(i)}}):[]},async hasCachedData(){return await this.getWordCount()>0},async clearCache(){return this.db||await this.init(),this.db?new Promise((e,o)=>{const r=this.db.transaction([this.STORE_NAME,this.META_STORE],"readwrite");r.objectStore(this.STORE_NAME).clear(),r.objectStore(this.META_STORE).clear(),r.oncomplete=()=>{console.log("[DB] Cache cleared"),e(!0)},r.onerror=t=>o(t)}):!1},async getWordById(e){return this.db||await this.init(),this.db?new Promise(o=>{try{const s=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).get(e);s.onsuccess=()=>{s.result&&s.result.raw?o(s.result.raw):o(null)},s.onerror=()=>o(null)}catch(r){console.error("[DB] getWordById error:",r),o(null)}}):null},async saveWord(e){return this.db||await this.init(),this.db?new Promise((o,r)=>{const t=this.db.transaction([this.STORE_NAME],"readwrite");t.objectStore(this.STORE_NAME).put(e),t.oncomplete=()=>o(!0),t.onerror=a=>r(a)}):!1},async deleteWord(e){return this.db||await this.init(),this.db?new Promise((o,r)=>{const t=this.db.transaction([this.STORE_NAME],"readwrite");t.objectStore(this.STORE_NAME).delete(e),t.oncomplete=()=>o(!0),t.onerror=a=>r(a)}):!1},async getNote(e){return this.db||await this.init(),this.db?new Promise(o=>{try{const s=this.db.transaction([this.NOTES_STORE],"readonly").objectStore(this.NOTES_STORE).get(e);s.onsuccess=()=>{var a;o(((a=s.result)==null?void 0:a.text)||null)},s.onerror=()=>o(null)}catch{o(null)}}):null},async saveNote(e,o){return this.db||await this.init(),this.db?new Promise((r,t)=>{const s=this.db.transaction([this.NOTES_STORE],"readwrite");s.objectStore(this.NOTES_STORE).put({id:e,text:o,updatedAt:Date.now()}),s.oncomplete=()=>r(!0),s.onerror=i=>t(i)}):!1}},u={async loadDictionary(e=null,o=null){try{await c.init();const r=await c.getDataVersion();if(await c.hasCachedData()&&r===n.DATA_VERSION)return o&&o("Laddar fr√•n cache... / ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÜ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ©..."),console.log("[DataLoader] Using cached data (version:",r,")"),await c.getAllWords(e);o&&o("Laddar ordbok... / ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇÿßŸÖŸàÿ≥..."),console.log("[DataLoader] Loading fresh data from data.js");const s=window.dictionaryData;if(typeof s>"u"||!s.length)throw new Error("dictionaryData not loaded from data.js");return o&&o("Sparar i cache... / ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ≠ŸÅÿ∏..."),await c.saveWords(s,e),await c.setDataVersion(n.DATA_VERSION),console.log("[DataLoader] Data cached successfully"),s}catch(r){console.error("[DataLoader] Error:",r);const t=window.dictionaryData;if(typeof t<"u")return t;throw r}},async refreshCache(e=null){return await c.clearCache(),this.loadDictionary(e)}};typeof window<"u"&&(window.DictionaryDB=c,window.DataLoader=u,window.DATA_VERSION=n.DATA_VERSION),self.onmessage=async e=>{const{type:o,url:r}=e.data;if(o==="init")try{const t=r;l(5,"Laddar data (CSV)... / ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...");const s=await fetch(t);if(!s.ok)throw new Error(`HTTP ${s.status}`);l(20,"L√§ser data... / ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...");const a=await s.text();l(30,"Bearbetar CSV... / ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...");const i=S(a);l(40,"Sparar data... / ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ≠ŸÅÿ∏..."),await c.init(),await c.saveWords(i,d=>{const h=40+d*.55;l(h,"Sparar data... / ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ≠ŸÅÿ∏...")}),await c.setDataVersion(n.DATA_VERSION),postMessage({type:"complete"})}catch(t){postMessage({type:"error",error:t.message||"Unknown error"})}};function l(e,o){postMessage({type:"progress",value:e,status:o})}function S(e){const o=[];let r=[],t="",s=!1;e=e.replace(/\r\n/g,`
`);for(let a=0;a<e.length;a++){const i=e[a],d=e[a+1];s?i==='"'?d==='"'?(t+='"',a++):s=!1:t+=i:i==='"'?s=!0:i===","?(r.push(t),t=""):i===`
`?(r.push(t),(r.length>1||r[0]!=="")&&o.push(r),r=[],t=""):t+=i}return(t||r.length>0)&&(r.push(t),o.push(r)),o}})();
