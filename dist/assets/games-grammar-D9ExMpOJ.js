import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              *//* empty css              */import"./games-utils-HTOXTqfV.js";console.log("grammarGame.ts LOADED");let k=[],E=[],B=0,t=null,u=[],L=!1;const M={"word-order":"wordOrder","v2-rule":"v2Rule",questions:"questions",adverbs:"wordOrder","time-manner-place":"wordOrder",bisatser:"wordOrder",possessiva:"pronouns",prepositioner:"prepositions",passiv:"verbs",imperativ:"verbs",komparativ:"adjectives"};function T(){if(typeof grammarDatabase<"u"&&grammarDatabase){console.log("ğŸ“š Loading grammar rules from Static Database..."),u=[];for(const[r,s]of Object.entries(grammarDatabase))s.forEach(e=>{u.push({category:r,...e})});L=!0,console.log(`âœ… Loaded ${u.length} grammar rules from Static Database`)}else console.error("âŒ grammarDatabase not found! Grammar game will not work.")}function v(r=0){if(!L||u.length===0){T(),r<10?(console.warn(`Rules not ready for Grammar Game. Retrying (${r+1}/10)...`),typeof showToast=="function"&&showToast("Laddar grammatik... / Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯...","info"),setTimeout(()=>v(r+1),500)):(console.error("Critical: Failed to load grammar rules."),typeof showToast=="function"&&showToast("Kunde inte ladda speldata. / ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.","error"));return}const s=document.getElementById("grammarHint"),e=document.getElementById("grammarDropZone"),i=document.getElementById("grammarWordBank"),o=document.getElementById("grammarFeedback"),c=document.getElementById("grammarExplanation"),d=document.getElementById("nextGrammarBtn"),g=document.getElementById("checkGrammarBtn"),f=document.getElementById("grammarShowAnswerBtn");if(!s||!e||!i||!o||!c||!d||!g)return;e.innerHTML='<div class="gr-drop-placeholder"><span class="gr-drop-icon">â¬‡ï¸</span><span>Dra ord hit / Ø§Ø³Ø­Ø¨ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù‡Ù†Ø§</span></div>',i.innerHTML="",o.textContent="",o.className="gr-feedback",c.classList.add("hidden");const h=c.querySelector(".gr-explanation-content");h&&(h.innerHTML=""),d.classList.add("hidden"),g.classList.remove("hidden"),g.disabled=!1,f&&(f.classList.remove("hidden"),f.disabled=!1),e.classList.remove("correct","wrong"),E=[];const p=document.getElementById("grammarCategoryFilter"),y=(p==null?void 0:p.value)||"all";let l=u;if(y!=="all"&&(l=u.filter(a=>a.category===y)),l.length===0){const a=s.querySelector(".gr-hint-text");a&&(a.textContent="Inga regler hittades / Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‚ÙˆØ§Ø¹Ø¯");return}t=l[Math.floor(Math.random()*l.length)],k=t.correct;const x=s.querySelector(".gr-hint-text");x?x.textContent=t.hint:s.textContent=t.hint,[...t.words].sort(()=>Math.random()-.5).forEach((a,w)=>{const n=document.createElement("div");n.className="gr-word-chip animate-in",n.style.animationDelay=`${w*.1}s`,n.textContent=a,n.dataset.word=a,n.dataset.id=String(w),n.onclick=()=>{if(typeof soundManager<"u"&&(soundManager!=null&&soundManager.playClick)&&soundManager.playClick(),n.parentElement===i){const m=e.querySelector(".gr-drop-placeholder");m&&m.remove(),e.appendChild(n),n.classList.add("in-zone"),E.push(a)}else{i.appendChild(n),n.classList.remove("in-zone");const m=E.indexOf(a);m>-1&&E.splice(m,1),e.children.length===0&&(e.innerHTML='<div class="gr-drop-placeholder"><span class="gr-drop-icon">â¬‡ï¸</span><span>Dra ord hit / Ø§Ø³Ø­Ø¨ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù‡Ù†Ø§</span></div>')}},i.appendChild(n)}),g.onclick=()=>{const a=Array.from(e.querySelectorAll(".gr-word-chip")).map(n=>n.textContent).join(" "),w=k.join(" ");if(a===w&&t){o.textContent="Helt rÃ¤tt! ğŸŒŸ / ØµØ­ÙŠØ­ ØªÙ…Ø§Ù…Ø§Ù‹!",o.className="gr-feedback success",e.classList.add("correct"),B+=20;const n=document.getElementById("grammarScore");n&&(n.textContent=String(B)),typeof saveScore=="function"&&saveScore("grammar",B),typeof soundManager<"u"&&(soundManager!=null&&soundManager.playSuccess)&&soundManager.playSuccess();const m=k.join(" "),S=c.querySelector(".gr-explanation-content");S&&(S.innerHTML=`
                    <strong>âœ“ Korrekt!</strong>
                    <button class="grammar-listen-btn" onclick="speakSentence('${m.replace(/'/g,"\\'")}')" style="background:none; border:none; cursor:pointer; font-size:1.5rem; float:right; filter: drop-shadow(0 0 5px rgba(34,211,238,0.5));">ğŸ”Š</button>
                    <br>${t.explanation}<br>
                    <span style="direction: rtl; display: block; margin-top: 0.5rem; color: #a7f3d0;">${t.explanationAr||""}</span>
                `),c.classList.remove("hidden"),d.classList.remove("hidden"),g.classList.add("hidden")}else o.textContent="Inte riktigt... FÃ¶rsÃ¶k igen! / Ù„ÙŠØ³ ØªÙ…Ø§Ù…Ø§Ù‹...",o.className="gr-feedback error",e.classList.add("wrong"),typeof soundManager<"u"&&(soundManager!=null&&soundManager.playError)&&soundManager.playError(),setTimeout(()=>e.classList.remove("wrong"),500)},d.onclick=()=>v()}function C(r){typeof TTSManager<"u"&&TTSManager?TTSManager.speak(r):console.warn("TTSManager not found")}function I(){const r=document.getElementById("grammarDropZone"),s=document.getElementById("grammarWordBank"),e=document.getElementById("grammarFeedback"),i=document.getElementById("grammarExplanation"),o=document.getElementById("nextGrammarBtn"),c=document.getElementById("checkGrammarBtn"),d=document.getElementById("grammarShowAnswerBtn");if(!t||!r||!s||!e||!i||!o)return;r.innerHTML="",k.forEach((l,x)=>{const b=document.createElement("div");b.className="gr-word-chip in-zone animate-in",b.style.animationDelay=`${x*.1}s`,b.textContent=l,r.appendChild(b)}),s.querySelectorAll(".gr-word-chip").forEach(l=>{l.style.opacity="0.4",l.style.pointerEvents="none"}),e.textContent="HÃ¤r Ã¤r rÃ¤tt svar! / Ø¥Ù„ÙŠÙƒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©!",e.className="gr-feedback";const f=k.join(" "),h=M[t.category];let p="";h&&(p=`<a href="learn.html?lesson=${h}" class="learn-link-btn" style="display:inline-block; margin-top:10px; padding:8px 16px; background: linear-gradient(145deg, rgba(34, 211, 238, 0.3), rgba(6, 182, 212, 0.2)); color:#67e8f9; border-radius:12px; text-decoration:none; font-size:0.9rem; border: 1px solid rgba(34, 211, 238, 0.4);">ğŸ“– LÃ¤s regeln / Ø§Ù‚Ø±Ø£ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©</a>`);const y=i.querySelector(".gr-explanation-content");y&&(y.innerHTML=`
            <strong>â„¹ï¸ FÃ¶rklaring:</strong>
            <button class="grammar-listen-btn" onclick="speakSentence('${f.replace(/'/g,"\\'")}')" style="background:none; border:none; cursor:pointer; font-size:1.5rem; float:right; filter: drop-shadow(0 0 5px rgba(34,211,238,0.5));">ğŸ”Š</button>
            <br>${t.explanation}<br>
            <span style="direction: rtl; display: block; margin-top: 0.5rem; color: #a7f3d0;">${t.explanationAr||""}</span>
            ${p}
        `),i.classList.remove("hidden"),o.classList.remove("hidden"),c&&(c.disabled=!0),d&&(d.disabled=!0)}T();window.startGrammarGame=v;window.showGrammarAnswer=I;window.speakSentence=C;
