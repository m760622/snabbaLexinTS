var ct=Object.defineProperty;var lt=(p,t,e)=>t in p?ct(p,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[t]=e;var u=(p,t,e)=>lt(p,typeof t!="symbol"?t+"":t,e);import"./modulepreload-polyfill-B5Qt9EMX.js";import"./config-CfHoVMbv.js";import{D as z}from"./db-bEbbjtoI.js";import{showToast as q,ThemeManager as dt,CategoryHelper as pt,GrammarHelper as ut,TextSizeManager as X}from"./utils-DkwAXeNx.js";import{T as P}from"./tts-BuOrQ7kI.js";import{Q as at,F as _}from"./quiz-stats-C6Jzjky6.js";import{a as b,L as Z,t as W}from"./i18n-1qhfGv7S.js";import{A as ht,P as nt,H as J,C as mt,M as gt}from"./ui-enhancements-sg46XY7N.js";import"./pwa-Bxh5GLjF.js";import"./toast-manager-CZ3snF2j.js";const ft=[{patter:/sj|stj|skj/i,tip:{sv:"Sj-ljudet: Forma lÃ¤pparna som om du ska vissla och blÃ¥s ut.",ar:"ØµÙˆØª Ø§Ù„Ù€ Sj: Ø´ÙƒÙ„ Ø´ÙØ§Ù‡Ùƒ ÙƒØ£Ù†Ùƒ Ø³ØªØµÙØ± ÙˆØ§Ø®Ø±Ø¬ Ø§Ù„Ù‡ÙˆØ§Ø¡ (ØµÙˆØª ÙŠØ´Ø¨Ù‡ Ø§Ù„Ø¹Ø·Ø³ Ø§Ù„Ø®ÙÙŠÙ)."},example:"sju, stjÃ¤rna, skjorta"},{patter:/Ã¶/i,tip:{sv:"Ã–: Som 'i' men med runda lÃ¤ppar. TÃ¤nk pÃ¥ 'hurt' pÃ¥ engelska.",ar:"Ø­Ø±Ù Ã–: ÙŠØ´Ø¨Ù‡ ØµÙˆØª Ø­Ø±Ù 'i' ÙˆÙ„ÙƒÙ† Ù…Ø¹ ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø´ÙØ§Ù‡ (Ù…Ø«Ù„ ØµÙˆØª ÙƒÙ„Ù…Ø© hurt Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©)."},example:"Ã¶ga, dÃ¶rr"},{patter:/y/i,tip:{sv:"Y: Som 'i' men med lÃ¤pparna lÃ¥ngt framÃ¥t.",ar:"Ø­Ø±Ù Y: Ø§Ù†Ø·Ù‚ Ø­Ø±Ù 'i' ÙˆÙ„ÙƒÙ† Ù…Ø¹ Ø¯ÙØ¹ Ø§Ù„Ø´ÙØªÙŠÙ† Ù„Ù„Ø£Ù…Ø§Ù… Ø¨Ø­Ø¯Ø©."},example:"ny, lyssna"},{patter:/r/i,tip:{sv:"R: Rullande r i bÃ¶rjan av ord, men mjukare efter vokal.",ar:"Ø­Ø±Ù R: ÙŠÙƒÙˆÙ† 'Ù…Ø±ÙØ±ÙØ§Ù‹' ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙƒÙ„Ù…Ø§ØªØŒ ÙˆÙŠØµØ¨Ø­ Ù†Ø§Ø¹Ù…Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ Ø¥Ø°Ø§ Ø¬Ø§Ø¡ Ø¨Ø¹Ø¯ Ø­Ø±Ù Ø¹Ù„Ø©."},example:"rÃ¶d, barn"}],tt={splitIntoSyllables(p){const t="aeiouyÃ¥Ã¤Ã¶",e=[];let s="";for(let a=0;a<p.length;a++)s+=p[a],t.includes(p[a].toLowerCase())&&a+2<p.length&&!t.includes(p[a+1].toLowerCase())&&t.includes(p[a+2].toLowerCase())&&(e.push(s),s=""),a>0&&p[a]===p[a-1]&&!t.includes(p[a].toLowerCase())&&(e.push(s),s="");return s&&e.push(s),e},getTipsForWord(p){return ft.filter(t=>t.patter.test(p))}};typeof window<"u"&&(window.PronunciationHelper=tt);class vt{static spawn(t,e){for(let a=0;a<15;a++){const n=document.createElement("div");n.innerHTML="â¤ï¸",n.className="heart-particle";const i=(Math.random()-.5)*100;n.style.left=t+"px",n.style.top=e+"px",n.style.setProperty("--tx",`${i}px`);const r=.5+Math.random()*1;n.style.transform=`scale(${r})`,document.body.appendChild(n),setTimeout(()=>n.remove(),1e3)}}}class C{static init(t){this.currentWord=t;try{this.visualizer||(this.visualizer=new ht("audioVisualizerContainer","#2dd4bf"),this.visualizer.setMode("liquid")),this.recorder||(this.recorder=new nt),this.setupEvents(),this.setupPracticeLevels(),this.renderStaticInfo(),this.initSpeechRecognition()}catch(e){console.warn("PronunciationLab init failed:",e)}}static setupPracticeLevels(){const t=document.getElementById("practiceLevelsContainer");t&&(t.innerHTML=`
            <div class="practice-levels">
                <button class="practice-level-btn active" data-level="listen">
                    <span class="practice-level-icon">ğŸ‘‚</span>
                    <span class="sv-text">Lyssna</span><span class="ar-text">Ø§Ø³ØªÙ…Ø¹</span>
                </button>
                <button class="practice-level-btn" data-level="repeat">
                    <span class="practice-level-icon">ğŸ”</span>
                    <span class="sv-text">Upprepa</span><span class="ar-text">ÙƒØ±Ø±</span>
                </button>
                <button class="practice-level-btn" data-level="challenge">
                    <span class="practice-level-icon">ğŸ¯</span>
                    <span class="sv-text">Utmaning</span><span class="ar-text">ØªØ­Ø¯ÙŠ</span>
                </button>
            </div>
        `,t.querySelectorAll(".practice-level-btn").forEach(e=>{e.addEventListener("click",()=>{t.querySelectorAll(".practice-level-btn").forEach(s=>s.classList.remove("active")),e.classList.add("active"),this.currentLevel=e.dataset.level,this.updateUIForLevel()})}))}static updateUIForLevel(){const t=document.getElementById("pronounceNormalBtn"),e=document.getElementById("recordingSection"),s=document.getElementById("modeInstruction");this.currentLevel==="listen"?(t==null||t.classList.remove("hidden"),e==null||e.classList.add("hidden"),s&&(s.innerHTML='<span class="sv-text">Lyssna noga pÃ¥ uttalet.</span><span class="ar-text">Ø§Ø³ØªÙ…Ø¹ Ø¬ÙŠØ¯Ø§Ù‹ Ù„Ù„Ù†Ø·Ù‚ Ø§Ù„ØµØ­ÙŠØ­.</span>')):this.currentLevel==="repeat"?(t==null||t.classList.remove("hidden"),e==null||e.classList.remove("hidden"),s&&(s.innerHTML='<span class="sv-text">Lyssna fÃ¶rst, spela sedan in.</span><span class="ar-text">Ø§Ø³ØªÙ…Ø¹ Ø£ÙˆÙ„Ø§Ù‹ØŒ Ø«Ù… Ø³Ø¬Ù„ ØµÙˆØªÙƒ.</span>')):(t==null||t.classList.add("hidden"),e==null||e.classList.remove("hidden"),s&&(s.innerHTML='<span class="sv-text">Kan du ordet? Spela in direkt!</span><span class="ar-text">Ù‡Ù„ ØªØ¹Ø±Ù Ø§Ù„ÙƒÙ„Ù…Ø©ØŸ Ø³Ø¬Ù„Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©!</span>'))}static setupEvents(){const t=document.getElementById("pronounceNormalBtn"),e=document.getElementById("recordBtn"),s=document.getElementById("playRecordedBtn"),a=document.getElementById("ttsSpeedSlider"),n=document.getElementById("speedValue"),i=document.getElementById("speedValueAr");if(a){const r=P.getSpeed();a.value=r.toString(),n&&(n.textContent=`${r}x`),i&&(i.textContent=`${r}x`),a.addEventListener("input",l=>{const o=parseFloat(l.target.value);P.setSpeed(o),n&&(n.textContent=`${o}x`),i&&(i.textContent=`${o}x`)})}t==null||t.addEventListener("click",()=>{J.light(),P.speakSwedish(this.currentWord)}),e==null||e.addEventListener("click",()=>this.toggleRecording()),s==null||s.addEventListener("click",async()=>{J.light();const r=this.lastRecordedBlob;r&&nt.playBlob(r)}),window.addEventListener("tts-start",()=>{var r,l;(r=this.visualizer)==null||r.start(),this.updateKaraokeActive(!0),(l=document.getElementById("audioVisualizerContainer"))==null||l.classList.add("active"),this.startSyllableHighlight()}),window.addEventListener("tts-end",()=>{var r,l;(r=this.visualizer)==null||r.stop(),this.updateKaraokeActive(!1),(l=document.getElementById("audioVisualizerContainer"))==null||l.classList.remove("active"),this.stopSyllableHighlight()}),window.addEventListener("tts-boundary",r=>{this.highlightWord(r.detail.word)})}static startSyllableHighlight(){const t=document.querySelectorAll(".syllable-chip");if(t.length===0)return;t.forEach(o=>o.classList.remove("active"));const e=this.currentWord.length,s=parseFloat(localStorage.getItem("ttsSpeed")||"0.85"),a=e*80/s,n=[];let i=0;t.forEach(o=>{const c=o.textContent||"",d=Math.max(1,c.length);i+=d,o._weight=d}),t.forEach((o,c)=>{const g=o._weight/i*a;n[c]=Math.max(200,g)});let r=0;const l=()=>{if(r>=t.length)return;r>0&&t[r-1].classList.remove("active"),t[r].classList.add("active");const c=n[r];r++,this.syllableInterval=setTimeout(l,c)};l()}static stopSyllableHighlight(){this.syllableInterval&&(clearTimeout(this.syllableInterval),this.syllableInterval=null),document.querySelectorAll(".syllable-chip").forEach(t=>t.classList.remove("active"))}static renderStaticInfo(){const t=document.getElementById("karaokeDisplay");t&&(t.innerHTML=this.currentWord.split(" ").map((a,n)=>`<span class="karaoke-word" data-word-index="${n}">${a}</span>`).join(" "),t.setAttribute("data-auto-size",""),t.setAttribute("data-max-lines","1"),setTimeout(()=>X.apply(t,this.currentWord,1,2.5),50));const e=document.getElementById("syllableDisplay");if(e){const a=tt.splitIntoSyllables(this.currentWord);e.innerHTML=a.map(n=>`<span class="syllable-chip" data-auto-size data-max-lines="1">${n}</span>`).join(""),setTimeout(()=>X.applyToContainer(e),50)}const s=document.getElementById("phoneticTipsArea");if(s){const a=tt.getTipsForWord(this.currentWord);s.innerHTML=a.map(n=>`
                <div class="tip-card">
                    <div class="tip-title">ğŸ’¡ <span class="sv-text">Tips</span><span class="ar-text">Ù†ØµÙŠØ­Ø©</span></div>
                    <div class="tip-text">${Z.getLanguage()==="sv"?n.tip.sv:n.tip.ar}</div>
                    <div class="tip-ex">Ex: ${n.example}</div>
                </div>
            `).join("")}}static highlightWord(t){const e=document.getElementById("karaokeDisplay");if(!e)return;e.querySelectorAll(".karaoke-word").forEach(a=>{var r;const n=(r=a.textContent)==null?void 0:r.toLowerCase().replace(/[.,!?;:]/g,""),i=t.toLowerCase().replace(/[.,!?;:]/g,"");n===i&&(a.classList.add("active"),setTimeout(()=>a.classList.remove("active"),800))})}static updateKaraokeActive(t){const e=document.getElementById("karaokeDisplay");e&&(t?e.classList.add("playing"):e.classList.remove("playing"))}static async toggleRecording(){var n,i,r,l,o,c;const t=document.getElementById("recordBtn"),e=document.getElementById("recordingFeedback"),s=document.getElementById("playbackArea"),a=document.querySelector(".pronunciation-lab-section");if(!this.isRecording)this.isRecording=!0,t==null||t.classList.add("active"),t.innerHTML='â¹ï¸ <span class="sv-text">Stoppa</span><span class="ar-text">Ø¥ÙŠÙ‚Ø§Ù</span>',e==null||e.classList.remove("hidden"),s==null||s.classList.add("hidden"),a==null||a.classList.add("recording"),(n=this.visualizer)==null||n.start(),(i=document.querySelector(".audio-visualizer-canvas"))==null||i.classList.add("recording"),await((r=this.recorder)==null?void 0:r.start()),this.startSpeechRecognition();else{this.isRecording=!1,t==null||t.classList.remove("active"),t.innerHTML='ğŸ™ï¸ <span class="sv-text">Spela in</span><span class="ar-text">ØªØ³Ø¬ÙŠÙ„</span>',e==null||e.classList.add("hidden"),a==null||a.classList.remove("recording"),(l=document.querySelector(".audio-visualizer-canvas"))==null||l.classList.remove("recording"),(o=this.visualizer)==null||o.stop();const d=await((c=this.recorder)==null?void 0:c.stop());this.lastRecordedBlob=d,s==null||s.classList.remove("hidden"),this.stopSpeechRecognition()}}static initSpeechRecognition(){const t=window.SpeechRecognition||window.webkitSpeechRecognition;t&&(this.recognition=new t,this.recognition.lang="sv-SE",this.recognition.interimResults=!1,this.recognition.maxAlternatives=1,this.recognition.onresult=e=>{const s=e.results[0][0].transcript.toLowerCase(),a=e.results[0][0].confidence;this.calculateScore(s,a)})}static startSpeechRecognition(){if(this.recognition)try{this.recognition.start()}catch{}}static stopSpeechRecognition(){if(this.recognition)try{this.recognition.stop()}catch{}}static calculateScore(t,e){const s=this.currentWord.toLowerCase();let a=0;t===s?a=Math.round(e*100):t.includes(s)||s.includes(t)?a=Math.round(e*80):a=Math.round(e*40);const n=document.getElementById("pronunciationScore"),i=document.getElementById("masteryBadgeContainer"),r=document.querySelector(".pronunciation-lab-section");n&&(n.innerHTML=`â­ <span class="sv-text">Resultat: ${a}%</span><span class="ar-text">Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${a}%</span>`,a>50&&(r==null||r.classList.add("success"),setTimeout(()=>r==null?void 0:r.classList.remove("success"),2e3)),a>80&&(mt.confetti({particleCount:50,spread:50}),J.success(),this.showGoldParticles()),i&&(i.innerHTML="",gt.renderBadge(a,i)))}static showGoldParticles(){const t=document.getElementById("audioVisualizerContainer");if(t)for(let e=0;e<15;e++){const s=document.createElement("div");s.className="gold-particle",s.style.left=`${Math.random()*100}%`,s.style.animationDelay=`${Math.random()*.5}s`,t.appendChild(s),setTimeout(()=>s.remove(),1500)}}}u(C,"visualizer",null),u(C,"recorder",null),u(C,"currentWord",""),u(C,"recognition",null),u(C,"currentLevel","listen"),u(C,"syllableInterval",null),u(C,"isRecording",!1);class Q{static process(t){return t?t.replace(/([a-zÃ¥Ã¤Ã¶A-ZÃ…Ã„Ã–]{4,})/g,e=>`<span class="smart-link" data-word="${e.toLowerCase()}">${e}</span>`):""}static setupListeners(t){t.querySelectorAll(".smart-link").forEach(e=>{e.addEventListener("click",async s=>{const a=s.currentTarget.dataset.word;if(a){const n=window.dictionaryData;let i=n==null?void 0:n.find(r=>r[2].toLowerCase()===a);if(!i)try{const r=await z.getAllWords();i=r==null?void 0:r.find(l=>l[2].toLowerCase()===a)}catch(r){console.warn("[SmartLink] DB fallback fail:",r)}i?window.location.href=`details.html?id=${i[0]}`:window.location.href=`index.html?s=${a}`}})})}}class it{static async init(t){const e=document.getElementById("wordNotes"),s=document.getElementById("saveNotesBtn"),a=document.getElementById("notesStatus");if(!e||!s)return;const n=await z.getNote(t);n&&(e.value=n),s.onclick=async()=>{const i=e.value.trim();s.disabled=!0,a&&(a.innerHTML=`<span class="sv-text">${W("details.saving")}</span><span class="ar-text">${W("details.saving")}</span>`);const r=await z.saveNote(t,i);s.disabled=!1,a&&(a.innerHTML=r?`<span class="sv-text">${W("details.saved")}</span><span class="ar-text">${W("details.saved")}</span>`:`<span class="sv-text">${W("common.error")}</span><span class="ar-text">${W("common.error")}</span>`,setTimeout(()=>{a.innerHTML=""},3e3))}}}class O{static getContext(){return this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext}static playCorrect(){const t=this.getContext(),e=t.createOscillator(),s=t.createGain();e.connect(s),s.connect(t.destination),e.frequency.setValueAtTime(523.25,t.currentTime),e.frequency.setValueAtTime(659.25,t.currentTime+.1),e.frequency.setValueAtTime(783.99,t.currentTime+.2),s.gain.setValueAtTime(.3,t.currentTime),s.gain.exponentialRampToValueAtTime(.01,t.currentTime+.4),e.start(t.currentTime),e.stop(t.currentTime+.4)}static playWrong(){const t=this.getContext(),e=t.createOscillator(),s=t.createGain();e.connect(s),s.connect(t.destination),e.type="sawtooth",e.frequency.setValueAtTime(200,t.currentTime),e.frequency.exponentialRampToValueAtTime(100,t.currentTime+.3),s.gain.setValueAtTime(.2,t.currentTime),s.gain.exponentialRampToValueAtTime(.01,t.currentTime+.3),e.start(t.currentTime),e.stop(t.currentTime+.3)}static playTick(){const t=this.getContext(),e=t.createOscillator(),s=t.createGain();e.connect(s),s.connect(t.destination),e.frequency.setValueAtTime(880,t.currentTime),s.gain.setValueAtTime(.1,t.currentTime),s.gain.exponentialRampToValueAtTime(.01,t.currentTime+.05),e.start(t.currentTime),e.stop(t.currentTime+.05)}}u(O,"audioContext",null);class et{static getEmoji(t){const e=t.toLowerCase();return this.emojiMap[e]?this.emojiMap[e]:null}static hasEmoji(t){return!!this.getEmoji(t)}}u(et,"emojiMap",{hund:"ğŸ¶",katt:"ğŸ±",fÃ¥gel:"ğŸ¦",hÃ¤st:"ğŸ´",ko:"ğŸ®",gris:"ğŸ·",fÃ¥r:"ğŸ‘",kanin:"ğŸ°",bjÃ¶rn:"ğŸ»",lejon:"ğŸ¦",tiger:"ğŸ¯",elefant:"ğŸ˜",apa:"ğŸµ",fisk:"ğŸŸ",val:"ğŸ‹",orm:"ğŸ",spindel:"ğŸ•·ï¸",bi:"ğŸ",fjÃ¤ril:"ğŸ¦‹",rÃ¤v:"ğŸ¦Š",Ã¤lg:"ğŸ«",varg:"ğŸº",mus:"ğŸ­",groda:"ğŸ¸",skÃ¶ldpadda:"ğŸ¢",sol:"â˜€ï¸",mÃ¥ne:"ğŸŒ™",stjÃ¤rna:"â­",moln:"â˜ï¸",regn:"ğŸŒ§ï¸",snÃ¶:"â„ï¸",eld:"ğŸ”¥",vatten:"ğŸ’§",trÃ¤d:"ğŸŒ³",blomma:"ğŸŒ¸",skog:"ğŸŒ²",berg:"ğŸ”ï¸",hav:"ğŸŒŠ",strand:"6ğŸ–ï¸",Ã¶:"ğŸï¸",blad:"ğŸƒ",grÃ¤s:"ğŸŒ±",sten:"ğŸª¨",regnbÃ¥ge:"ğŸŒˆ",blixt:"âš¡",Ã¤pple:"ğŸ",banan:"ğŸŒ",pÃ¤ron:"ğŸ",apelsin:"ğŸŠ",citron:"ğŸ‹",druvor:"ğŸ‡",jordgubbe:"ğŸ“",tomat:"ğŸ…",potatis:"ğŸ¥”",morot:"ğŸ¥•",brÃ¶d:"ğŸ",kÃ¶tt:"ğŸ¥©",Ã¤gg:"ğŸ¥š",ost:"ğŸ§€",pizza:"ğŸ•",burgare:"ğŸ”",glass:"ğŸ¦",kaka:"ğŸ°",kaffe:"â˜•",mjÃ¶lk:"ğŸ¥›",ris:"ğŸš",sÃ¥s:"ğŸ¥£",kyckling:"ğŸ—",hus:"ğŸ ",bil:"ğŸš—",cykel:"ğŸš²",bÃ¥t:"â›µ",flygplan:"âœˆï¸",tÃ¥g:"ğŸš†",buss:"ğŸšŒ",dator:"ğŸ’»",telefon:"ğŸ“±",klocka:"âŒš",bok:"ğŸ“–",penna:"âœï¸",stol:"ğŸª‘",sÃ¤ng:"ğŸ›Œ",nyckel:"ğŸ”‘",vÃ¤ska:"ğŸ‘œ",glasÃ¶gon:"ğŸ‘“",hatt:"ğŸ©",skor:"ğŸ‘",klÃ¤der:"ğŸ‘•",dÃ¶rr:"ğŸšª",fÃ¶nster:"ğŸªŸ",bord:"5ï¸âƒ£",lampa:"ğŸ’¡",sax:"âœ‚ï¸",Ã¶ga:"ğŸ‘ï¸",Ã¶ra:"ğŸ‘‚",nÃ¤sa:"ğŸ‘ƒ",mun:"ğŸ‘„",hand:"âœ‹",fot:"ğŸ¦¶",hjÃ¤rta:"â¤ï¸",hjÃ¤rna:"ğŸ§ ",tand:"ğŸ¦·",hÃ¥r:"ğŸ’‡",lÃ¤kare:"ğŸ‘¨â€âš•ï¸",lÃ¤rare:"ğŸ§‘â€ğŸ«",polis:"ğŸ‘®",bebis:"ğŸ‘¶",kvinna:"ğŸ‘©",man:"ğŸ‘¨",flicka:"ğŸ‘§",pojke:"ğŸ‘¦",familj:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦",kung:"ğŸ‘‘"});class R{static setDifficulty(t){this.difficulty=t,console.log(`[Quiz] Difficulty set to: ${t}`)}static adjustDifficulty(t){t?(this.consecutiveCorrect++,this.consecutiveCorrect>=3&&this.difficulty!=="hard"&&(this.setDifficulty(this.difficulty==="easy"?"medium":"hard"),this.consecutiveCorrect=0)):(this.consecutiveCorrect=0,this.difficulty!=="easy"&&this.setDifficulty(this.difficulty==="hard"?"medium":"easy"))}static getTimeLimit(){switch(this.difficulty){case"easy":return 15;case"medium":return 10;case"hard":return 5;default:return 10}}static getArabicFeatures(t){const e=t.startsWith("Ø§Ù„"),s=t.endsWith("Ø©"),a=t.includes("Ùˆ"),n=t.endsWith("ÙŠ")||t.endsWith("Ù‰"),i=t.endsWith("ÙˆÙ†")||t.endsWith("ÙŠÙ†")||t.endsWith("Ø§Øª"),r=t.split(" ").length;return{hasAl:e,hasTaa:s,hasWaw:a,hasYaa:n,hasPlural:i,wordCount:r,length:t.length}}static similarityScore(t,e){const s=this.getArabicFeatures(t),a=this.getArabicFeatures(e);let n=0;return s.hasAl===a.hasAl&&(n+=3),s.hasTaa===a.hasTaa&&(n+=2),s.hasPlural===a.hasPlural&&(n+=2),s.hasYaa===a.hasYaa&&(n+=1),s.wordCount===a.wordCount&&(n+=3),Math.abs(s.length-a.length)<=1&&(n+=4),Math.abs(s.length-a.length)===0&&(n+=3),t.charAt(0)===e.charAt(0)&&(n+=2),t.charAt(t.length-1)===e.charAt(e.length-1)&&(n+=2),n}static getSmartDistractors(t,e,s=3){const a=t[1],n=t[3];t[2];const i=[],r=new Set([n]),l=e.filter(o=>o[3]!==n&&o[1]===a).map(o=>({text:o[3],score:this.similarityScore(n,o[3])})).sort((o,c)=>c.score-o.score);for(const o of l){if(i.length>=s)break;r.has(o.text)||(i.push(o.text),r.add(o.text))}if(i.length<s)for(const o of e.sort(()=>Math.random()-.5)){if(i.length>=s)break;r.has(o[3])||(i.push(o[3]),r.add(o[3]))}return console.log("[Quiz] EXTREME distractors:",{correct:n,features:this.getArabicFeatures(n),distractors:i.map(o=>({text:o,score:this.similarityScore(n,o),features:this.getArabicFeatures(o)}))}),i}static pickRandom(t,e,s,a){const n=t.sort(()=>Math.random()-.5);for(const i of n){if(e.length>=e.length+a||a<=0)break;s.has(i[3])||(e.push(i[3]),s.add(i[3]),a--)}}static swedishSimilarityScore(t,e){let s=0;t.length===e.length?s+=10:Math.abs(t.length-e.length)===1&&(s+=5),t.charAt(0).toLowerCase()===e.charAt(0).toLowerCase()&&(s+=4),t.charAt(t.length-1)===e.charAt(e.length-1)&&(s+=3);const a=["ar","er","or","ning","tion","het","lig","isk"];for(const n of a)if(t.endsWith(n)&&e.endsWith(n)){s+=4;break}return t.substring(0,2).toLowerCase()===e.substring(0,2).toLowerCase()&&(s+=3),s}static getSwedishDistractors(t,e,s=3){const a=t[1],n=t[2],i=[],r=new Set([n]),l=e.filter(o=>o[2]!==n&&o[1]===a).map(o=>({text:o[2],score:this.swedishSimilarityScore(n,o[2])})).sort((o,c)=>c.score-o.score);for(const o of l){if(i.length>=s)break;r.has(o.text)||(i.push(o.text),r.add(o.text))}if(i.length<s)for(const o of e.sort(()=>Math.random()-.5)){if(i.length>=s)break;r.has(o[2])||(i.push(o[2]),r.add(o[2]))}return console.log("[Quiz] EXTREME Swedish distractors:",{correct:n,correctLen:n.length,distractors:i.map(o=>({text:o,len:o.length,score:this.swedishSimilarityScore(n,o)}))}),i}static getEasyDistractors(t,e=3){const s=[],a=t.sort(()=>Math.random()-.5).slice(0,20);for(const n of a){if(s.length>=e)break;n[3]||n[2]}return[]}static getEasyDistractorsAr(t,e,s=3){return e.filter(a=>a[3]!==t).sort(()=>Math.random()-.5).slice(0,s).map(a=>a[3])}static getEasyDistractorsSv(t,e,s=3){return e.filter(a=>a[2]!==t).sort(()=>Math.random()-.5).slice(0,s).map(a=>a[2])}static getMediumDistractorsAr(t,e,s=3){const a=t[1],n=t[3];return e.filter(i=>i[1]===a&&i[3]!==n).sort(()=>Math.random()-.5).slice(0,s).map(i=>i[3])}static getMediumDistractorsSv(t,e,s=3){const a=t[1],n=t[2];return e.filter(i=>i[1]===a&&i[2]!==n).sort(()=>Math.random()-.5).slice(0,s).map(i=>i[2])}static init(t){const e=document.getElementById("miniQuizContainer"),s=document.getElementById("miniQuizQuestion"),a=document.getElementById("miniQuizOptions"),n=document.getElementById("miniQuizFeedback");if(!e||!s||!a||!n)return;const i=t[2],r=t[3],l=t[1],o=t[7]||"",c=window.dictionaryData,d=["Hus","Bil","Katt","Hund","Sol","Vatten","BrÃ¶d","Bok"],g=["Ø¨ÙŠØª","Ø³ÙŠØ§Ø±Ø©","Ù‚Ø·Ø©","ÙƒÙ„Ø¨","Ø´Ù…Ø³","Ù…Ø§Ø¡","Ø®Ø¨Ø²","ÙƒØªØ§Ø¨"],f=(h,y)=>(y?d:g).filter(T=>T!==h).sort(()=>Math.random()-.5).slice(0,3),x=i.substring(0,Math.min(4,i.length)).toLowerCase(),m=o&&o.length>10&&o.toLowerCase().includes(x),k=et.hasEmoji(i),H=[2,3];m&&H.push(1),k&&H.push(4);const j=H[Math.floor(Math.random()*H.length)];let A,w,M,B,E;if(j===4&&k){const h=et.getEmoji(i);let y;this.difficulty==="easy"?y=this.getEasyDistractorsSv(i,c,3):y=c?this.getSwedishDistractors(t,c,3):f(i,!0),A=[...y,i].sort(()=>Math.random()-.5),w=i,M=`
                <div class="quiz-emoji-display">${h}</div>
                <div class="quiz-instruction"><span class="sv-text">Vilket ord passar bilden?</span><span class="ar-text">Ù…Ø§ Ù‡ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„ØµÙˆØ±Ø©ØŸ</span></div>
            `,B='<span class="sv-text">Bidlquiz</span><span class="ar-text">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØ±</span>',E="ğŸ–¼ï¸",console.log("[Quiz] EMOJI mode:",{emoji:h,correctAnswer:i})}else if(j===1&&m){const h=o.replace(new RegExp(`\\b(${x}\\w*)\\b`,"gi"),"______");A=[...c?this.getSwedishDistractors(t,c,3):f(i,!0),i].sort(()=>Math.random()-.5),w=i,M=`
                <div class="quiz-sentence" dir="ltr">"${h}"</div>
                <div class="quiz-instruction"><span class="sv-text">VÃ¤lj rÃ¤tt ord</span><span class="ar-text">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</span></div>
            `,B='<span class="sv-text">Fyll i</span><span class="ar-text">Ø¥ÙƒÙ…Ø§Ù„</span>',E="ğŸ“",console.log("[Quiz] FILL BLANK mode:",{sentence:o,correctAnswer:i})}else j===2?(A=[...c?this.getSwedishDistractors(t,c,3):f(i,!0),i].sort(()=>Math.random()-.5),w=i,M=`
                <div class="quiz-listen-container">
                    <button class="quiz-listen-btn" onclick="window.TTSManager?.speak('${i}', 'sv')">
                        ğŸ”Š <span><span class="sv-text">${b("btn.test","sv")}</span><span class="ar-text">${b("btn.test","ar")}</span></span>
                    </button>
                </div>
                <div class="quiz-instruction"><span class="sv-text">Vilket ord hÃ¶rde du?</span><span class="ar-text">Ù…Ø§ Ù‡ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØªÙŠ Ø³Ù…Ø¹ØªÙ‡Ø§ØŸ</span></div>
            `,B='<span class="sv-text">Lyssna</span><span class="ar-text">Ø§Ø³ØªÙ…Ø§Ø¹</span>',E="ğŸ§",setTimeout(()=>P.speak(i,"sv"),500),console.log("[Quiz] LISTENING mode:",{correctAnswer:i})):Math.random()<.5?(A=[...c?this.getSwedishDistractors(t,c,3):f(i,!0),i].sort(()=>Math.random()-.5),w=i,M=`
                    <span class="sv-text">Vad Ã¤r det svenska ordet fÃ¶r</span><span class="ar-text">Ù…Ø§ Ù‡ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³ÙˆÙŠØ¯ÙŠØ© Ù„Ù€</span> 
                    <strong>"${r}"</strong>?`,B='<span class="sv-text">OmvÃ¤nd</span><span class="ar-text">Ø¹ÙƒØ³ÙŠ</span>',E="ğŸ”„"):(A=[...c?this.getSmartDistractors(t,c,3):f(r,!1),r].sort(()=>Math.random()-.5),w=r,M=`
                    <span class="sv-text">Vad betyder</span><span class="ar-text">Ù…Ø§ Ù…Ø¹Ù†Ù‰</span> 
                    <strong>"${i}"</strong>?`,B=`<span class="sv-text">${l}</span><span class="ar-text">${l}</span>`,E="ğŸ“–");const K=parseInt(localStorage.getItem("quizStreak")||"0"),N=parseInt(localStorage.getItem("quizXP")||"0");s.innerHTML=`
            <div class="quiz-header-row">
                <span class="quiz-word-type">${E} ${B}</span>
                <div class="quiz-stats">
                    <span class="quiz-xp">â­ ${N} XP</span>
                    ${K>0?`<span class="quiz-streak">ğŸ”¥ ${K}</span>`:""}
                </div>
            </div>
            <div class="quiz-timer-bar"><div class="quiz-timer-progress"></div></div>
            ${M}
        `,a.innerHTML=A.map(h=>`
            <div class="mini-quiz-option" data-value="${h}">${h}</div>
        `).join("")+`
            <button class="quiz-hint-btn" id="quizHintBtn" ${N<5?"disabled":""}>
                ğŸ’¡ <span class="sv-text">LedtrÃ¥d</span><span class="ar-text">ØªÙ„Ù…ÙŠØ­</span>
                <span class="hint-cost">(-5 XP)</span>
            </button>
        `;const V=this.getTimeLimit();let v=V;const S=s.querySelector(".quiz-timer-progress"),L=setInterval(()=>{if(v--,S){const h=v/V*100;S.style.width=`${h}%`,h<30?S.style.background="#ef4444":h<60&&(S.style.background="#f59e0b")}v<=5&&v>0&&O.playTick(),v<=0&&(clearInterval(L),this.handleAnswer(a,n,"",w,t,!1))},1e3);a.querySelectorAll(".mini-quiz-option").forEach(h=>{h.addEventListener("click",y=>{clearInterval(L);const I=y.currentTarget.dataset.value;this.handleAnswer(a,n,I,w,t,!0)})});const F=a.querySelector("#quizHintBtn");F&&F.addEventListener("click",()=>{let h=parseInt(localStorage.getItem("quizXP")||"0");if(h<5)return;h-=5,localStorage.setItem("quizXP",h.toString());const y=s.querySelector(".quiz-xp");y&&(y.textContent=`â­ ${h} XP`);const I=Array.from(a.querySelectorAll(".mini-quiz-option:not(.disabled)")).filter(T=>T.dataset.value!==w);if(I.length>0){const T=I[Math.floor(Math.random()*I.length)];T.classList.add("eliminated"),T.style.opacity="0.3",T.style.pointerEvents="none",T.style.textDecoration="line-through"}F.disabled=!0,F.style.opacity="0.5"})}static handleAnswer(t,e,s,a,n,i){const r=s===a,l=n[0].toString();let o=parseInt(localStorage.getItem("quizStreak")||"0"),c=parseInt(localStorage.getItem("quizXP")||"0");r?(o++,c+=10+o*2,this.showConfetti(),O.playCorrect()):(o=0,O.playWrong()),localStorage.setItem("quizStreak",o.toString()),localStorage.setItem("quizXP",c.toString()),G.updateMastery(l,r),r?Y.recordCorrect(l):Y.recordWrong(l),t.querySelectorAll(".mini-quiz-option").forEach(k=>{k.classList.add("disabled"),k.dataset.value===a?k.classList.add("correct"):k.dataset.value===s&&!r&&k.classList.add("wrong")});const d=r&&o>1?`<span class="streak-bonus">ğŸ”¥ ${o}x streak! +${o*2} XP</span>`:"",g=i?"":`â° <span class="sv-text">${b("details.timeUp","sv")}</span><span class="ar-text">${b("details.timeUp","ar")}</span>`;e.classList.remove("hidden");const f=n[7]||"",x=n[8]||"",m=f?`
            <div class="quiz-explanation">
                <div class="explanation-label">ğŸ“š <span class="sv-text">Exempel</span><span class="ar-text">Ù…Ø«Ø§Ù„</span>:</div>
                <div class="explanation-swe">"${f}"</div>
                ${x?`<div class="explanation-arb" dir="rtl">"${x}"</div>`:""}
            </div>
        `:"";e.innerHTML=`
            ${g}
            ${r?`ğŸ‰ <span class="sv-text">${b("details.correct","sv")}</span><span class="ar-text">${b("details.correct","ar")}</span> ${d}`:`âŒ <span class="sv-text">${b("details.wrong","sv")} "${a}".</span><span class="ar-text">${b("details.wrong","ar")} "${a}".</span>`}
            ${m}
            <button class="quiz-retry-btn" onclick="MiniQuizManager.init(window.currentWordData)">
                ğŸ”„ <span class="sv-text">${b("details.retry","sv")}</span><span class="ar-text">${b("details.retry","ar")}</span>
            </button>
        `,e.className=`mini-quiz-feedback ${r?"correct":"wrong"}`,window.currentWordData=n}static showConfetti(){const t=document.getElementById("miniQuizContainer");if(!t)return;const e=30;for(let s=0;s<e;s++){const a=document.createElement("div");a.className="quiz-confetti",a.style.left=`${Math.random()*100}%`,a.style.animationDelay=`${Math.random()*.5}s`,a.style.background=["#ff6b6b","#feca57","#48dbfb","#ff9ff3","#54a0ff"][Math.floor(Math.random()*5)],t.appendChild(a),setTimeout(()=>a.remove(),2e3)}}}u(R,"difficulty","medium"),u(R,"consecutiveCorrect",0);window.MiniQuizManager=R;class U{static init(t){console.log("[RelatedWords] init called with:",t==null?void 0:t[2]);const e=document.getElementById("relatedWordsContainer");if(console.log("[RelatedWords] container found:",!!e),!e)return;const s=t[1],a=t[2],n=window.dictionaryData;if(console.log("[RelatedWords] allData available:",!!n,n==null?void 0:n.length),!n){console.log("[RelatedWords] Starting polling...");let d=0;const g=setInterval(()=>{const f=window.dictionaryData;d++,f?(clearInterval(g),U.init(t)):d>25&&(clearInterval(g),e.innerHTML=`<div style="text-align:center; padding:1rem; color:var(--text-secondary);">
                        <span class="sv-text">Kunde inte ladda relaterade ord</span>
                        <span class="ar-text">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø°Ø§Øª Ø§Ù„ØµÙ„Ø©</span>
                    </div>`)},200);e.innerHTML=`<div style="text-align:center; padding:1rem; color:var(--text-secondary);">
                <span class="sv-text">Laddar relaterade ord...</span>
                <span class="ar-text">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø°Ø§Øª Ø§Ù„ØµÙ„Ø©...</span>
            </div>`;return}const i=n.filter(d=>d[2]!==a&&(d[2].includes(a)||a.includes(d[2]))),r=n.filter(d=>d[2]!==a&&d[2].startsWith(a.substring(0,3))),l=n.filter(d=>d[2]!==a&&d[1]===s),o=new Set([...i,...r,...l]);let c=Array.from(o);c.sort((d,g)=>{const f=d[2].includes(a)||a.includes(d[2]),x=g[2].includes(a)||a.includes(g[2]);return f&&!x?-1:!f&&x?1:.5-Math.random()}),c=c.slice(0,6),c.length===0&&(c=n.sort(()=>Math.random()-.5).slice(0,6)),e.innerHTML=c.map(d=>`
            <div class="related-word-chip" onclick="window.location.href='details.html?id=${d[0]}'">
                <span class="related-swe">${d[2]}</span>
                <span class="related-arb">${d[3]}</span>
            </div>
        `).join("")}}class D{static init(t){const e=window.dictionaryData;if(!e||(this.currentWordIndex=e.findIndex(a=>a[0].toString()===t),this.currentWordIndex===-1))return;const s=document.getElementById("detailsArea");s&&(this.addSwipeHints(s),s.addEventListener("touchstart",a=>this.handleTouchStart(a),{passive:!0}),s.addEventListener("touchend",a=>this.handleTouchEnd(a),{passive:!0}))}static addSwipeHints(t){const e=document.createElement("div");e.className="swipe-hints",e.innerHTML=`
            <span class="swipe-hint left" onclick="SwipeNavigator.navigate(-1)"><span class="sv-text">â€¹ FÃ¶regÃ¥ende</span><span class="ar-text">â€¹ Ø§Ù„Ø³Ø§Ø¨Ù‚</span></span>
            <span class="swipe-hint right" onclick="SwipeNavigator.navigate(1)"><span class="sv-text">NÃ¤sta â€º</span><span class="ar-text">Ø§Ù„ØªØ§Ù„ÙŠ â€º</span></span>
        `,t.prepend(e)}static handleTouchStart(t){this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY}static handleTouchEnd(t){const e=t.changedTouches[0].clientX,s=t.changedTouches[0].clientY,a=e-this.startX,n=Math.abs(s-this.startY);Math.abs(a)>80&&n<50&&(a>0?this.navigate(-1):this.navigate(1))}static navigate(t){var a;const e=window.dictionaryData;if(!e||this.currentWordIndex===-1)return;const s=this.currentWordIndex+t;if(s>=0&&s<e.length){const n=e[s][0];(a=document.getElementById("detailsArea"))==null||a.classList.add(t>0?"slide-left":"slide-right"),setTimeout(()=>{window.location.href=`details.html?id=${n}`},150)}}}u(D,"startX",0),u(D,"startY",0),u(D,"currentWordIndex",-1);window.SwipeNavigator=D;class G{static getKey(t){return`mastery_${t}`}static getMastery(t){return parseInt(localStorage.getItem(this.getKey(t))||"0")}static updateMastery(t,e){let s=this.getMastery(t);return s+=e?20:-10,s=Math.max(0,Math.min(100,s)),localStorage.setItem(this.getKey(t),s.toString()),s}static getLastStudied(t){return localStorage.getItem(`lastStudied_${t}`)}static recordStudy(t){localStorage.setItem(`lastStudied_${t}`,new Date().toISOString())}static getTimeAgo(t){const e=this.getLastStudied(t);if(!e)return"";const s=Date.now()-new Date(e).getTime(),a=Math.floor(s/(1e3*60*60*24)),n=Math.floor(s/(1e3*60*60)),i=Math.floor(s/(1e3*60));return a>0?`<span class="sv-text">Studerad ${a} dagar sedan</span><span class="ar-text">Ø¯Ø±Ø³Øª Ù…Ù†Ø° ${a} Ø£ÙŠØ§Ù…</span>`:n>0?`<span class="sv-text">Studerad ${n} timmar sedan</span><span class="ar-text">Ø¯Ø±Ø³Øª Ù…Ù†Ø° ${n} Ø³Ø§Ø¹Ø§Øª</span>`:i>0?`<span class="sv-text">Studerad ${i} minuter sedan</span><span class="ar-text">Ø¯Ø±Ø³Øª Ù…Ù†Ø° ${i} Ø¯Ù‚Ø§Ø¦Ù‚</span>`:'<span class="sv-text">Nyligen</span><span class="ar-text">Ù…Ø¤Ø®Ø±Ø§Ù‹</span>'}static renderMasteryBar(t,e){const s=this.getMastery(t),a=this.getTimeAgo(t),n=Y.isWeak(t),i=document.createElement("div");i.className="mastery-section",i.innerHTML=`
            <div class="mastery-header">
                <span class="mastery-label">
                    ğŸ“ˆ <span class="sv-text">BehÃ¤rskningsnivÃ¥</span><span class="ar-text">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¥ØªÙ‚Ø§Ù†</span>
                    ${n?'<span class="weak-badge">âš ï¸ <span class="sv-text">Svagt ord</span><span class="ar-text">ÙƒÙ„Ù…Ø© Ø¶Ø¹ÙŠÙØ©</span></span>':""}
                </span>
                <span class="mastery-percent">${s}%</span>
            </div>
            <div class="mastery-bar">
                <div class="mastery-progress" style="width: ${s}%"></div>
            </div>
            ${a?`<div class="last-studied">${a}</div>`:""}
        `,e.prepend(i),this.recordStudy(t)}}class Y{static getKey(t){return`weak_${t}`}static recordWrong(t){const e=this.getWrongCount(t)+1;localStorage.setItem(this.getKey(t),e.toString())}static recordCorrect(t){const e=Math.max(0,this.getWrongCount(t)-1);localStorage.setItem(this.getKey(t),e.toString())}static getWrongCount(t){return parseInt(localStorage.getItem(this.getKey(t))||"0")}static isWeak(t){return this.getWrongCount(t)>=3}}class st{static checkAndUpdateStreak(){const t=new Date().toDateString(),e=localStorage.getItem(this.LAST_DATE_KEY);let s=parseInt(localStorage.getItem(this.STREAK_KEY)||"0");if(e===t)return s;const a=new Date;return a.setDate(a.getDate()-1),e===a.toDateString()?s++:e!==t&&(s=1),localStorage.setItem(this.STREAK_KEY,s.toString()),localStorage.setItem(this.LAST_DATE_KEY,t),s}static getStreak(){return parseInt(localStorage.getItem(this.STREAK_KEY)||"0")}static renderStreakBadge(t){const e=this.checkAndUpdateStreak();if(e<2)return;const s=document.createElement("div");s.className="daily-streak-badge",s.innerHTML=`
            <span class="streak-fire">ğŸ”¥</span>
            <span class="sv-text">${e} dagar i rad!</span><span class="ar-text">${e} Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©!</span>
        `,t.prepend(s)}}u(st,"STREAK_KEY","dailyStreak"),u(st,"LAST_DATE_KEY","lastStudyDate");class rt{static getRandomQuote(){return this.quotes[Math.floor(Math.random()*this.quotes.length)]}static renderQuote(t){const e=this.getRandomQuote(),s=document.createElement("div");s.className="motivation-quote",s.innerHTML=`
            <p>"${e.text}"</p>
            <div class="author">â€” ${e.author}</div>
        `,t.appendChild(s)}}u(rt,"quotes",[{text:'<span class="sv-text">Varje nytt ord Ã¤r ett fÃ¶nster mot en ny vÃ¤rld</span><span class="ar-text">ÙƒÙ„ ÙƒÙ„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù‡ÙŠ Ù†Ø§ÙØ°Ø© Ø¹Ù„Ù‰ Ø¹Ø§Ù„Ù… Ø¬Ø¯ÙŠØ¯</span>',author:'<span class="sv-text">OkÃ¤nd</span><span class="ar-text">Ù…Ø¬Ù‡ÙˆÙ„</span>'},{text:'<span class="sv-text">LÃ¤rande Ã¤r ingen tÃ¤vling, det Ã¤r en resa</span><span class="ar-text">Ø§Ù„ØªØ¹Ù„Ù… Ù„ÙŠØ³ Ø³Ø¨Ø§Ù‚Ø§Ù‹ØŒ Ø¨Ù„ Ø±Ø­Ù„Ø©</span>',author:'<span class="sv-text">Visdom</span><span class="ar-text">Ø­ÙƒÙ…Ø©</span>'},{text:'<span class="sv-text">Den som lÃ¤r sig ett sprÃ¥k, fÃ¶rstÃ¥r en kultur</span><span class="ar-text">Ù…Ù† ÙŠØªØ¹Ù„Ù… Ù„ØºØ©ØŒ ÙŠÙÙ‡Ù… Ø«Ù‚Ø§ÙØ©</span>',author:'<span class="sv-text">OrdsprÃ¥k</span><span class="ar-text">Ù…Ø«Ù„</span>'},{text:'<span class="sv-text">SprØ§Ø¦ÙƒØ© Ù‡Ùˆ Ø±ÙˆØ­ Ø§Ù„Ø£Ù…Ø©</span><span class="ar-text">Ø§Ù„Ù„ØºØ© Ù‡ÙŠ Ø±ÙˆØ­ Ø§Ù„Ø£Ù…Ø©</span>',author:'<span class="sv-text">Fichte</span><span class="ar-text">ÙÙŠØ®ØªÙ‡</span>'}]);class yt{static share(t){const e=t[2],s=t[3],a=t[1],n=`ğŸ“š ØªØ¹Ù„Ù…Øª ÙƒÙ„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©!

ğŸ‡¸ğŸ‡ª ${e} (${a})
ğŸ‡¸ğŸ‡¦ ${s}

#SnabbaLexin #LearnSwedish`;navigator.share?navigator.share({title:`${e} - SnabbaLexin`,text:n,url:window.location.href}).catch(()=>{}):(navigator.clipboard.writeText(n),q('<span class="sv-text">Kopierad!</span><span class="ar-text">ØªÙ… Ø§Ù„Ù†Ø³Ø®!</span>'))}static renderShareButton(t,e){const s=document.createElement("button");s.className="share-btn",s.innerHTML='ğŸ“¤ <span class="sv-text">Dela</span><span class="ar-text">Ù…Ø´Ø§Ø±ÙƒØ©</span>',s.onclick=()=>this.share(e),t.appendChild(s)}}class ${static getTypeGlowClass(t){const e=t.toLowerCase();return e.includes("verb")?"glow-verb":e.includes("subst")||e.includes("noun")?"glow-noun":e.includes("adj")?"glow-adjective":e.includes("adv")?"glow-adverb":e.includes("prep")?"glow-preposition":"glow-default"}static getTextSizeClass(t){const e=t.length;return e<=8?"text-xl":e<=15?"text-lg":e<=25?"text-md":e<=40?"text-sm":"text-xs"}static showSuccessGlow(){const t=document.querySelector(".flashcard-clean");t&&(t.classList.add("fc-success-glow"),setTimeout(()=>t.classList.remove("fc-success-glow"),600))}static showErrorFlash(){const t=document.querySelector(".flashcard-clean");t&&(t.classList.add("fc-error-flash"),setTimeout(()=>t.classList.remove("fc-error-flash"),400))}static toggleFocus(){this.focusMode=!this.focusMode;const t=document.querySelector(".fc-card-area"),e=document.getElementById("fcStatsBar"),s=document.querySelector(".fc-minimal-header");this.focusMode?(t==null||t.classList.add("focus-mode"),e==null||e.classList.add("hidden"),s==null||s.classList.add("hidden"),q('ğŸ§˜ <span class="sv-text">FokuslÃ¤ge aktiverat</span><span class="ar-text">ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ù…ÙÙØ¹Ù‘Ù„</span>',{type:"info"})):(t==null||t.classList.remove("focus-mode"),e==null||e.classList.remove("hidden"),s==null||s.classList.remove("hidden"),q('<span class="sv-text">FokuslÃ¤ge avslutat</span><span class="ar-text">Ø§Ù†ØªÙ‡Ù‰ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²</span>'))}static playAudio(t){window.TTSManager&&window.TTSManager.speak(t,"sv")}static formatTime(t){const e=Math.floor(t/1e3),s=Math.floor(e/60),a=e%60;return`${s}:${a.toString().padStart(2,"0")}`}static getAccuracy(){return this.sessionStats.total===0?0:Math.round(this.sessionStats.correct/this.sessionStats.total*100)}static init(t){const e=document.getElementById("flashcardContainer");if(!e)return;this.currentWordData=t;const s=t[2],a=t[3],n=t[1],i=t[7]||"",r=this.getTypeGlowClass(n),l=this.getTextSizeClass(s),o=this.getTextSizeClass(a),c=this.currentMode==="reverse"?a:s;this.currentMode;const d=this.currentMode==="reverse"?"rtl":"ltr";this.currentMode,e.innerHTML=`
            <!-- Minimal Header: Mode + Focus Toggle -->
            <div class="fc-minimal-header">
                <div class="fc-mode-pills">
                    <button class="fc-pill ${this.currentMode==="normal"?"active":""}" onclick="FlashcardManager.setMode('normal')" title="Normal / Ø¹Ø§Ø¯ÙŠ">ğŸ‡¸ğŸ‡ª</button>
                    <button class="fc-pill ${this.currentMode==="reverse"?"active":""}" onclick="FlashcardManager.setMode('reverse')" title="OmvÃ¤nd / Ø¹ÙƒØ³ÙŠ">ğŸ”„</button>
                    <button class="fc-pill ${this.currentMode==="listening"?"active":""}" onclick="FlashcardManager.setMode('listening')" title="Lyssna / Ø§Ø³ØªÙ…Ø§Ø¹">ğŸ§</button>
                </div>
                <button class="fc-focus-toggle" onclick="FlashcardManager.toggleFocus()" title="FokuslÃ¤ge / ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²">
                    â›¶
                </button>
            </div>
            
            <!-- Collapsible Stats (hidden by default, show on hover/click) -->
            <div class="fc-stats-minimal" id="fcStatsBar">
                <span class="fc-mini-stat">ğŸ”¥<span id="fcStreak">${this.streak}</span></span>
                <span class="fc-mini-stat">â­<span id="fcXP">${this.xp}</span></span>
                <span class="fc-mini-stat">ğŸ¯<span id="fcAccuracy">${this.getAccuracy()}%</span></span>
            </div>
            
            <div class="fc-card-area ${this.focusMode?"focus-mode":""}">
                ${this.currentMode==="listening"?`
                    <!-- Listening Mode: Simple Design -->
                    <div class="fc-listen-simple">
                        <button class="fc-listen-circle" onclick="FlashcardManager.playAudio('${s}')">
                            ğŸ”Š
                        </button>
                        <div class="fc-listen-grid">
                            ${this.generateListeningOptions(s)}
                        </div>
                    </div>
                `:`
                    <!-- Ultra Clean Flashcard -->
                    <div class="flashcard-clean ${r}" onclick="FlashcardManager.flip()">
                        <div class="flashcard-clean-inner">
                            <!-- Front: Word Only -->
                            <div class="flashcard-clean-front">
                                <div class="fc-front-word ${this.currentMode==="reverse"?o:l}" dir="${d}">${c}</div>
                            </div>
                            <!-- Back: Translation + Example -->
                            <div class="flashcard-clean-back">
                                <div class="fc-back-swe">${s}</div>
                                <div class="fc-back-divider"></div>
                                <div class="fc-back-arb">${a}</div>
                                ${i?`<div class="fc-back-example">"${i}"</div>`:""}
                            </div>
                        </div>
                        <!-- Audio: Appears on hover/tap -->
                        <button class="fc-audio-float" onclick="event.stopPropagation(); FlashcardManager.playAudio('${s}')">ğŸ”Š</button>
                    </div>
                `}
                
                <!-- Icon-Only Rating Buttons -->
                <div class="fc-actions-simple">
                    <button class="fc-action-btn wrong" onclick="FlashcardManager.markWrong('${t[0]}')" title="Vet inte / Ù„Ø§ Ø£Ø¹Ø±Ù">
                        âŒ
                    </button>
                    <button class="fc-action-btn correct" onclick="FlashcardManager.markCorrect('${t[0]}')" title="Vet / Ø£Ø¹Ø±Ù">
                        âœ…
                    </button>
                </div>
                
                <!-- Minimal Navigation (hidden in focus mode) -->
                <div class="fc-nav-simple">
                    <button class="fc-nav-icon" onclick="SwipeNavigator.navigate(-1)" title="FÃ¶regÃ¥ende / Ø§Ù„Ø³Ø§Ø¨Ù‚">â†</button>
                    <button class="fc-nav-icon random" onclick="FlashcardManager.randomWord()" title="SlumpmÃ¤ssigt / Ø¹Ø´ÙˆØ§Ø¦ÙŠ">ğŸ²</button>
                    <button class="fc-nav-icon" onclick="SwipeNavigator.navigate(1)" title="NÃ¤sta / Ø§Ù„ØªØ§Ù„ÙŠ">â†’</button>
                </div>
            </div>
        `,this.isFlipped=!1,this.setupKeyboardShortcuts(),this.startTimeUpdater()}static generateListeningOptions(t){return[...(window.dictionaryData||[]).filter(n=>n[2]!==t).sort(()=>Math.random()-.5).slice(0,3).map(n=>n[2]),t].sort(()=>Math.random()-.5).map(n=>`
            <button class="fc-listen-option" onclick="FlashcardManager.checkListeningAnswer('${n}', '${t}')">
                ${n}
            </button>
        `).join("")}static checkListeningAnswer(t,e){var s,a;t===e?this.markCorrect(((s=this.currentWordData)==null?void 0:s[0])||""):this.markWrong(((a=this.currentWordData)==null?void 0:a[0])||"")}static setMode(t){this.currentMode=t,this.currentWordData&&this.init(this.currentWordData)}static setupKeyboardShortcuts(){document.onkeydown=t=>{var e,s;t.code==="Space"?(t.preventDefault(),this.flip()):t.code==="ArrowRight"||t.code==="KeyD"?D.navigate(1):t.code==="ArrowLeft"||t.code==="KeyA"?D.navigate(-1):t.code==="ArrowUp"||t.code==="KeyW"?this.markCorrect(((e=this.currentWordData)==null?void 0:e[0])||""):(t.code==="ArrowDown"||t.code==="KeyS")&&this.markWrong(((s=this.currentWordData)==null?void 0:s[0])||"")}}static startTimeUpdater(){setInterval(()=>{const t=document.getElementById("fcTime");t&&(t.textContent=this.formatTime(Date.now()-this.startTime))},1e3)}static flip(){const t=document.querySelector(".flashcard-clean");t&&(this.isFlipped=!this.isFlipped,t.classList.toggle("flipped",this.isFlipped),t.classList.add("shimmering"),setTimeout(()=>t.classList.remove("shimmering"),1500),this.isFlipped&&this.currentWordData&&setTimeout(()=>this.playAudio(this.currentWordData[2]),300))}static randomWord(){const t=window.dictionaryData;if(!t||t.length===0)return;const e=Math.floor(Math.random()*t.length),s=t[e];window.location.href=`details.html?id=${s[0]}`}static markCorrect(t){this.streak++,this.xp+=10+this.streak*2,this.sessionStats.correct++,this.sessionStats.total++,this.updateStatsUI(),this.showSuccessGlow(),q(`âœ… +${10+this.streak*2} XP`,{type:"success"}),G.updateMastery(t,!0),Y.recordCorrect(t),setTimeout(()=>D.navigate(1),800)}static markWrong(t){this.streak=0,this.sessionStats.wrong++,this.sessionStats.total++,this.updateStatsUI(),this.showErrorFlash(),q("âŒ",{type:"error"}),G.updateMastery(t,!1),Y.recordWrong(t)}static updateStatsUI(){const t=document.getElementById("fcStreak"),e=document.getElementById("fcXP"),s=document.getElementById("fcAccuracy");t&&(t.textContent=this.streak.toString()),e&&(e.textContent=this.xp.toString()),s&&(s.textContent=`${this.getAccuracy()}%`)}}u($,"isFlipped",!1),u($,"currentMode","normal"),u($,"focusMode",!1),u($,"streak",0),u($,"xp",0),u($,"sessionStats",{correct:0,wrong:0,total:0}),u($,"startTime",Date.now()),u($,"currentWordData",null);window.FlashcardManager=$;window.ShareManager=yt;class xt{constructor(){u(this,"wordId",null);u(this,"wordData",null);this.init()}async init(){const t=new URLSearchParams(window.location.search);if(this.wordId=t.get("id"),!this.wordId){window.location.href="index.html";return}this.setupGeneralListeners(),this.setupTabListeners();try{await z.init();const e=await z.getWordById(this.wordId);if(e){console.log("[Details] âš¡ Instant load from cache"),this.wordData=e,this.renderDetails(),at.recordStudy(this.wordId),it.init(this.wordId),this.loadBackgroundData();return}}catch(e){console.warn("[Details] Cache lookup failed:",e)}console.warn("[Details] Word not in cache. Fallback disabled.")}async loadBackgroundData(){window.dictionaryData?this.initDeferredFeatures():this.initDeferredFeatures()}initDeferredFeatures(){if(!this.wordData)return;const t=document.getElementById("detailsArea");if(t&&(G.renderMasteryBar(this.wordId,t),st.renderStreakBadge(t)),window.dictionaryData)R.init(this.wordData),U.init(this.wordData),D.init(this.wordId),$.init(this.wordData);else{const e=document.querySelector(".notes-section");e&&rt.renderQuote(e)}}setupGeneralListeners(){const t=document.getElementById("themeToggleBtn");t&&t.addEventListener("click",()=>dt.toggle())}setupTabListeners(){const t=document.querySelectorAll(".details-tab-btn"),e=document.querySelectorAll(".tab-content");e.forEach(s=>{const a=s.dataset.tab==="info";s.style.display=a?"block":"none"}),t.forEach(s=>{s.addEventListener("click",()=>{const a=s.dataset.tab;t.forEach(n=>n.classList.toggle("active",n===s)),e.forEach(n=>{const i=n.dataset.tab===a;n.classList.toggle("active",i),n.style.display=i?"block":"none"}),a==="play"&&this.wordData&&(R.init(this.wordData),C.init(this.wordData[2]))})})}async handleDataReady(){const t=window.dictionaryData;if(t)if(this.wordData=t.find(e=>e[0].toString()===this.wordId)||null,this.wordData||(this.wordData=await z.getWordById(this.wordId)),this.wordData)at.recordStudy(this.wordId),this.renderDetails(),it.init(this.wordId),R.init(this.wordData),console.log("[handleDataReady] Calling RelatedWordsManager.init..."),U.init(this.wordData);else{const e=document.getElementById("detailsArea");e&&(e.innerHTML='<div class="placeholder-message"><span class="sv-text">Ordet hittades inte</span><span class="ar-text">Ø§Ù„ÙƒÙ„Ù…Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©</span></div>')}}renderDetails(){const t=this.wordData,e=t[0].toString(),s=t[1],a=t[2],n=t[3],i=t[4]||"",r=t[5]||"",l=t[6]||"",o=t[7]||"",c=t[8]||"",d=t[9]||"",g=t[10]||"";pt.getCategory(s,a,l);const f=_.has(e),x=this.getTypeGlowClass(s);this.setupHeaderActions(t,f);const m=document.getElementById("detailsArea");if(!m)return;const k=ut.getBadge(s,l,a),H=Q.process(r),j=Q.process(o),A=Q.process(d),w=document.querySelector(".details-tabs");w&&(w.className="details-tabs "+x);const M=document.querySelector(".details-header-sticky");M&&(M.className="details-header details-header-sticky "+x);let B=`
            <!-- Hero Section with Type Glow -->
            <div class="details-hero ${x}">
                <div class="hero-inner">
                    <h1 class="word-swe-hero">${a}</h1>
                    <div class="hero-divider"></div>
                    <p class="word-arb-hero" dir="rtl">${n}</p>
                    ${i?`<p class="word-arb-ext" dir="rtl">${i}</p>`:""}
                </div>
                
                <div class="word-meta-row">
                    <span class="word-type-pill">
                        <span class="sv-text">${s}</span>
                        <span class="sv-text ar-text"> / </span>
                        <span class="ar-text">${b("quran."+s.toLowerCase().replace("substantiv","noun"),"ar")||s}</span>
                    </span>
                    ${k}
                </div>
            </div>

            <div class="details-content-grid">
                ${l?`
                <div class="details-section">
                    <h3 class="section-title"><span class="section-icon">ğŸ”—</span> <span class="sv-text">BÃ¶jningar</span><span class="ar-text">Ø§Ù„ØªØµØ±ÙŠÙØ§Øª</span></h3>
                    <div class="forms-card-container">
                        <div class="forms-container">
                            ${l.split(",").map(v=>`<span class="form-chip">${v.trim()}</span>`).join("")}
                        </div>
                    </div>
                </div>
                `:""}

                ${r||i?`
                <div class="details-section">
                    <h3 class="section-title"><span class="section-icon">ğŸ“</span> <span class="sv-text">Betydelse</span><span class="ar-text">Ø§Ù„Ù…Ø¹Ù†Ù‰</span></h3>
                    <div class="definition-card">
                        ${r?`<p class="def-text">${H}</p>`:""}
                        ${i?`<p class="def-text" dir="rtl" style="margin-top: 10px; border-top: 1px solid var(--border); padding-top: 10px;">${i}</p>`:""}
                    </div>
                </div>
                `:""}

                ${o||c?`
                <div class="details-section">
                    <h3 class="section-title"><span class="section-icon">ğŸ’¡</span> <span class="sv-text">Exempel</span><span class="ar-text">Ø£Ù…Ø«Ù„Ø©</span></h3>
                    <div class="example-card">
                        ${o?`<div class="ex-swe-detail" dir="ltr">${j}</div>`:""}
                        ${c?`<div class="ex-arb-detail" dir="rtl">${c}</div>`:""}
                    </div>
                </div>
                `:""}

                ${d||g?`
                <div class="details-section">
                    <h3 class="section-title"><span class="section-icon">ğŸ’¬</span> <span class="sv-text">Uttryck</span><span class="ar-text">ØªØ¹Ø§Ø¨ÙŠØ±</span></h3>
                    <div class="example-card idiom-card">
                        ${d?`<div class="ex-swe-detail" dir="ltr">${A}</div>`:""}
                        ${g?`<div class="ex-arb-detail" dir="rtl">${g}</div>`:""}
                    </div>
                </div>
                `:""}
            </div>
        `;m.innerHTML=B,Q.setupListeners(m);const E=m.querySelector(".word-swe-hero");E&&X.apply(E,a);const K=m.querySelector(".word-arb-hero");K&&X.apply(K,n),m.querySelectorAll(".def-text, .ex-swe-detail, .ex-arb-detail").forEach(v=>{X.apply(v,v.textContent||"")});const N=Z.getLanguage();N==="sv"?document.title=`${a} - SnabbaLexin`:N==="ar"?document.title=`${n} - Ø³Ù†Ø§Ø¨Ø§ Ù„ÙƒØ³ÙŠÙ†`:document.title=`${a} | ${n} - SnabbaLexin`,setTimeout(()=>{C.init(a)},100),m.addEventListener("mousemove",v=>{const S=m.querySelector(".hero-inner");if(!S)return m.querySelector(".hero-inner"),void 0;const L=S.getBoundingClientRect(),F=v.clientX-L.left,h=v.clientY-L.top,y=L.width/2,I=L.height/2,T=(h-I)/I*-10,ot=(F-y)/y*10;S.style.transform=`perspective(1000px) rotateX(${T}deg) rotateY(${ot}deg)`}),m.addEventListener("mouseleave",()=>{const v=m.querySelector(".hero-inner");v&&(v.style.transform="perspective(1000px) rotateX(0) rotateY(0)")});const V=m.querySelector(".details-hero");V&&V.addEventListener("dblclick",v=>{const S=v;vt.spawn(S.clientX,S.clientY);const L=document.getElementById("headerFavoriteBtn");L&&L.click()})}setupHeaderActions(t,e){const s=t[2],a=t[0].toString(),n=a.startsWith("local_")||a.length>20,i=document.getElementById("headerAudioBtn");i&&(i.onclick=()=>P.speak(s,"sv"));const r=document.getElementById("headerFavoriteBtn");r&&(_.updateButtonIcon(r,e),r.onclick=()=>this.toggleFavorite(a,r));const l=document.getElementById("headerFlashcardBtn");l&&(l.onclick=()=>{window.location.href=`games/flashcards.html?id=${a}`});const o=document.getElementById("customActions");o&&(o.style.display=n?"flex":"none");const c=document.getElementById("editBtn");c&&(c.onclick=()=>{window.location.href=`add.html?edit=${a}`});const d=document.getElementById("deleteBtn");d&&(d.onclick=async()=>{confirm(W("details.confirmDelete"))&&(await z.deleteWord(a),q('<span class="sv-text">Ordet borttaget</span><span class="ar-text">ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙ„Ù…Ø©</span>'),setTimeout(()=>window.location.href="index.html",1e3))});const g=document.getElementById("smartCopyBtn");g&&(g.onclick=()=>{navigator.clipboard.writeText(s).then(()=>q('<span class="sv-text">Kopierat</span><span class="ar-text">ØªÙ… Ø§Ù„Ù†Ø³Ø®</span> ğŸ“‹'))});const f=document.getElementById("headerShareBtn");f&&(f.onclick=()=>{const m=Z.getLanguage()==="ar"?`ğŸ“š ØªØ¹Ù„Ù…Øª ÙƒÙ„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©!

ğŸ‡¸ğŸ‡ª ${s}
ğŸ‡¸ğŸ‡¦ ${t[3]}

#SnabbaLexin`:`ğŸ“š Jag lÃ¤rde mig ett nytt ord!

ğŸ‡¸ğŸ‡ª ${s}
ğŸ‡¸ğŸ‡¦ ${t[3]}

#SnabbaLexin`;navigator.share?navigator.share({title:`Lexin: ${s}`,text:m,url:window.location.href}).catch(console.error):navigator.clipboard.writeText(window.location.href).then(()=>q('<span class="sv-text">LÃ¤nk kopierad</span><span class="ar-text">ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</span> ğŸ”—'))})}toggleFavorite(t,e){const s=_.toggle(t);_.updateButtonIcon(e,s)}getTypeGlowClass(t){const e=t.toLowerCase();return e.includes("verb")?"glow-verb":e.includes("subst")||e.includes("noun")?"glow-noun":e.includes("adj")?"glow-adjective":e.includes("adv")?"glow-adverb":e.includes("prep")?"glow-preposition":"glow-default"}}typeof window<"u"&&(window.detailsManager=new xt);
