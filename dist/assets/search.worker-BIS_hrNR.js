(function(){"use strict";function y(f){if(!f)return"";let r=f.replace(/[\u064B-\u065F\u0670]/g,"");return r=r.replace(/[أإآ]/g,"ا"),r=r.replace(/ة/g,"ه"),r=r.replace(/ى/g,"ي"),r}let b=[];self.onmessage=f=>{try{const{type:r,payload:h}=f.data;if(r==="INIT_DATA"){const p=h;self.dictionaryData=p,b=p.map(c=>({swe:(c[2]||"").toLowerCase(),arb:y(c[3]||"").toLowerCase()})),self.postMessage({type:"DATA_LOADED"})}else if(r==="SEARCH"){const{options:p,favIds:c}=h,n=self.dictionaryData||[];if(n.length===0){self.postMessage({type:"SEARCH_RESULT",payload:{results:[],stats:{total:0,types:{},categories:{}}}});return}console.log(`Worker searching for: "${p.query}" in ${n.length} words...`);const u=w(n,p,c);console.log(`Worker found ${u.results.length} matches.`),self.postMessage({type:"SEARCH_RESULT",payload:u})}}catch(r){console.error("Worker Search Error:",r),self.postMessage({type:"ERROR",payload:r.message})}};function w(f,r,h){const{query:p,mode:c,type:n,sort:u}=r,m=y(p.trim().toLowerCase()),s={total:0,types:{},categories:{}},W=c==="favorites"||n!=="all",k=!!m,v=c==="favorites"?new Set(h):null;let g=[];for(let i=0;i<f.length;i++){const d=f[i];if(v&&!v.has(d[0].toString()))continue;let l=!1;if(k){const t=b[i];if(!t)continue;const o=m;c==="start"?l=t.swe.startsWith(o)||t.arb.startsWith(o):c==="end"?l=t.swe.endsWith(o)||t.arb.endsWith(o):c==="exact"?l=t.swe===o||t.arb===o:l=t.swe.includes(o)||t.arb.includes(o)}else l=!0;if(!l)continue;const e=(d[1]||"").toLowerCase();if(s.types.all=(s.types.all||0)+1,(e.includes("subst")||e==="noun")&&(s.types.subst=(s.types.subst||0)+1),e.includes("verb")&&(s.types.verb=(s.types.verb||0)+1),e.includes("adj")&&(s.types.adj=(s.types.adj||0)+1),e.includes("adv")&&(s.types.adv=(s.types.adv||0)+1),e.includes("prep")&&(s.types.prep=(s.types.prep||0)+1),e.includes("pron")&&(s.types.pron=(s.types.pron||0)+1),e.includes("konj")&&(s.types.konj=(s.types.konj||0)+1),(e.includes("fras")||e.includes("uttin")||e.includes("idiom"))&&(s.types.fras=(s.types.fras||0)+1),e.includes("juridik")&&(s.types.juridik=(s.types.juridik||0)+1),e.includes("medicin")&&(s.types.medicin=(s.types.medicin||0)+1),(e.includes("it")||e.includes("teknik")||e.includes("data")||e.includes("dator"))&&(s.types.it=(s.types.it||0)+1),!k&&!W)continue;let a=!0;if(n!=="all"){let t=!1;(n==="subst"&&(e.includes("subst")||e==="noun")||n==="verb"&&e.includes("verb")||n==="adj"&&e.includes("adj")||n==="adv"&&e.includes("adv")||n==="prep"&&e.includes("prep")||n==="pron"&&e.includes("pron")||n==="konj"&&e.includes("konj")||n==="fras"&&(e.includes("fras")||e.includes("uttin")||e.includes("idiom"))||n==="juridik"&&e.includes("juridik")||n==="medicin"&&e.includes("medicin")||n==="it"&&(e.includes("it")||e.includes("teknik")||e.includes("data")||e.includes("dator")))&&(t=!0),t||(a=!1)}a&&g.push(d)}s.total=g.length;const A=1e3;return g.sort((i,d)=>{const l=i[2].toLowerCase(),e=d[2].toLowerCase();if(u==="alpha_asc"||u==="az")return l.localeCompare(e,"sv");if(u==="alpha_desc"||u==="za")return e.localeCompare(l,"sv");if(u==="last_char")return l.slice(-1).localeCompare(e.slice(-1),"sv");if(u==="richness"){const R=(i[5]||"").length+(i[7]||"").length+(i[9]||"").length;return(d[5]||"").length+(d[7]||"").length+(d[9]||"").length-R}const a=m,t=y(i[3]||"").toLowerCase(),o=y(d[3]||"").toLowerCase(),S=l===a||t===a,j=e===a||o===a;if(S&&!j)return-1;if(!S&&j)return 1;const L=l.startsWith(a)||t.startsWith(a),C=e.startsWith(a)||o.startsWith(a);return L&&!C?-1:!L&&C?1:l.length-e.length}),{results:g.slice(0,A).map(i=>({id:i[0],type:i[1],swedish:i[2],arabic:i[3],forms:i[6],definition:i[5],example:i[7],gender:i[13]})),stats:s}}})();
