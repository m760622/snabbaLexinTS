(function(){"use strict";function h(y){if(!y)return"";let l=y.replace(/[\u064B-\u065F\u0670]/g,"");return l=l.replace(/[أإآ]/g,"ا"),l=l.replace(/ة/g,"ه"),l=l.replace(/ى/g,"ي"),l}let f=[];self.onmessage=y=>{try{const{type:l,payload:g}=y.data;if(l==="INIT_DATA"){const c=g;self.dictionaryData=c,console.log("[SearchWorker] Building optimized index for "+c.length+" words"),f=new Array(c.length);for(let o=0;o<c.length;o++)f[o]={s:(c[o][2]||"").toLowerCase(),a:h(c[o][3]||"").toLowerCase()};self.postMessage({type:"DATA_LOADED"})}else if(l==="SEARCH"){const{options:c,favIds:o}=g,t=self.dictionaryData||[];if(t.length===0){self.postMessage({type:"SEARCH_RESULT",payload:{results:[],stats:{total:0,types:{}}}});return}if(!f||f.length!==t.length){console.warn("[SearchWorker] Index mismatch (Data: "+t.length+", Index: "+(f?f.length:0)+"). Rebuilding..."),f=new Array(t.length);for(let r=0;r<t.length;r++)f[r]={s:(t[r][2]||"").toLowerCase(),a:h(t[r][3]||"").toLowerCase()}}const p=C(t,c,o);self.postMessage({type:"SEARCH_RESULT",payload:p})}}catch(l){console.error("Worker Search Error:",l),self.postMessage({type:"ERROR",payload:l.message})}};function C(y,l,g){const{query:c,mode:o,type:t,sort:p}=l,r=h(c.trim().toLowerCase()),s={total:0,types:{}},j=o==="favorites"||t!=="all",v=!!r,L=o==="favorites"?new Set(g):null;let m=[];const w=y.length;for(let n=0;n<w;n++){const u=y[n];if(L&&!L.has(u[0].toString()))continue;let a=!1;if(v){const i=f[n];if(i){const d=r;o==="start"?(i.s.startsWith(d)||i.a.startsWith(d))&&(a=!0):o==="end"?(i.s.endsWith(d)||i.a.endsWith(d))&&(a=!0):o==="exact"?(i.s===d||i.a===d)&&(a=!0):(i.s.includes(d)||i.a.includes(d))&&(a=!0)}else{const d=(u[2]||"").toLowerCase(),A=h(u[3]||"").toLowerCase();(d.includes(r)||A.includes(r))&&(a=!0)}}else a=!0;if(!a)continue;const e=(u[1]||"").toLowerCase();s.types.all=(s.types.all||0)+1;const k=e.includes("subst")||e==="noun";if(k&&(s.types.subst=(s.types.subst||0)+1),e.includes("verb")&&(s.types.verb=(s.types.verb||0)+1),e.includes("adj")&&(s.types.adj=(s.types.adj||0)+1),e.includes("adv")&&(s.types.adv=(s.types.adv||0)+1),e.includes("prep")&&(s.types.prep=(s.types.prep||0)+1),e.includes("pron")&&(s.types.pron=(s.types.pron||0)+1),e.includes("konj")&&(s.types.konj=(s.types.konj||0)+1),(e.includes("fras")||e.includes("uttin")||e.includes("idiom"))&&(s.types.fras=(s.types.fras||0)+1),e.includes("juridik")&&(s.types.juridik=(s.types.juridik||0)+1),e.includes("medicin")&&(s.types.medicin=(s.types.medicin||0)+1),(e.includes("it")||e.includes("teknik")||e.includes("data")||e.includes("dator"))&&(s.types.it=(s.types.it||0)+1),!v&&!j)continue;let S=!0;if(t!=="all"){let i=!1;(t==="subst"&&k||t==="verb"&&e.includes("verb")||t==="adj"&&e.includes("adj")||t==="adv"&&e.includes("adv")||t==="prep"&&e.includes("prep")||t==="pron"&&e.includes("pron")||t==="konj"&&e.includes("konj")||t==="fras"&&(e.includes("fras")||e.includes("uttin")||e.includes("idiom"))||t==="juridik"&&e.includes("juridik")||t==="medicin"&&e.includes("medicin")||t==="it"&&(e.includes("it")||e.includes("teknik")||e.includes("data")||e.includes("dator")))&&(i=!0),i||(S=!1)}S&&m.push(u)}s.total=m.length;const b=1e3;return m.sort((n,u)=>{const a=n[2].toLowerCase(),e=u[2].toLowerCase();if(a===r&&e!==r)return-1;if(e===r&&a!==r)return 1;if(p==="alpha_asc"||p==="az")return a.localeCompare(e,"sv");if(p==="alpha_desc"||p==="za")return e.localeCompare(a,"sv");if(p==="last_char")return a.slice(-1).localeCompare(e.slice(-1),"sv");if(p==="richness"){const k=(n[5]||"").length+(n[7]||"").length+(n[9]||"").length;return(u[5]||"").length+(u[7]||"").length+(u[9]||"").length-k}return a.length-e.length}),{results:m.slice(0,b).map(n=>({id:n[0],type:n[1],swedish:n[2],arabic:n[3],forms:n[6],definition:n[5],example:n[7],gender:n[13]})),stats:s}}})();
