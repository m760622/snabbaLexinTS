var b=Object.defineProperty;var C=(c,t,e)=>t in c?b(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var m=(c,t,e)=>C(c,typeof t!="symbol"?t+"":t,e);import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import"./loader-CKTsN5EW.js";import{showToast as E,TextSizeManager as y,ThemeManager as x,CategoryHelper as k,GrammarHelper as T}from"./utils-B-9iATqE.js";import{T as B}from"./tts-kfGpRYBQ.js";import{Q as h,F as v}from"./quiz-stats-txqAuu3g.js";import"./db-TWgxRddZ.js";const w=[{id:"first_quiz",title:"F√∂rsta testet",titleAr:"ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ£ŸàŸÑ",description:"Avsluta ditt f√∂rsta quiz",icon:"üéØ",condition:()=>h.getStats().totalQuizzes>=1},{id:"streak_5",title:"5 i rad",titleAr:"5 ŸÖÿ™ÿ™ÿßŸÑŸäÿ©",description:"F√• 5 r√§tt svar i rad",icon:"üî•",condition:()=>h.getStats().bestStreak>=5},{id:"streak_10",title:"10 i rad",titleAr:"10 ŸÖÿ™ÿ™ÿßŸÑŸäÿ©",description:"F√• 10 r√§tt svar i rad",icon:"‚ö°",condition:()=>h.getStats().bestStreak>=10},{id:"correct_50",title:"50 r√§tt",titleAr:"50 ÿµÿ≠Ÿäÿ≠",description:"Svara r√§tt p√• 50 fr√•gor totalt",icon:"üìö",condition:()=>h.getStats().totalCorrect>=50},{id:"correct_100",title:"100 r√§tt",titleAr:"100 ÿµÿ≠Ÿäÿ≠",description:"Svara r√§tt p√• 100 fr√•gor totalt",icon:"üèÜ",condition:()=>h.getStats().totalCorrect>=100},{id:"correct_500",title:"Ordm√§stare",titleAr:"ÿ≥ŸäÿØ ÿßŸÑŸÉŸÑŸÖÿßÿ™",description:"Svara r√§tt p√• 500 fr√•gor totalt",icon:"üëë",condition:()=>h.getStats().totalCorrect>=500},{id:"speed_demon",title:"Snabbt√§nkt",titleAr:"ÿ≥ÿ±Ÿäÿπ ÿßŸÑÿ®ÿØŸäŸáÿ©",description:"Svara p√• under 2 sekunder",icon:"‚è±Ô∏è",condition:()=>h.getStats().fastestResponse<2e3},{id:"perfect_10",title:"Perfekt 10",titleAr:"ÿπÿ¥ÿ±ÿ© ŸÖÿ´ÿßŸÑŸäÿ©",description:"F√• 10/10 i ett quiz",icon:"üíØ",condition:()=>!1},{id:"accuracy_90",title:"Tr√§ffs√§ker",titleAr:"ÿØŸÇÿ© ÿπÿßŸÑŸäÿ©",description:"Uppn√• 90% noggrannhet (minst 50 svar)",icon:"üéØ",condition:()=>{const c=h.getStats();return c.totalCorrect+c.totalWrong>=50&&h.getAccuracy()>=90}},{id:"quiz_10",title:"Flitig √∂vare",titleAr:"ŸÖÿ™ÿØÿ±ÿ® ŸÖÿ¨ÿ™ŸáÿØ",description:"Avsluta 10 quiz",icon:"üìù",condition:()=>h.getStats().totalQuizzes>=10}];class q{constructor(){m(this,"STORAGE_KEY","achievements");m(this,"unlocked");this.unlocked=this.load()}load(){const t=localStorage.getItem(this.STORAGE_KEY);return t?new Set(JSON.parse(t)):new Set}save(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(Array.from(this.unlocked)))}check(){const t=[];for(const e of w)!this.unlocked.has(e.id)&&e.condition()&&(this.unlock(e),t.push(e));return t}unlock(t){this.unlocked.has(t.id)||(this.unlocked.add(t.id),this.save(),E(`${t.icon} ${t.title} - ${t.titleAr}`),this.playCelebration())}unlockById(t){const e=w.find(n=>n.id===t);e&&this.unlock(e)}playCelebration(){}getUnlocked(){return w.filter(t=>this.unlocked.has(t.id))}getLocked(){return w.filter(t=>!this.unlocked.has(t.id))}getProgress(){return{unlocked:this.unlocked.size,total:w.length,percent:Math.round(this.unlocked.size/w.length*100)}}getAll(){return w}}const I=new q;typeof window<"u"&&(window.Achievements=I);class A{constructor(){m(this,"data",[]);m(this,"questions",[]);m(this,"currentIndex",0);m(this,"score",0);m(this,"isAnswered",!1);m(this,"container",null);m(this,"currentWord",null);m(this,"mode","normal");m(this,"questionCount",10);m(this,"timerSeconds",10);m(this,"timerInterval",null);m(this,"timeLeft",0);this.container=document.getElementById("quizInlineContainer"),this.init()}init(){const t=document.getElementById("quickQuizBtn"),e=document.getElementById("quizBtn"),n=document.getElementById("closeQuiz"),i=document.getElementById("nextQuestion"),s=document.getElementById("restartQuiz"),r=document.getElementById("quizModeSelect");t&&(t.onclick=()=>this.start()),e&&(e.onclick=()=>this.start()),n&&(n.onclick=()=>this.hide()),i&&(i.onclick=()=>this.next()),s&&(s.onclick=()=>this.start()),r&&(r.onchange=()=>{this.mode=r.value,console.log("[Quiz] Mode changed to:",this.mode),this.container&&!this.container.classList.contains("hidden")&&this.start()},this.mode=r.value);const o=document.getElementById("quizFavBtn");o&&(o.onclick=()=>this.toggleCurrentFavorite(o)),document.addEventListener("keydown",l=>this.handleKeyboard(l)),window.addEventListener("dictionaryLoaded",()=>{this.data=window.dictionaryData||[]}),window.dictionaryData&&(this.data=window.dictionaryData)}handleKeyboard(t){if(!(!this.container||this.container.classList.contains("hidden"))){if(t.key>="1"&&t.key<="4"){const e=parseInt(t.key)-1,n=document.querySelectorAll(".quiz-option");n[e]&&n[e].click()}(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),this.isAnswered&&this.next())}}start(t){if(t&&(this.mode=t),!this.data||this.data.length<5){E("Laddar ordbok... / ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇÿßŸÖŸàÿ≥ ‚è≥");return}if(this.questions=this.getQuestions(),this.questions.length===0){E("Inga ord tillg√§ngliga f√∂r detta l√§ge / ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÉŸÑŸÖÿßÿ™ ŸÖÿ™ÿßÿ≠ÿ©");return}this.currentIndex=0,this.score=0,this.isAnswered=!1,h.resetSession(),this.container&&(this.container.classList.remove("hidden"),this.container.scrollIntoView({behavior:"smooth",block:"center"}));const e=document.getElementById("quizEndScreen");e&&e.classList.add("hidden");const n=document.querySelector(".quiz-body");n&&Array.from(n.children).forEach(i=>{i.id!=="quizEndScreen"&&(i.style.display="block")}),this.updateProgressBar(),this.showQuestion(),this.updateScore()}hide(){this.stopTimer(),h.endSession(),this.container&&this.container.classList.add("hidden")}getQuestions(){let t=[];switch(this.mode){case"favorites":const n=v.getAll();t=this.data.filter(s=>n.includes(s[0].toString()));break;case"weak":const i=h.getWeakWords(20);t=this.data.filter(s=>i.includes(s[0].toString())),t.length<5&&(t=this.data);break;default:t=this.data}const e=[...t].sort(()=>.5-Math.random());return e.slice(0,Math.min(this.questionCount,e.length))}showQuestion(){const t=this.questions[this.currentIndex];this.currentWord=t;const e=t[2],n=t[3];let i="",s="",r="arb";this.mode==="reverse"?(i=n,s=e,r="swe"):this.mode==="listening"?(i="üîä Lyssna och v√§lj r√§tt ord",s=n,B.speak(e,"sv")):(i=e,s=n);const o=document.getElementById("quizQuestion");o&&(o.textContent=i,o.dir=this.mode==="reverse"?"rtl":"ltr",y.apply(o,i));const l=document.getElementById("quizExample");if(l)if(this.mode==="listening")l.textContent="";else{const g=t[7]||"";l.textContent=g,y.apply(l,g)}const d=document.getElementById("quizOptions");d&&(d.innerHTML="",this.generateOptions(t,r).forEach((f,S)=>{const p=document.createElement("button");p.className="quiz-option",p.textContent=f,p.dir=r==="arb"?"rtl":"ltr",y.apply(p,f),p.setAttribute("data-key",(S+1).toString()),p.onclick=()=>this.handleAnswer(f,s,p),d.appendChild(p)}));const a=document.getElementById("quizFeedback");a&&(a.textContent="",a.className="quiz-feedback");const u=document.getElementById("nextQuestion");u&&(u.disabled=!0),this.isAnswered=!1,this.mode==="timed"&&this.startTimer(),h.startQuestion(),this.mode==="normal"&&B.speak(e,"sv"),this.updateProgressBar()}generateOptions(t,e){const n=e==="arb"?t[3]:t[2],i=t[1],s=[],r=this.data.filter(d=>d[1]===i&&d[0]!==t[0]),l=[...r.length>=3?r:this.data].sort(()=>.5-Math.random());for(const d of l){if(s.length>=3)break;const a=e==="arb"?d[3]:d[2];a!==n&&!s.includes(a)&&s.push(a)}return[n,...s].sort(()=>.5-Math.random())}handleAnswer(t,e,n){if(this.isAnswered)return;this.isAnswered=!0,this.stopTimer();const i=t===e,s=this.currentWord[0].toString(),r=h.recordAnswer(s,i),o=window.app;if(o&&(typeof o.updateDailyChallenge=="function"&&o.updateDailyChallenge(),typeof o.updateDailyProgressBar=="function"&&o.updateDailyProgressBar()),i){this.score++,n.classList.add("correct");const d=h.formatTime(r);this.showFeedback(`R√§tt! ${d} / ÿµÿ≠Ÿäÿ≠ ‚úÖ`,!0)}else n.classList.add("wrong"),this.showFeedback(`Fel! R√§tt: ${e} / ÿÆÿ∑ÿ£ ‚ùå`,!1),document.querySelectorAll(".quiz-option").forEach(d=>{d.textContent===e&&d.classList.add("correct")});this.updateScore();const l=document.getElementById("nextQuestion");l&&(l.disabled=!1),this.mode==="reverse"?B.speak(e,"sv"):B.speak(e,"ar")}startTimer(){this.timeLeft=this.timerSeconds,this.updateTimerDisplay(),this.timerInterval=window.setInterval(()=>{this.timeLeft--,this.updateTimerDisplay(),this.timeLeft<=0&&(this.stopTimer(),this.timeOut())},1e3)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}updateTimerDisplay(){const t=document.getElementById("quizTimer");t&&(t.textContent=this.timeLeft.toString(),t.classList.toggle("warning",this.timeLeft<=3))}timeOut(){if(this.isAnswered)return;this.isAnswered=!0;const t=this.currentWord[0].toString();h.recordAnswer(t,!1),this.showFeedback("Tiden √§r slut! / ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸàŸÇÿ™ ‚è±Ô∏è",!1);const e=this.mode==="reverse"?this.currentWord[2]:this.currentWord[3];document.querySelectorAll(".quiz-option").forEach(i=>{i.textContent===e&&i.classList.add("correct")}),this.updateScore();const n=document.getElementById("nextQuestion");n&&(n.disabled=!1)}showFeedback(t,e){const n=document.getElementById("quizFeedback");n&&(n.textContent=t,n.className=`quiz-feedback ${e?"correct":"wrong"}`)}updateScore(){const t=document.getElementById("quizScore");t&&(t.textContent=this.score.toString())}updateProgressBar(){const t=document.getElementById("quizProgress");if(t){const n=this.currentIndex/this.questions.length*100;t.style.width=`${n}%`}const e=document.getElementById("quizProgressText");e&&(e.textContent=`${this.currentIndex+1}/${this.questions.length}`)}toggleCurrentFavorite(t){if(!this.currentWord)return;const e=this.currentWord[0].toString(),n=v.toggle(e);t.classList.toggle("active",n);const i=t.querySelector("svg");i&&(n?(i.setAttribute("fill","#ef4444"),i.setAttribute("stroke","#ef4444")):(i.setAttribute("fill","none"),i.setAttribute("stroke","currentColor")))}next(){this.currentIndex++,this.currentIndex<this.questions.length?this.showQuestion():this.end()}end(){this.stopTimer(),h.endSession();const t=h.getSessionStats(),e=h.getTodayStats(),n=document.getElementById("quizEndScreen");if(n){n.classList.remove("hidden");const s=document.getElementById("endScoreValue");s&&(s.textContent=this.score.toString());const r=document.getElementById("endMessage");r&&(this.score===this.questions.length?(r.innerHTML=`üéâ Perfekt! B√§sta serien: ${t.bestStreak}`,this.showConfetti(),I.unlockById("perfect_10")):this.score>=this.questions.length*.8?r.innerHTML=`Fantastiskt! Tid: ${h.formatTime(t.avgTime)}`:this.score>=this.questions.length*.5?r.textContent="Bra jobbat! / ÿ¨ŸäÿØ ÿ¨ÿØÿßŸã üëç":r.textContent="Forts√§tt √∂va! / ÿßÿ≥ÿ™ŸÖÿ± ŸÅŸä ÿßŸÑÿ™ÿØÿ±Ÿäÿ® üí™",y.apply(r,r.textContent||"",2));const o=document.getElementById("endStats");o&&(o.innerHTML=`
                    <div class="end-stat"><span>üìÖ Idag:</span> ${e.correct}/${e.total}</div>
                    <div class="end-stat"><span>üî• B√§sta serien:</span> ${t.bestStreak}</div>
                    <div class="end-stat"><span>‚è±Ô∏è Snitttid:</span> ${h.formatTime(t.avgTime)}</div>
                `)}const i=document.querySelector(".quiz-body");i&&Array.from(i.children).forEach(s=>{s.id!=="quizEndScreen"&&(s.style.display="none")})}showConfetti(){const t=this.container;if(t)for(let e=0;e<50;e++){const n=document.createElement("div");n.className="confetti",n.style.left=Math.random()*100+"%",n.style.animationDelay=Math.random()*2+"s",n.style.backgroundColor=["#10B981","#6366f1","#F59E0B","#EF4444","#8B5CF6"][Math.floor(Math.random()*5)],t.appendChild(n),setTimeout(()=>n.remove(),3e3)}}}typeof window<"u"&&(window.QuizManager=new A);function M(){console.log("Initializing Main UI..."),z(),F(),D(),$(),Q(),P(),O(),W()}function z(){const c=localStorage.getItem("theme")||"dark";if(c==="auto"){const t=new Date().getHours(),e=t>=18||t<7;document.documentElement.setAttribute("data-theme",e?"dark":"light")}else document.documentElement.setAttribute("data-theme",c)}function F(){const c=document.getElementById("settingsBtn"),t=document.getElementById("settingsMenu");c&&t&&(c.addEventListener("click",e=>{e.stopPropagation(),t.classList.toggle("hidden")}),document.addEventListener("click",e=>{const n=e.target;!t.contains(n)&&!c.contains(n)&&t.classList.add("hidden")}))}function D(){const c=document.getElementById("mobileViewToggle");c&&c.addEventListener("click",()=>{var t;(t=window.MobileViewManager)==null||t.toggle()}),window.toggleMobileView=()=>{var t;return(t=window.MobileViewManager)==null?void 0:t.toggle()}}function $(){const c=document.getElementById("progressBadge"),t=document.getElementById("progressModal"),e=document.getElementById("closeProgress");c&&t&&c.addEventListener("click",()=>{t.style.display="flex",t.classList.remove("hidden")}),e&&t&&(e.addEventListener("click",()=>{t.style.display="none"}),t.addEventListener("click",n=>{n.target===t&&(t.style.display="none")}))}function Q(){const c=document.getElementById("quickWodBtn");c&&c.addEventListener("click",()=>{const n=document.getElementById("wordOfTheDay");n&&(n.scrollIntoView({behavior:"smooth",block:"center"}),n.classList.add("pulse-animation"),setTimeout(()=>n.classList.remove("pulse-animation"),500))});const t=document.getElementById("quickFavBtn");t&&t.addEventListener("click",()=>{var n;(n=window.app)==null||n.performSearch("favorites")});const e=document.getElementById("quickQuizBtn");e&&e.addEventListener("click",()=>{var n,i;(i=(n=window.QuizManager)==null?void 0:n.start)==null||i.call(n)})}function P(){const c=document.getElementById("onboardingModal");if(!c)return;const t=document.querySelectorAll(".onboarding-slide"),e=document.querySelectorAll(".dot"),n=document.getElementById("nextSlide"),i=document.getElementById("prevSlide"),s=document.getElementById("skipOnboarding");let r=0;const o=t.length;localStorage.getItem("onboardingComplete")||(c.style.display="flex",c.classList.remove("hidden"));function l(a){t.forEach((g,f)=>g.classList.toggle("active",f===a)),e.forEach((g,f)=>g.classList.toggle("active",f===a)),i&&(i.style.visibility=a===0?"hidden":"visible"),n&&(n.textContent=a===o-1?"B√∂rja! üöÄ":"N√§sta ‚ü∂");const u=t[a];u&&u.querySelectorAll("h2, p").forEach(g=>{y.apply(g,g.textContent||"")})}function d(){localStorage.setItem("onboardingComplete","true"),c.style.opacity="0",setTimeout(()=>{c.style.display="none"},300)}n&&n.addEventListener("click",()=>{r<o-1?(r++,l(r)):d()}),i&&i.addEventListener("click",()=>{r>0&&(r--,l(r))}),s&&s.addEventListener("click",d),e.forEach((a,u)=>{a.addEventListener("click",()=>{r=u,l(r)})})}function O(){const c=document.getElementById("saveGoalBtn"),t=document.getElementById("dailyGoalInput");c&&t&&c.addEventListener("click",()=>{var e,n;localStorage.setItem("dailyGoal",t.value),(e=window.app)==null||e.updateDailyProgressBar(),(n=window.showToast)==null||n.call(window,"M√•l sparat! / ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸáÿØŸÅ üéØ")})}function W(){document.querySelectorAll(".game-card h3, .section-title, .stat-label").forEach(c=>{y.apply(c,c.textContent||"")})}class H{constructor(){m(this,"isLoading",!0);m(this,"searchIndex",[]);m(this,"currentResults",[]);m(this,"BATCH_SIZE",20);m(this,"renderedCount",0);m(this,"activeFilterMode","all");m(this,"activeTypeFilter","all");m(this,"activeSortMethod","relevance");this.init()}async init(){M(),this.initStreaks(),this.setupSearchListeners(),this.setupThemeListener(),this.initQuickActions(),this.setupInfiniteScroll(),this.setupGlobalHandlers(),this.setupFilters(),this.updateDailyChallenge(),this.updateDailyProgressBar(),window.addEventListener("dictionaryLoaded",()=>{console.log("[App] Data loaded event received"),this.handleDataLoaded()}),window.dictionaryData&&window.dictionaryData.length>0&&this.handleDataLoaded()}initStreaks(){const t="lastVisitDate",e="dailyStreak",n=new Date().toISOString().split("T")[0],i=localStorage.getItem(t);let s=parseInt(localStorage.getItem(e)||"0");if(i!==n){const o=new Date;o.setDate(o.getDate()-1);const l=o.toISOString().split("T")[0];i===l?s++:s=1,localStorage.setItem(t,n),localStorage.setItem(e,s.toString())}const r=document.getElementById("currentStreak");r&&(r.innerHTML=s.toString())}setupThemeListener(){const t=document.getElementById("themeToggle");t&&t.addEventListener("click",()=>{x.toggle()})}setupSearchListeners(){const t=document.getElementById("searchInput");if(!t)return;t.addEventListener("input",n=>this.handleSearch(n));const e=document.getElementById("clearSearch");t.addEventListener("input",()=>{e&&(e.style.display=t.value.length>0?"flex":"none")}),e&&e.addEventListener("click",()=>{t.value="",e.style.display="none",this.performSearch("")})}setupFilters(){const t=document.getElementById("filterModeSelect"),e=document.getElementById("typeSelect"),n=document.getElementById("sortSelect"),i=document.getElementById("categorySelect"),s=document.getElementById("quickFavBtn"),r=()=>{t&&(this.activeFilterMode=t.value),e&&(this.activeTypeFilter=e.value),n&&(this.activeSortMethod=n.value);const d=document.getElementById("searchInput");this.performSearch((d==null?void 0:d.value)||"")};t&&t.addEventListener("change",r),e&&e.addEventListener("change",r),n&&n.addEventListener("change",r),i&&i.addEventListener("change",r),s&&s.addEventListener("click",()=>{t&&(t.value=t.value==="favorites"?"all":"favorites",r())});const o=document.getElementById("filterToggleBtn"),l=document.getElementById("filterChipsContainer");o&&l&&o.addEventListener("click",()=>{l.classList.toggle("hidden"),o.classList.toggle("active")})}handleDataLoaded(){this.isLoading&&(this.isLoading=!1,console.log("[App] Initializing dictionary visual data..."),this.loadDictionaryData())}loadDictionaryData(){const t=window.dictionaryData;t&&(this.searchIndex=t.map(e=>`${e[2]} ${e[3]}`.toLowerCase()),this.initWordOfTheDay(),this.performSearch(""))}initWordOfTheDay(){const t=window.dictionaryData;if(!t||t.length===0)return;let e=null,n=0;for(;n<500;){const i=Math.floor(Math.random()*t.length),s=t[i],r=s[9]&&s[9].length>0||s[10]&&s[10].length>0,o=s[7]&&s[7].split(" ").length>5;if(r||o){e=s;break}n++}e||(e=t[Math.floor(Math.random()*t.length)]),h.recordStudy(e[0].toString()),this.renderWod(e)}renderWod(t){const e=document.getElementById("wordOfTheDay");if(!e)return;e.classList.remove("hidden");const n=e.querySelector(".wod-swe"),i=e.querySelector(".wod-arb"),s=e.querySelector(".wod-type-badge");n&&(n.textContent=t[2],y.apply(n,t[2])),i&&(i.textContent=t[3],y.apply(i,t[3])),s&&(s.textContent=t[1]),Object.entries({".wod-forms-preview":6,".wod-def-preview":5,".wod-example-preview":7,".wod-example-arb-preview":8,".wod-idiom-preview":9}).forEach(([u,g])=>{const f=e.querySelector(u);if(f){const S=t[g]&&t[g].length>0;if(f.classList.toggle("hidden",!S),S){const p=f.querySelector(".wod-def-text, .wod-example-text, .wod-forms-chips, .wod-idiom-swe");p&&(u===".wod-forms-chips"?p.innerHTML=t[g].split(",").map(L=>`<span class="wod-form-chip">${L.trim()}</span>`).join(""):(p.textContent=t[g],y.apply(p,t[g])))}}});const o=document.getElementById("wodTTSBtn");o&&(o.onclick=()=>{var u;return(u=window.TTSManager)==null?void 0:u.speak(t[2],"sv")});const l=document.getElementById("wodDetailsBtn");l&&(l.onclick=()=>window.location.href=`details.html?id=${t[0]}`);const d=document.getElementById("wodLoopBtn");d&&(d.onclick=()=>this.initWordOfTheDay());const a=document.getElementById("wodFavBtn");if(a){const u=t[0].toString(),g=v.has(u);v.updateButtonIcon(a,g),a.onclick=()=>{const f=v.toggle(u);v.updateButtonIcon(a,f)}}}initQuickActions(){const t=document.getElementById("quickWodBtn");t&&t.addEventListener("click",()=>{const e=document.getElementById("wordOfTheDay");e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("pulse-animation"),setTimeout(()=>e.classList.remove("pulse-animation"),500))})}handleSearch(t){const e=t.target.value;this.performSearch(e)}performSearch(t){const e=window.dictionaryData;if(!e)return;const n=t.toLowerCase().trim(),i=document.getElementById("landingPageContent"),s=document.getElementById("searchResults"),r=document.getElementById("emptyState");this.renderedCount=0;let o=e;this.activeFilterMode==="favorites"&&(o=o.filter(a=>v.has(a[0].toString()))),n&&(o=o.filter((a,u)=>this.searchIndex[u].includes(n))),this.activeTypeFilter!=="all"&&(o=o.filter(a=>k.getCategory(a[1],a[2],a[6])===this.activeTypeFilter));const l=document.getElementById("categorySelect");if(l&&l.value!=="all"){const a=l.value;o=o.filter(u=>(u[11]||"").toLowerCase().includes(a))}this.activeSortMethod==="az"||this.activeSortMethod==="alpha_asc"?o=[...o].sort((a,u)=>a[2].localeCompare(u[2],"sv")):this.activeSortMethod==="za"||this.activeSortMethod==="alpha_desc"?o=[...o].sort((a,u)=>u[2].localeCompare(a[2],"sv")):this.activeSortMethod==="richness"&&(o=[...o].sort((a,u)=>{const g=(a[5]||"").length+(a[7]||"").length;return(u[5]||"").length+(u[7]||"").length-g})),this.currentResults=o,!n&&this.activeFilterMode==="all"?(i&&(i.style.display="block"),s&&(s.style.display="none",s.innerHTML=""),r&&(r.style.display="block")):(i&&(i.style.display="none"),s&&(s.style.display="grid",s.innerHTML=""),r&&(r.style.display=o.length===0?"block":"none"),this.renderNextBatch()),this.updateResultCount()}renderNextBatch(){if(this.renderedCount>=this.currentResults.length)return;const t=document.getElementById("searchResults");if(!t)return;const e=this.currentResults.slice(this.renderedCount,this.renderedCount+this.BATCH_SIZE),n=e.map(i=>this.createCard(i)).join("");t.insertAdjacentHTML("beforeend",n),this.renderedCount+=e.length,y.autoApply()}createCard(t){const e=t[0],n=t[2],i=t[3],s=t[1],r=t[6]||"",o=T.getBadge(s,r,n),l=k.getCategory(s,n,r),d=v.has(e.toString()),a=d?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#F59E0B" stroke="#F59E0B" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>';return`
            <div class="card card-link compact-card" data-type="${l}" onclick="if(!event.target.closest('button')) window.location.href='details.html?id=${e}'">
                <div class="card-header">
                    <div class="word-header-group">
                        <h2 class="word-swe" dir="ltr" data-auto-size data-max-lines="2">${n}</h2>
                    </div>
                    <div class="card-actions">
                        ${o}
                        <button class="copy-btn action-button" onclick="copyWord('${n.replace(/'/g,"\\'")}', event)" title="Kopiera">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        </button>
                        <button class="fav-btn action-button ${d?"active":""}" onclick="toggleFavorite('${e}', this, event)" title="Spara">
                            ${a}
                        </button>
                    </div>
                </div>
                <p class="word-arb" dir="rtl" data-auto-size data-max-lines="2">${i}</p>
            </div>
        `}setupInfiniteScroll(){window.addEventListener("scroll",()=>{if(this.currentResults.length===0)return;const{scrollTop:t,scrollHeight:e,clientHeight:n}=document.documentElement;t+n>=e-300&&this.renderNextBatch()})}setupGlobalHandlers(){window.copyWord=(t,e)=>{e.stopPropagation(),navigator.clipboard.writeText(t).then(()=>E("Kopierat / ÿ™ŸÖ ÿßŸÑŸÜÿ≥ÿÆ üìã"))},window.toggleFavorite=(t,e,n)=>{n.stopPropagation();const i=t.toString(),s=v.toggle(i);e.classList.toggle("active",s),e.innerHTML=s?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#F59E0B" stroke="#F59E0B" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>'}}updateResultCount(){const t=document.getElementById("resultCount");t&&(t.textContent=this.currentResults.length.toLocaleString())}updateDailyChallenge(){const t=parseInt(localStorage.getItem("dailyGoal")||"10"),e=h.getTodayStats(),n=e.correct+(e.studied||0),i=Math.min(100,n/t*100),s=document.getElementById("challengeProgressBar");s&&(s.style.width=`${i}%`,n>=t&&s.classList.add("completed"));const r=document.getElementById("challengeProgressText");r&&(r.textContent=`${n}/${t}`,n>=t&&r.classList.add("completed"));const o=document.getElementById("dailyChallengeCard");o&&n>=t&&o.classList.add("completed"),console.log(`[App] Daily challenge: ${n}/${t} (${i.toFixed(0)}%)`),this.updateDailyProgressBar()}updateDailyProgressBar(){const t=parseInt(localStorage.getItem("dailyGoal")||"10"),e=h.getTodayStats(),n=e.correct+(e.studied||0),i=Math.min(100,n/t*100),s=document.getElementById("dailyProgressCount");s&&(s.textContent=n.toString());const r=document.getElementById("dailyWordsCount");r&&(r.textContent=n.toString());const o=document.getElementById("dailyProgressFill");o&&(o.style.width=`${i}%`,n>=t&&o.classList.add("completed"));const l=document.getElementById("progressRingValue");l&&(l.textContent=n.toString());const d=document.getElementById("progressRingGoal");d&&(d.textContent=t.toString());const a=document.querySelector(".progress-ring-circle");if(a){const g=314.159-i/100*314.159;a.style.strokeDashoffset=g.toString()}console.log(`[App] Daily progress: ${n}/${t} (${i.toFixed(0)}%)`)}}typeof window<"u"&&(window.app=new H);
