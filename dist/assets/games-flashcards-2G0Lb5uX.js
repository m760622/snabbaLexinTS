import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              *//* empty css              *//* empty css                       */import{s as c,a as _}from"./games-utils-CgPy3Odt.js";import"./loader-B7oZEySq.js";import{T as k}from"./tts-BuOrQ7kI.js";import{TextSizeManager as W}from"./utils-DkwAXeNx.js";import"./config-CfHoVMbv.js";import"./i18n-1qhfGv7S.js";import"./toast-manager-CZ3snF2j.js";import"./db-bEbbjtoI.js";console.log("flashcardsGame.ts LOADED - Professional Edition");let y=[],l=0,g=0,d=0,G=0,m={correct:0,wrong:0,totalTime:0},B=0,M=0,v=0,b=0,u=localStorage.getItem("fc_autoplay")!=="false";const I=0,N=1,D=2,j=3,q=7,Y=8,f={STORAGE_KEY:"flashcard_leitner_data",BOX_INTERVALS:[1,3,7,14,30],getData(){try{return JSON.parse(localStorage.getItem(this.STORAGE_KEY)||"{}")}catch{return{}}},saveData(t){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))},getWordBox(t){var n;return((n=this.getData()[t])==null?void 0:n.box)||1},promoteWord(t){var a;const e=this.getData(),n=((a=e[t])==null?void 0:a.box)||1,o=Math.min(n+1,5);return e[t]={box:o,lastReview:Date.now(),nextReview:Date.now()+this.BOX_INTERVALS[o-1]*24*60*60*1e3},this.saveData(e),o},demoteWord(t){const e=this.getData();return e[t]={box:1,lastReview:Date.now(),nextReview:Date.now()+24*60*60*1e3},this.saveData(e),1},getBoxIcon(t){const e=["â„ï¸","ğŸŒ±","ğŸŒ¿","ğŸŒ³","ğŸ”¥"];return e[t-1]||e[0]},getDueWords(){const t=this.getData(),e=Date.now();return Object.entries(t).filter(([,n])=>n.nextReview<=e).map(([n])=>n)}};function V(){const t=document.getElementById("flashcardsGame");if(!t)return;const e=["#6366f1","#8b5cf6","#22c55e","#f59e0b","#ef4444"],n=50;for(let o=0;o<n;o++){const a=document.createElement("div");a.className="confetti-piece",a.style.cssText=`
            position: fixed;
            width: 10px;
            height: 10px;
            background: ${e[Math.floor(Math.random()*e.length)]};
            left: ${Math.random()*100}%;
            top: -10px;
            border-radius: ${Math.random()>.5?"50%":"2px"};
            animation: confettiFall ${2+Math.random()*2}s linear forwards;
            animation-delay: ${Math.random()*.5}s;
            z-index: 9999;
            pointer-events: none;
        `,t.appendChild(a),setTimeout(()=>a.remove(),4e3)}}function X(t=0){const e=document.getElementById("flashcardTypeFilter"),n=(e==null?void 0:e.value)||"all";if(typeof dictionaryData>"u"||!Array.isArray(dictionaryData)||dictionaryData.length===0){if(t<5)console.log(`Data not ready, retrying... (${t+1}/5)`),typeof c=="function"&&t===0&&c("Laddar data... / Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...","default"),setTimeout(()=>X(t+1),500);else{console.error("dictionaryData failed to load."),typeof c=="function"&&c("Kunde inte ladda data. Kontrollera din anslutning. / ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.","error");const o=document.getElementById("flashcardWord");o&&(o.innerHTML='<span style="color:red; font-size: 1rem;">Datafel / Error</span>')}return}try{let o=[...dictionaryData];if(n!=="all"&&(o=o.filter(i=>i?(i[N]||"").toLowerCase().includes(n):!1)),o=o.filter(i=>i&&i[D]&&i[D].length>0),o.length===0){console.warn("No words found for filter:",n),typeof c=="function"&&c("Inga ord hittades fÃ¶r detta filter.","error");return}o.sort((i,p)=>{const E=f.getWordBox(String(i[I])),w=f.getWordBox(String(p[I]));return E-w}),y=o.sort(()=>.5-Math.random()).slice(0,50),l=0,g=0,d=y.length,m={correct:0,wrong:0,totalTime:0};const a=document.getElementById("flashcardsGame");a&&a.style.display!=="block"&&(a.style.display="block"),R(0),J();const s=document.getElementById("flashcardProgress");s&&(s.textContent=`0/${d}`);const r=document.getElementById("flashcard");r&&r.classList.remove("flipped"),Q(),F(),nt(),console.log("Flashcards initialized successfully with",d,"cards.")}catch(o){console.error("Critical error starting Flashcards:",o),typeof c=="function"&&c("Ett fel uppstod. / Ø­Ø¯Ø« Ø®Ø·Ø£.","error")}}function J(){const t=document.getElementById("fcSegmentedProgress");if(t){t.innerHTML="";for(let e=0;e<d;e++){const n=document.createElement("div");n.className="fc-progress-segment",n.id=`fc-seg-${e}`,t.appendChild(n)}}}function C(t,e){const n=document.getElementById(`fc-seg-${t}`);n&&(document.querySelectorAll(".fc-progress-segment").forEach(o=>o.classList.remove("active")),e?(n.classList.add("completed"),n.classList.add(e)):n.classList.add("active"))}function R(t){const e=document.querySelector(".fc-progress-ring-circle");if(!e)return;const n=2*Math.PI*45,o=n-t/100*n;e.style.strokeDashoffset=String(o)}function Q(){const t=document.getElementById("flashcard");t&&(t.addEventListener("touchstart",e=>{B=e.changedTouches[0].screenX,M=B,v=Date.now()},{passive:!0}),t.addEventListener("touchmove",e=>{M=e.changedTouches[0].screenX;const n=M-B;Math.abs(n)>30&&(t.style.transform=`translateX(${n*.3}px) rotate(${n*.02}deg)`,t.style.opacity=String(Math.max(.5,1-Math.abs(n)/500)))},{passive:!0}),t.addEventListener("touchend",()=>{const e=M-B,n=Date.now()-v;t.style.transform="",t.style.opacity="",Math.abs(e)>100?(typeof HapticManager<"u"&&HapticManager.trigger("medium"),e>0?L(4):L(0)):Math.abs(e)<30&&n<500&&O()}),t.addEventListener("click",()=>{Date.now()-b<300||v>0&&Date.now()-v<500||O()}))}function O(){if(Date.now()-b<300)return;b=Date.now();const t=document.getElementById("flashcard");t&&(t.classList.toggle("flipped"),typeof HapticManager<"u"&&HapticManager.trigger("selection"),typeof SoundManager<"u"&&SoundManager.play("flip"))}function F(){if(l>=y.length){et();return}const t=y[l],e=t[D]||"",n=t[j]||"",o=t[q]||"",a=t[N]||"",s=String(t[I]),r=f.getWordBox(s);G=Date.now(),C(l,null);const i=document.getElementById("flashcardWord");i&&(i.textContent=e,typeof W<"u"&&W.apply(i,e,1,1.6));const p=document.getElementById("flashcardTranslation");p&&(p.textContent=n);const E=document.getElementById("flashcardMastery");E&&(E.innerHTML=`${f.getBoxIcon(r)} Box ${r}`);const w=document.getElementById("flashcardType");w&&(w.textContent=a);const T=document.getElementById("flashcard");T&&(r>=5?T.classList.add("shimmering"):T.classList.remove("shimmering"));const $=document.getElementById("flashcardBackWord");$&&($.textContent=e);const S=document.getElementById("flashcardBackSentence");S&&(o?(S.textContent=o,S.style.display="block"):S.style.display="none");const A=t[Y]||"",x=document.getElementById("flashcardExampleArb");x&&(A?(x.textContent=A,x.style.display="block"):x.style.display="none");const K=l/d*100;R(K);const H=document.getElementById("flashcardProgress");H&&(H.textContent=`${l+1}/${d}`);const h=document.getElementById("flashcard");h&&(h.classList.remove("flipped"),h.classList.remove("swiping-left","swiping-right","slide-out-right","slide-out-left"),h.style.transform="",h.style.opacity=""),setTimeout(()=>{typeof k<"u"&&u&&k.speak(e,"sv")},500),setTimeout(U,50)}function U(){const t=document.querySelector(".fc-front-pro"),e=document.querySelector(".fc-back-pro"),n=document.getElementById("flashcard");if(!t||!e||!n)return;const o=t.scrollHeight,a=e.scrollHeight,s=Math.max(o,a,320);n.style.height=`${s}px`}function Z(){u=!u,localStorage.setItem("fc_autoplay",String(u)),z(),typeof c=="function"&&c(u?"Auto-play: PÃ… ğŸ”Š":"Auto-play: AV ğŸ”‡")}function z(){const t=document.getElementById("fcAutoPlayToggle");t&&(t.textContent=u?"ğŸ”Š":"ğŸ”‡",t.classList.toggle("muted",!u))}function P(t,e){if(typeof c!="function")return;const o=[1,3,7,14,30][t-1]||1,a=e?`Bra! NÃ¤sta repetition om ${o} dagar (Box ${t})`:"Repetition imorgon (Box 1)";c(a)}function L(t){try{console.log("HandleRating CALLED with:",t),tt(t)}catch(e){console.error("CRITICAL ERROR in handleFlashcardRating:",e)}}function tt(t){const e=y[l];if(!e){console.error("No card found at index",l);return}const n=String(e[I]),o=Date.now()-G;if(m.totalTime+=o,t>=3){f.promoteWord(n),g++,m.correct++,typeof HapticManager<"u"&&HapticManager.trigger("success"),typeof SoundManager<"u"&&SoundManager.play("success"),C(l,"correct");const s=f.getWordBox(n);P(s,!0)}else f.demoteWord(n),m.wrong++,typeof HapticManager<"u"&&HapticManager.trigger("error"),typeof SoundManager<"u"&&SoundManager.play("error"),C(l,"wrong"),P(1,!1);if(t===0&&typeof FavoritesManager<"u"){const s=String(n);FavoritesManager.isFavorite(s)||FavoritesManager.toggle(s)}const a=document.getElementById("flashcard");if(a){const s=a.classList.contains("flipped");let r="";s?r=t>=3?"slide-out-right":"slide-out-left":r=t>=3?"slide-out-right-front":"slide-out-left-front",a.classList.add(r),setTimeout(()=>{a.classList.remove("slide-out-right","slide-out-left","slide-out-right-front","slide-out-left-front"),l++,F()},300)}else l++,F()}function et(){const t=Math.round(g/d*100),e=Math.round(m.totalTime/d/1e3);t>=70&&(V(),typeof HapticManager<"u"&&HapticManager.trigger("success"),typeof SoundManager<"u"&&SoundManager.play("success"));const n=document.getElementById("flashcard");n&&(n.classList.remove("flipped"),n.onclick=null);const o=document.getElementById("flashcardWord");o&&(o.innerHTML=`
            <span style="font-size: 3rem;">${t>=80?"ğŸ†":t>=60?"ğŸ‘":"ğŸ’ª"}</span>
            <div style="font-size: 2.5rem; font-weight: 700; margin-top: 0.5rem;">${t}%</div>
        `);const a=document.getElementById("flashcardTranslation");a&&(a.innerHTML=`
            <div style="margin-bottom: 1rem;">Du kunde ${g} av ${d} ord!</div>
            <div style="display: flex; gap: 1rem; justify-content: center; font-size: 0.9rem;">
                <span>âœ… ${m.correct}</span>
                <span>âŒ ${m.wrong}</span>
                <span>â±ï¸ ${e}s/kort</span>
            </div>
        `);const s=document.getElementById("flashcardExample");s&&(s.innerHTML=`
            <div style="margin-top: 1rem; display: flex; gap: 0.5rem; justify-content: center;">
                <button onclick="initFlashcards()" class="fc-action-btn">ğŸ”„ Igen</button>
                <button onclick="showGameMenu()" class="fc-action-btn secondary">ğŸ  Meny</button>
            </div>
        `,s.style.display="block");const r=document.getElementById("flashcardRatingBtns");r&&(r.style.display="none"),R(100),typeof _=="function"&&_("flashcards",g),typeof updateGamesStats=="function"&&updateGamesStats(t>=70,g),ot()}function nt(){const t=document.getElementById("flashcardsGame");t&&window.innerWidth<768&&t.classList.add("fullscreen-mode")}function ot(){const t=document.getElementById("flashcardsGame");t&&t.classList.remove("fullscreen-mode")}document.addEventListener("DOMContentLoaded",z);window.initFlashcards=X;window.handleFlashcardResult=L;window.handleFlashcardRating=L;window.LeitnerSystem=f;window.toggleAutoPlay=Z;
