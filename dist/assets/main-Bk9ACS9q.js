var H=Object.defineProperty;var O=(r,t,e)=>t in r?H(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var u=(r,t,e)=>O(r,typeof t!="symbol"?t+"":t,e);import"./modulepreload-polyfill-B5Qt9EMX.js";import{T as C}from"./type-color-system-BVOoyDi6.js";import{Loader as Q}from"./loader-CqI2jdYk.js";import{showToast as E,TextSizeManager as x,ThemeManager as W,normalizeArabic as B,VoiceSearchManager as F}from"./utils-CfsGp8IC.js";import{T}from"./tts-CfZZetlp.js";import{Q as m,F as k}from"./quiz-stats-BL77K9JB.js";import{A as _}from"./config-CfHoVMbv.js";import{L,t as A}from"./i18n-BpwFYk4h.js";import"./pwa-Bn3RWWLO.js";import"./db-bEbbjtoI.js";import"./toast-manager-B6dAfcdf.js";const S=[{id:"first_quiz",title:"FÃ¶rsta testet",titleAr:"Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£ÙˆÙ„",description:"Avsluta ditt fÃ¶rsta quiz",icon:"ğŸ¯",condition:()=>m.getStats().totalQuizzes>=1},{id:"streak_5",title:"5 i rad",titleAr:"5 Ù…ØªØªØ§Ù„ÙŠØ©",description:"FÃ¥ 5 rÃ¤tt svar i rad",icon:"ğŸ”¥",condition:()=>m.getStats().bestStreak>=5},{id:"streak_10",title:"10 i rad",titleAr:"10 Ù…ØªØªØ§Ù„ÙŠØ©",description:"FÃ¥ 10 rÃ¤tt svar i rad",icon:"âš¡",condition:()=>m.getStats().bestStreak>=10},{id:"correct_50",title:"50 rÃ¤tt",titleAr:"50 ØµØ­ÙŠØ­",description:"Svara rÃ¤tt pÃ¥ 50 frÃ¥gor totalt",icon:"ğŸ“š",condition:()=>m.getStats().totalCorrect>=50},{id:"correct_100",title:"100 rÃ¤tt",titleAr:"100 ØµØ­ÙŠØ­",description:"Svara rÃ¤tt pÃ¥ 100 frÃ¥gor totalt",icon:"ğŸ†",condition:()=>m.getStats().totalCorrect>=100},{id:"correct_500",title:"OrdmÃ¤stare",titleAr:"Ø³ÙŠØ¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª",description:"Svara rÃ¤tt pÃ¥ 500 frÃ¥gor totalt",icon:"ğŸ‘‘",condition:()=>m.getStats().totalCorrect>=500},{id:"speed_demon",title:"SnabbtÃ¤nkt",titleAr:"Ø³Ø±ÙŠØ¹ Ø§Ù„Ø¨Ø¯ÙŠÙ‡Ø©",description:"Svara pÃ¥ under 2 sekunder",icon:"â±ï¸",condition:()=>m.getStats().fastestResponse<2e3},{id:"perfect_10",title:"Perfekt 10",titleAr:"Ø¹Ø´Ø±Ø© Ù…Ø«Ø§Ù„ÙŠØ©",description:"FÃ¥ 10/10 i ett quiz",icon:"ğŸ’¯",condition:()=>!1},{id:"accuracy_90",title:"TrÃ¤ffsÃ¤ker",titleAr:"Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©",description:"UppnÃ¥ 90% noggrannhet (minst 50 svar)",icon:"ğŸ¯",condition:()=>{const r=m.getStats();return r.totalCorrect+r.totalWrong>=50&&m.getAccuracy()>=90}},{id:"quiz_10",title:"Flitig Ã¶vare",titleAr:"Ù…ØªØ¯Ø±Ø¨ Ù…Ø¬ØªÙ‡Ø¯",description:"Avsluta 10 quiz",icon:"ğŸ“",condition:()=>m.getStats().totalQuizzes>=10}];class j{constructor(){u(this,"STORAGE_KEY","achievements");u(this,"unlocked");this.unlocked=this.load()}load(){const t=localStorage.getItem(this.STORAGE_KEY);return t?new Set(JSON.parse(t)):new Set}save(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(Array.from(this.unlocked)))}check(){const t=[];for(const e of S)!this.unlocked.has(e.id)&&e.condition()&&(this.unlock(e),t.push(e));return t}unlock(t){this.unlocked.has(t.id)||(this.unlocked.add(t.id),this.save(),E(`${t.icon} ${t.title} - ${t.titleAr}`),this.playCelebration())}unlockById(t){const e=S.find(n=>n.id===t);e&&this.unlock(e)}playCelebration(){}getUnlocked(){return S.filter(t=>this.unlocked.has(t.id))}getLocked(){return S.filter(t=>!this.unlocked.has(t.id))}getProgress(){return{unlocked:this.unlocked.size,total:S.length,percent:Math.round(this.unlocked.size/S.length*100)}}getAll(){return S}}const R=new j;typeof window<"u"&&(window.Achievements=R);const D={hund:"ğŸ¶",katt:"ğŸ±",mus:"ğŸ­",hamster:"ğŸ¹",kanin:"ğŸ°",bjÃ¶rn:"ğŸ»",panda:"ğŸ¼",tiger:"ğŸ¯",lejon:"ğŸ¦",ko:"ğŸ®",gris:"ğŸ·",groda:"ğŸ¸",apa:"ğŸµ",kyckling:"ğŸ”",pingvin:"ğŸ§",fÃ¥gel:"ğŸ¦",anka:"ğŸ¦†",Ã¶rn:"ğŸ¦…",uggla:"ğŸ¦‰",varg:"ğŸº",hÃ¤st:"ğŸ´",enhÃ¶rning:"ğŸ¦„",bi:"ğŸ",mask:"ğŸ›",fjÃ¤ril:"ğŸ¦‹",snigel:"ğŸŒ",spindel:"ğŸ•·",skÃ¶ldpadda:"ğŸ¢",orm:"ğŸ",Ã¶dla:"ğŸ¦",fisk:"ğŸŸ",delfin:"ğŸ¬",val:"ğŸ‹",haj:"ğŸ¦ˆ",blÃ¤ckfisk:"ğŸ™",krabba:"ğŸ¦€",kamel:"ğŸ«",elefant:"ğŸ˜",noshÃ¶rning:"ğŸ¦",gorilla:"ğŸ¦",giraff:"ğŸ¦’",krokodil:"ğŸŠ",zebra:"ğŸ¦“",Ã¤pple:"ğŸ",pÃ¤ron:"ğŸ",apelsin:"ğŸŠ",citron:"ğŸ‹",banan:"ğŸŒ",vattenmelon:"ğŸ‰",vindruvor:"ğŸ‡",jordgubbe:"ğŸ“",kÃ¶rsbÃ¤r:"ğŸ’",persika:"ğŸ‘",ananas:"ğŸ",kokosnÃ¶t:"ğŸ¥¥",kiwi:"ğŸ¥",tomat:"ğŸ…",potatis:"ğŸ¥”",morot:"ğŸ¥•",majs:"ğŸŒ½",lÃ¶k:"ğŸ§…",vitlÃ¶k:"ğŸ§„",gurka:"ğŸ¥’",brÃ¶d:"ğŸ",croissant:"ğŸ¥",pannkaka:"ğŸ¥",ost:"ğŸ§€",kÃ¶tt:"ğŸ¥©",bacon:"ğŸ¥“",hamburgare:"ğŸ”","pommes frites":"ğŸŸ",pizza:"ğŸ•",korv:"ğŸŒ­",tacos:"ğŸŒ®",burrito:"ğŸŒ¯",Ã¤gg:"ğŸ¥š",popcorn:"ğŸ¿",ris:"ğŸš",spaghetti:"ğŸ",sushi:"ğŸ£",glass:"ğŸ¦",munk:"ğŸ©",kaka:"ğŸª",tÃ¥rta:"ğŸ‚",choklad:"ğŸ«",godis:"ğŸ¬",klubba:"ğŸ­",mjÃ¶lk:"ğŸ¥›",kaffe:"â˜•",te:"ğŸµ",Ã¶l:"ğŸº",vin:"ğŸ·",bil:"ğŸš—",taxi:"ğŸš•",buss:"ğŸšŒ",tÃ¥g:"ğŸš†",brandbil:"ğŸš’",polisbil:"ğŸš“",ambulans:"ğŸš‘",cykel:"ğŸš²",motorcykel:"ğŸ",traktor:"ğŸšœ",flygplan:"âœˆï¸",helikopter:"ğŸš",bÃ¥t:"â›µ",raket:"ğŸš€",klocka:"âŒš",mobil:"ğŸ“±",dator:"ğŸ’»",tangentbord:"âŒ¨ï¸",kamera:"ğŸ“·",video:"ğŸ“¹",teve:"ğŸ“º",radio:"ğŸ“»",bok:"ğŸ“–",penna:"âœï¸",sax:"âœ‚ï¸",nyckel:"ğŸ”‘",hammare:"ğŸ”¨",yxa:"ğŸª“",svÃ¤rd:"âš”ï¸",pistol:"ğŸ”«",skÃ¶ld:"ğŸ›¡",paraply:"â˜‚ï¸",glasÃ¶gon:"ğŸ‘“",vÃ¤ska:"ğŸ‘œ",sko:"ğŸ‘",klÃ¤nning:"ğŸ‘—",byxor:"ğŸ‘–",trÃ¶ja:"ğŸ‘•",sol:"â˜€ï¸",mÃ¥ne:"ğŸŒ™",stjÃ¤rna:"â­",moln:"â˜ï¸",regn:"ğŸŒ§",snÃ¶:"â„ï¸",eld:"ğŸ”¥",vatten:"ğŸ’§",trÃ¤d:"ğŸŒ³",blomma:"ğŸŒ¸",ros:"ğŸŒ¹",kaktus:"ğŸŒµ",fotboll:"âš½",baseboll:"âš¾",basket:"ğŸ€",tennis:"ğŸ¾",golf:"â›³",medalj:"ğŸ¥‡",pokal:"ğŸ†",leende:"ğŸ˜„",hjÃ¤rta:"â¤ï¸",spÃ¶ke:"ğŸ‘»",utomjording:"ğŸ‘½",robot:"ğŸ¤–",skelett:"ğŸ’€"};class V{constructor(){u(this,"data",[]);u(this,"questions",[]);u(this,"currentIndex",0);u(this,"score",0);u(this,"isAnswered",!1);u(this,"container",null);u(this,"currentWord",null);u(this,"mode","normal");u(this,"questionCount",10);u(this,"timerSeconds",10);u(this,"timerInterval",null);u(this,"timeLeft",0);this.container=document.getElementById("quizInlineContainer"),this.init()}init(){const t=document.getElementById("quickQuizBtn"),e=document.getElementById("quizBtn"),n=document.getElementById("closeQuiz"),s=document.getElementById("nextQuestion"),o=document.getElementById("restartQuiz"),i=document.getElementById("quizModeSelect");t&&(t.onclick=()=>this.start()),e&&(e.onclick=()=>this.start()),n&&(n.onclick=()=>this.hide()),s&&(s.onclick=()=>this.next()),o&&(o.onclick=()=>this.start()),i&&(i.onchange=()=>{this.mode=i.value,console.log("[Quiz] Mode changed to:",this.mode),this.container&&!this.container.classList.contains("hidden")&&this.start()},this.mode=i.value);const a=document.getElementById("quizFavBtn");a&&(a.onclick=()=>this.toggleCurrentFavorite(a)),document.addEventListener("keydown",c=>this.handleKeyboard(c)),window.addEventListener("dictionaryLoaded",()=>{this.data=window.dictionaryData||[]}),window.dictionaryData&&(this.data=window.dictionaryData)}handleKeyboard(t){if(!(!this.container||this.container.classList.contains("hidden"))){if(t.key>="1"&&t.key<="4"){const e=parseInt(t.key)-1,n=document.querySelectorAll(".quiz-option");n[e]&&n[e].click()}(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),this.isAnswered&&this.next())}}start(t){if(t&&(this.mode=t),!this.data||this.data.length<5){E("Laddar ordbok... / Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ù…ÙˆØ³ â³");return}if(this.questions=this.getQuestions(),this.questions.length===0){E("Inga ord tillgÃ¤ngliga fÃ¶r detta lÃ¤ge / Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª Ù…ØªØ§Ø­Ø©");return}this.currentIndex=0,this.score=0,this.isAnswered=!1,m.resetSession(),this.container&&(this.container.classList.remove("hidden"),this.container.scrollIntoView({behavior:"smooth",block:"center"}));const e=document.getElementById("quizEndScreen");e&&e.classList.add("hidden");const n=document.querySelector(".quiz-body");n&&Array.from(n.children).forEach(s=>{s.id!=="quizEndScreen"&&(s.style.display="block")}),this.updateProgressBar(),this.showQuestion(),this.updateScore()}hide(){this.stopTimer(),m.endSession(),this.container&&this.container.classList.add("hidden")}getQuestions(){let t=[];switch(this.mode){case"favorites":const n=k.getAll();t=this.data.filter(o=>n.includes(o[0].toString()));break;case"weak":const s=m.getWeakWords(20);t=this.data.filter(o=>s.includes(o[0].toString())),t.length<5&&(t=this.data);break;case"picture":t=this.data.filter(o=>{const i=(o[2]||"").toLowerCase().trim();return D.hasOwnProperty(i)});break;case"sentence":t=this.data.filter(o=>{const i=(o[2]||"").toLowerCase().trim(),a=(o[7]||"").toLowerCase();return a.length>5&&a.includes(i)});break;default:t=this.data}const e=[...t].sort(()=>.5-Math.random());return e.slice(0,Math.min(this.questionCount,e.length))}showQuestion(){const t=this.questions[this.currentIndex];this.currentWord=t;const e=t[2],n=t[3];let s="",o="",i="arb",a=!1;if(this.mode==="reverse")s=n,o=e,i="swe";else if(this.mode==="listening")s="ğŸ”Š Lyssna och vÃ¤lj rÃ¤tt ord",o=n,T.speak(e,"sv");else if(this.mode==="picture"){const f=(e||"").toLowerCase().trim();s=D[f]||"â“",o=e,i="swe",a=!0}else if(this.mode==="sentence"){const f=(e||"").toLowerCase().trim(),y=t[7]||"",w=new RegExp(f,"gi");s=y.replace(w,"_______"),o=e,i="swe"}else s=e,o=n;const c=document.getElementById("quizQuestion");c&&(c.textContent=s,a?(c.style.fontSize="4.5rem",c.dir="ltr"):this.mode==="sentence"?(c.style.fontSize="1.4rem",c.style.direction="ltr"):(c.style.fontSize="",c.dir=this.mode==="reverse"?"rtl":"ltr",x.apply(c,s)));const h=document.getElementById("quizExample");if(h)if(this.mode==="listening")h.textContent="";else if(this.mode==="picture")h.textContent="Vilket ord Ã¤r detta? / Ù…Ø§ Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø©ØŸ",x.apply(h,h.textContent);else if(this.mode==="sentence")h.textContent="Vilket ord saknas? / Ø£ÙŠ ÙƒÙ„Ù…Ø© Ù…ÙÙ‚ÙˆØ¯Ø©ØŸ";else{const f=t[7]||"";h.textContent=f,x.apply(h,f)}const l=document.getElementById("quizHelp");l&&(this.mode==="normal"?l.classList.remove("hidden"):l.classList.add("hidden"));const d=document.getElementById("quizOptions");if(d){console.log("[Quiz] Found optionsEl, clearing content"),d.innerHTML="";const f=this.generateOptions(t,i);console.log("[Quiz] Generated options:",f),f.length===0&&console.error("[Quiz] Options array is EMPTY!"),f.forEach((y,w)=>{console.log("[Quiz] Creating button for:",y);const b=document.createElement("button");b.className="quiz-option",b.textContent=y,b.dir=i==="arb"?"rtl":"ltr",x.apply(b,y),b.setAttribute("data-key",(w+1).toString()),b.onclick=()=>this.handleAnswer(y,o,b),d.appendChild(b)}),console.log("[Quiz] Appended buttons. Children count:",d.children.length)}else console.error("[Quiz] optionsEl NOT FOUND!");const g=document.getElementById("quizFeedback");g&&(g.textContent="",g.className="quiz-feedback");const p=document.getElementById("nextQuestion");p&&(p.disabled=!0),this.isAnswered=!1,this.mode==="timed"&&this.startTimer(),m.startQuestion(),this.mode==="normal"&&T.speak(e,"sv"),this.updateProgressBar()}generateOptions(t,e){const n=e==="arb"?t[3]:t[2],s=t[1],o=[],i=this.data.filter(h=>h[1]===s&&h[0]!==t[0]),c=[...i.length>=3?i:this.data].sort(()=>.5-Math.random());for(const h of c){if(o.length>=3)break;const l=e==="arb"?h[3]:h[2];l!==n&&!o.includes(l)&&o.push(l)}return[n,...o].sort(()=>.5-Math.random())}handleAnswer(t,e,n){if(this.isAnswered)return;this.isAnswered=!0,this.stopTimer();const s=t===e,o=this.currentWord[0].toString(),i=m.recordAnswer(o,s),a=window.app;if(a&&(typeof a.updateDailyChallenge=="function"&&a.updateDailyChallenge(),typeof a.updateDailyProgressBar=="function"&&a.updateDailyProgressBar()),s){this.score++,n.classList.add("correct");const h=m.formatTime(i);this.showFeedback(`RÃ¤tt! ${h} / ØµØ­ÙŠØ­ âœ…`,!0)}else n.classList.add("wrong"),this.showFeedback(`Fel! RÃ¤tt: ${e} / Ø®Ø·Ø£ âŒ`,!1),document.querySelectorAll(".quiz-option").forEach(h=>{h.textContent===e&&h.classList.add("correct")});this.updateScore();const c=document.getElementById("nextQuestion");c&&(c.disabled=!1),this.mode==="reverse"||this.mode==="picture"||this.mode==="sentence"?T.speak(e,"sv"):T.speak(e,"ar")}startTimer(){this.timeLeft=this.timerSeconds,this.updateTimerDisplay(),this.timerInterval=window.setInterval(()=>{this.timeLeft--,this.updateTimerDisplay(),this.timeLeft<=0&&(this.stopTimer(),this.timeOut())},1e3)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}updateTimerDisplay(){const t=document.getElementById("quizTimer");t&&(t.textContent=this.timeLeft.toString(),t.classList.toggle("warning",this.timeLeft<=3))}timeOut(){if(this.isAnswered)return;this.isAnswered=!0;const t=this.currentWord[0].toString();m.recordAnswer(t,!1),this.showFeedback("Tiden Ã¤r slut! / Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª â±ï¸",!1);const e=this.mode==="reverse"||this.mode==="picture"||this.mode==="sentence"?this.currentWord[2]:this.currentWord[3];document.querySelectorAll(".quiz-option").forEach(s=>{s.textContent===e&&s.classList.add("correct")}),this.updateScore();const n=document.getElementById("nextQuestion");n&&(n.disabled=!1)}showFeedback(t,e){const n=document.getElementById("quizFeedback");n&&(n.textContent=t,n.className=`quiz-feedback ${e?"correct":"wrong"}`)}updateScore(){const t=document.getElementById("quizScore");t&&(t.textContent=this.score.toString())}updateProgressBar(){const t=document.getElementById("quizProgress");if(t){const n=this.currentIndex/this.questions.length*100;t.style.width=`${n}%`}const e=document.getElementById("quizProgressText");e&&(e.textContent=`${this.currentIndex+1}/${this.questions.length}`)}toggleCurrentFavorite(t){if(!this.currentWord)return;const e=this.currentWord[0].toString(),n=k.toggle(e);t.classList.toggle("active",n);const s=t.querySelector("svg");s&&(n?(s.setAttribute("fill","#ef4444"),s.setAttribute("stroke","#ef4444")):(s.setAttribute("fill","none"),s.setAttribute("stroke","currentColor")))}next(){this.currentIndex++,this.currentIndex<this.questions.length?this.showQuestion():this.end()}end(){this.stopTimer(),m.endSession();const t=m.getSessionStats(),e=m.getTodayStats(),n=document.getElementById("quizEndScreen");if(n){n.classList.remove("hidden");const o=document.getElementById("endScoreValue");o&&(o.textContent=this.score.toString());const i=document.getElementById("endMessage");i&&(this.score===this.questions.length?(i.innerHTML=`ğŸ‰ Perfekt! BÃ¤sta serien: ${t.bestStreak}`,this.showConfetti(),R.unlockById("perfect_10")):this.score>=this.questions.length*.8?i.innerHTML=`Fantastiskt! Tid: ${m.formatTime(t.avgTime)}`:this.score>=this.questions.length*.5?i.textContent="Bra jobbat! / Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ ğŸ‘":i.textContent="FortsÃ¤tt Ã¶va! / Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ğŸ’ª",x.apply(i,i.textContent||"",2));const a=document.getElementById("endStats");a&&(a.innerHTML=`
                    <div class="end-stat"><span>ğŸ“… Idag:</span> ${e.correct}/${e.total}</div>
                    <div class="end-stat"><span>ğŸ”¥ BÃ¤sta serien:</span> ${t.bestStreak}</div>
                    <div class="end-stat"><span>â±ï¸ Snitttid:</span> ${m.formatTime(t.avgTime)}</div>
                `)}const s=document.querySelector(".quiz-body");s&&Array.from(s.children).forEach(o=>{o.id!=="quizEndScreen"&&(o.style.display="none")})}showConfetti(){const t=this.container;if(t)for(let e=0;e<50;e++){const n=document.createElement("div");n.className="confetti",n.style.left=Math.random()*100+"%",n.style.animationDelay=Math.random()*2+"s",n.style.backgroundColor=["#10B981","#1e3a8a","#F59E0B","#EF4444","#3b82f6"][Math.floor(Math.random()*5)],t.appendChild(n),setTimeout(()=>n.remove(),3e3)}}}typeof window<"u"&&(window.QuizManager=new V);class G{constructor(){u(this,"canvas",null);u(this,"ctx",null);u(this,"particles",[]);u(this,"animationId",null);u(this,"isActive",!1);u(this,"colors",["#FFD700","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE"]);u(this,"animate",()=>{!this.ctx||!this.canvas||(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.particles=this.particles.filter(t=>(t.x+=t.velocityX,t.y+=t.velocityY,t.velocityY+=.5,t.rotation+=t.rotationSpeed,t.opacity-=.005,t.velocityX*=.99,t.opacity>0?(this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.rotation*Math.PI/180),this.ctx.globalAlpha=t.opacity,this.ctx.fillStyle=t.color,this.ctx.fillRect(-t.size/2,-t.size/4,t.size,t.size/2),this.ctx.restore(),!0):!1)),this.particles.length>0?this.animationId=requestAnimationFrame(this.animate):(this.isActive=!1,this.animationId&&cancelAnimationFrame(this.animationId)))})}init(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.id="confetti-canvas",this.canvas.style.cssText=`
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 99999;
        `,document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.resize(),window.addEventListener("resize",()=>this.resize()))}resize(){this.canvas&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight)}createParticle(t,e){return{x:t,y:e,size:Math.random()*10+5,color:this.colors[Math.floor(Math.random()*this.colors.length)],velocityX:(Math.random()-.5)*15,velocityY:Math.random()*-15-10,rotation:Math.random()*360,rotationSpeed:(Math.random()-.5)*10,opacity:1}}burst(t,e,n=50){this.init();const s=t??window.innerWidth/2,o=e??window.innerHeight/3;for(let i=0;i<n;i++)this.particles.push(this.createParticle(s,o));this.isActive||(this.isActive=!0,this.animate())}rain(t=3e3){this.init();const e=setInterval(()=>{for(let n=0;n<5;n++){const s=this.createParticle(Math.random()*window.innerWidth,-20);s.velocityY=Math.random()*3+2,s.velocityX=(Math.random()-.5)*2,this.particles.push(s)}},50);setTimeout(()=>clearInterval(e),t),this.isActive||(this.isActive=!0,this.animate())}celebrate(){this.burst(window.innerWidth/2,window.innerHeight/2,100),setTimeout(()=>{this.burst(window.innerWidth*.25,window.innerHeight/2,50),this.burst(window.innerWidth*.75,window.innerHeight/2,50)},200)}stop(){this.particles=[],this.isActive=!1,this.animationId&&cancelAnimationFrame(this.animationId),this.ctx&&this.canvas&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}const N=new G;typeof window<"u"&&(window.Confetti=N);class I{static add(t){const e=t.trim();if(!e)return;const s=this.get().filter(i=>i.toLowerCase()!==e.toLowerCase());s.unshift(e);const o=s.slice(0,this.MAX_ITEMS);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(o))}static get(){try{const t=localStorage.getItem(this.STORAGE_KEY);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load search history",t),[]}}static clear(){localStorage.removeItem(this.STORAGE_KEY)}}u(I,"MAX_ITEMS",10),u(I,"STORAGE_KEY",_.STORAGE_KEYS.SEARCH_HISTORY||"searchHistory");const v={sun:'<svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>',moon:'<svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>',volume:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>',bell:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>',star:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>',bolt:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>',grid:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>',book:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>',download:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>',upload:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>',monitor:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>',list:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>',card:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M12 8v8"/><path d="M8 12h8"/></svg>'},U=[{value:"default",label:"âšª Standard"},{value:"ocean",label:"ğŸŒŠ Ocean Blue"},{value:"sunset",label:"ğŸŒ… Sunset Orange"},{value:"forest",label:"ğŸŒ² Forest Green"},{value:"darkblue",label:"ğŸ’™ Dark Blue"},{value:"rose",label:"ğŸŒ¸ Rose Pink"},{value:"midnight",label:"ğŸŒ™ Midnight Blue"},{value:"mint",label:"ğŸƒ Mint Green"},{value:"coral",label:"ğŸª¸ Coral Red"},{value:"neon",label:"âš¡ Neon Cyber"},{value:"stealth",label:"ğŸ–¤ Stealth Black"},{value:"aurora",label:"ğŸŒŒ Aurora Night"},{value:"ember",label:"ğŸ”¥ Ember Glow"}];function K(){return`
        <!-- Section: Profile -->
        <a href="profile.html" class="menu-item profile-link" aria-label="Min Profil / Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ">
            <span class="icon-box">ğŸ‘¤</span>
            <span>Min Profil / Ù…Ù„ÙÙŠ</span>
        </a>

        <!-- Section: General (Language) -->
        <div class="settings-section-header">ğŸŒ <span class="sv-text">SprÃ¥k</span><span class="ar-text">Ø§Ù„Ù„ØºØ©</span></div>

        <div class="menu-item language-selector-menu">
            <div class="voice-selector-inline">
                <button class="menu-lang-btn" data-lang="sv" title="Svenska">ğŸ‡¸ğŸ‡ª</button>
                <button class="menu-lang-btn" data-lang="ar" title="Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">ğŸ‡¸ğŸ‡¦</button>
                <button class="menu-lang-btn" data-lang="both" title="BÃ¥da / ÙƒÙ„ØªØ§">ğŸŒ</button>
            </div>
        </div>

        <!-- Section: Appearance -->
        <div class="settings-section-header">ğŸ¨ <span class="sv-text">Utseende</span><span class="ar-text">Ø§Ù„Ù…Ø¸Ù‡Ø±</span></div>

        <button id="themeToggle" class="menu-item" aria-label="VÃ¤xla tema / ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¸Ù‡Ø±">
            <span class="icon-box">${v.sun}${v.moon}</span>
            <span><span class="sv-text">Ljus/MÃ¶rk</span><span class="ar-text">ÙØ§ØªØ­/Ø¯Ø§ÙƒÙ†</span></span>
        </button>

        <div class="menu-item color-theme-selector">
            <span class="icon-box">ğŸ¨</span>
            <select id="colorThemeSelect" aria-label="FÃ¤rgtema / Ù„ÙˆÙ† Ø§Ù„Ø«ÙŠÙ…">
                ${U.map(r=>`<option value="${r.value}">${r.label}</option>`).join("")}
            </select>
        </div>

        <!-- Section: Sound & Notifications -->
        <div class="settings-section-header">ğŸ”” <span class="sv-text">Ljud & Notiser</span><span class="ar-text">Ø§Ù„ØµÙˆØª ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span></div>

        <div class="menu-item tts-speed-control">
            <span class="icon-box icon-color-indigo">${v.volume}</span>
            <div class="tts-speed-wrapper">
                <div class="tts-speed-header">
                    <span><span class="sv-text">Uttalshastighet</span><span class="ar-text">Ø³Ø±Ø¹Ø© Ø§Ù„Ù†Ø·Ù‚</span></span>
                    <span id="ttsSpeedValue" class="tts-speed-badge">85%</span>
                </div>
                <input type="range" id="ttsSpeedSlider" min="50" max="150" value="85" class="tts-slider" title="Uttalshastighet / Ø³Ø±Ø¹Ø© Ø§Ù„Ù†Ø·Ù‚">
                <button id="ttsTestBtn" class="tts-test-btn">ğŸ”Š <span class="sv-text">Testa</span><span class="ar-text">Ø§Ø®ØªØ¨Ø±</span></button>
            </div>
        </div>

        <div class="menu-item tts-voice-selection">
            <span class="icon-box icon-color-indigo">ğŸ­</span>
            <div class="voice-selector-inline">
                <button class="voice-btn active" data-voice="natural" title="Naturlig / Ø·Ø¨ÙŠØ¹ÙŠ">ğŸŒ</button>
                <button class="voice-btn" data-voice="female" title="Kvinna / Ø£Ù†Ø«Ù‰">ğŸ‘©</button>
                <button class="voice-btn" data-voice="male" title="Man / Ø°ÙƒØ±">ğŸ‘¨</button>
            </div>
        </div>

        <div class="menu-item reminder-control">
            <span class="icon-box icon-color-amber">${v.bell}</span>
            <div class="reminder-wrapper">
                <div class="reminder-header">
                    <span><span class="sv-text">PÃ¥minnelse</span><span class="ar-text">ØªØ°ÙƒÙŠØ±</span></span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="reminderToggle" title="PÃ¥minnelse pÃ¥/av / Ø§Ù„ØªØ°ÙƒÙŠØ± ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div id="reminderTimeContainer" class="reminder-time-container hidden">
                    <input type="time" id="reminderTime" value="18:00" class="reminder-time-input" title="PÃ¥minnelsetid / ÙˆÙ‚Øª Ø§Ù„ØªØ°ÙƒÙŠØ±">
                    <button id="testReminderBtn" class="tts-test-btn">ğŸ”” <span class="sv-text">Testa</span><span class="ar-text">Ø§Ø®ØªØ¨Ø±</span></button>
                </div>
            </div>
        </div>

        <!-- Section: Learning Tools -->
        <div class="settings-section-header">ğŸ“š <span class="sv-text">LÃ¤rverktyg</span><span class="ar-text">Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ¹Ù„Ù…</span></div>

        <button id="showFavoritesBtn" class="menu-item" aria-label="Visa favoriter / Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙØ¶Ù„Ø©">
            <span class="icon-box icon-color-star">${v.star}</span>
            <span>â­ <span class="sv-text">Mina ord</span><span class="ar-text">ÙƒÙ„Ù…Ø§ØªÙŠ</span></span>
        </button>

        <button id="quizBtn" class="menu-item" aria-label="Snabbtest / ØªØ­Ø¯ÙŠ Ø§Ù„Ø³Ø±Ø¹Ø©">
            <span class="icon-box icon-color-indigo">${v.bolt}</span>
            <span>âš¡ <span class="sv-text">Snabbtest</span><span class="ar-text">Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹</span></span>
        </button>

        <button id="favQuizBtn" class="menu-item" aria-label="Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ÙØ¶Ù„Ø§Øª">
            <span class="icon-box icon-color-star">${v.star}</span>
            <span>â­ <span class="sv-text">Quiz Favoriter</span><span class="ar-text">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ÙØ¶Ù„Ø©</span></span>
        </button>

        <button id="flashcardsBtn" class="menu-item" aria-label="Flashcards / Ø¨Ø·Ø§Ù‚Ø§Øª">
            <span class="icon-box icon-color-indigo">${v.card}</span>
            <span>ğŸƒ <span class="sv-text">Flashcards</span><span class="ar-text">Ø¨Ø·Ø§Ù‚Ø§Øª</span></span>
        </button>

        <!-- Section: Navigation -->
        <div class="settings-section-header">ğŸ§­ <span class="sv-text">Navigation</span><span class="ar-text">Ø§Ù„ØªÙ†Ù‚Ù„</span></div>

        <a href="games/games.html" id="gameBtn" class="menu-item" aria-label="Spel / Ø£Ù„Ø¹Ø§Ø¨">
            <span class="icon-box icon-color-blue">${v.grid}</span>
            <span>ğŸ® <span class="sv-text">Spel</span><span class="ar-text">Ø£Ù„Ø¹Ø§Ø¨</span></span>
        </a>

        <a href="learn/learn.html" class="menu-item" aria-label="LÃ¤r dig / ØªØ¹Ù„Ù…">
            <span class="icon-box icon-color-green">${v.book}</span>
            <span>ğŸ“š <span class="sv-text">Grammatik</span><span class="ar-text">Ù‚ÙˆØ§Ø¹Ø¯</span></span>
        </a>

        <a href="add.html" class="menu-item" aria-label="LÃ¤gg till ord / Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø©">
            <span class="icon-box icon-color-emerald">${v.plus}</span>
            <span>â• <span class="sv-text">LÃ¤gg till</span><span class="ar-text">Ø¥Ø¶Ø§ÙØ©</span></span>
        </a>

        <!-- Section: Data -->
        <div class="settings-section-header">ğŸ’¾ <span class="sv-text">Data</span><span class="ar-text">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span></div>

        <button id="exportCustom" class="menu-item" aria-label="Exportera">
            <span class="icon-box icon-color-cyan">${v.download}</span>
            <span>ğŸ“¤ <span class="sv-text">Exportera</span><span class="ar-text">ØªØµØ¯ÙŠØ±</span></span>
        </button>

        <button id="importCustom" class="menu-item" aria-label="Importera">
            <span class="icon-box icon-color-cyan">${v.upload}</span>
            <span>ğŸ“¥ <span class="sv-text">Importera</span><span class="ar-text">Ø§Ø³ØªÙŠØ±Ø§Ø¯</span></span>
        </button>

        <!-- Section: Info -->
        <div class="settings-section-header">â„¹ï¸ <span class="sv-text">Info</span><span class="ar-text">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</span></div>

        <a href="device.html" class="menu-item" aria-label="Device Info / Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²">
            <span class="icon-box icon-color-slate">${v.monitor}</span>
            <span>ğŸ–¥ï¸ Device Info</span>
        </a>

        <a href="changelog.html" class="menu-item" aria-label="Changelog / Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª">
            <span class="icon-box icon-color-indigo">${v.list}</span>
            <span>ğŸ“‹ Changelog</span>
        </a>

        <div class="settings-version">
            <p>SnabbaLexin v3.0.0 &copy; 2025</p>
        </div>
    `}let P=!1;function Y(){const r=document.getElementById("settingsBtn"),t=document.getElementById("settingsMenu");!r||!t||(r.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),P||(t.innerHTML=K(),P=!0,X()),t.classList.toggle("hidden")}),document.addEventListener("click",e=>{const n=e.target;t&&r&&!t.contains(n)&&!r.contains(n)&&t.classList.add("hidden")}))}function X(){const r=document.getElementById("themeToggle");r&&r.addEventListener("click",()=>{const a=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";document.documentElement.setAttribute("data-theme",a),localStorage.setItem("theme",a)});const t=document.getElementById("colorThemeSelect");if(t){const i=localStorage.getItem("colorTheme")||"default";t.value=i,t.addEventListener("change",()=>{document.body.className=document.body.className.replace(/theme-\w+/,""),t.value!=="default"&&document.body.classList.add(`theme-${t.value}`),localStorage.setItem("colorTheme",t.value)})}const e=document.getElementById("ttsSpeedSlider"),n=document.getElementById("ttsSpeedValue");if(e&&n){const i=localStorage.getItem("ttsSpeed")||"85";e.value=i,n.textContent=`${i}%`,e.addEventListener("input",()=>{n.textContent=`${e.value}%`,localStorage.setItem("ttsSpeed",e.value)})}const s=document.getElementById("reminderToggle"),o=document.getElementById("reminderTimeContainer");s&&o&&s.addEventListener("change",()=>{o.classList.toggle("hidden",!s.checked)}),document.querySelectorAll(".voice-btn").forEach(i=>{i.addEventListener("click",()=>{document.querySelectorAll(".voice-btn").forEach(a=>a.classList.remove("active")),i.classList.add("active"),localStorage.setItem("ttsVoice",i.dataset.voice||"natural")})}),document.querySelectorAll(".menu-lang-btn").forEach(i=>{i.getAttribute("data-lang")===(localStorage.getItem("appLanguage")||"both")&&i.classList.add("active"),i.addEventListener("click",()=>{const a=i.getAttribute("data-lang")||"both";document.querySelectorAll(".menu-lang-btn").forEach(c=>c.classList.remove("active")),i.classList.add("active"),localStorage.setItem("appLanguage",a),window.LanguageManager?window.LanguageManager.setLanguage(a):location.reload()})})}function J(){console.log("Initializing Main UI..."),Z(),Y(),tt(),et(),nt(),st(),it(),ot()}function Z(){const r=localStorage.getItem("theme")||"dark";if(r==="auto"){const t=new Date().getHours(),e=t>=18||t<7;document.documentElement.setAttribute("data-theme",e?"dark":"light")}else document.documentElement.setAttribute("data-theme",r)}function tt(){const r=document.getElementById("mobileViewToggle");r&&r.addEventListener("click",()=>{var t;(t=window.MobileViewManager)==null||t.toggle()}),window.toggleMobileView=()=>{var t;return(t=window.MobileViewManager)==null?void 0:t.toggle()}}function et(){const r=document.getElementById("progressBadge"),t=document.getElementById("progressModal"),e=document.getElementById("closeProgress");r&&t&&r.addEventListener("click",()=>{t.style.display="flex",t.classList.remove("hidden")}),e&&t&&(e.addEventListener("click",()=>{t.style.display="none"}),t.addEventListener("click",n=>{n.target===t&&(t.style.display="none")}))}function nt(){const r=document.getElementById("quickWodBtn");r&&r.addEventListener("click",()=>{const n=document.getElementById("wordOfTheDay");n&&(n.scrollIntoView({behavior:"smooth",block:"center"}),n.classList.add("pulse-animation"),setTimeout(()=>n.classList.remove("pulse-animation"),500))});const t=document.getElementById("quickFavBtn");t&&t.addEventListener("click",()=>{var n;(n=window.app)==null||n.performSearch("favorites")});const e=document.getElementById("quickQuizBtn");e&&e.addEventListener("click",()=>{var n,s;(s=(n=window.QuizManager)==null?void 0:n.start)==null||s.call(n)})}function st(){const r=document.getElementById("onboardingModal");if(!r)return;const t=document.querySelectorAll(".onboarding-slide"),e=document.querySelectorAll(".dot"),n=document.getElementById("nextSlide"),s=document.getElementById("prevSlide"),o=document.getElementById("skipOnboarding");let i=0;const a=t.length;localStorage.getItem("onboardingComplete")||(r.style.display="flex",r.classList.remove("hidden"));function c(l){t.forEach((g,p)=>g.classList.toggle("active",p===l)),e.forEach((g,p)=>g.classList.toggle("active",p===l)),s&&(s.style.visibility=l===0?"hidden":"visible"),n&&(n.textContent=l===a-1?"BÃ¶rja! ğŸš€":"NÃ¤sta âŸ¶");const d=t[l];d&&d.querySelectorAll("h2, p").forEach(g=>{x.apply(g,g.textContent||"")})}function h(){localStorage.setItem("onboardingComplete","true"),r.style.opacity="0",setTimeout(()=>{r.style.display="none"},300)}n&&n.addEventListener("click",()=>{i<a-1?(i++,c(i)):h()}),s&&s.addEventListener("click",()=>{i>0&&(i--,c(i))}),o&&o.addEventListener("click",h),e.forEach((l,d)=>{l.addEventListener("click",()=>{i=d,c(i)})})}function it(){const r=document.getElementById("saveGoalBtn"),t=document.getElementById("dailyGoalInput");r&&t&&r.addEventListener("click",()=>{var e,n;localStorage.setItem("dailyGoal",t.value),(e=window.app)==null||e.updateDailyProgressBar(),(n=window.showToast)==null||n.call(window,"MÃ¥l sparat! / ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù‡Ø¯Ù ğŸ¯")})}function ot(){document.querySelectorAll(".game-card h3, .section-title, .stat-label").forEach(r=>{x.apply(r,r.textContent||"")})}function M(){const r=L.getLanguage();at(r),L.updateTranslations(),rt(r),lt(r),dt()}function at(r){const t=window.location.pathname,e={"/index.html":{sv:"Svensk-Arabiskt Lexikon | SnabbaLexin",ar:"Ø§Ù„Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ø³ÙˆÙŠØ¯ÙŠ Ø§Ù„Ø¹Ø±Ø¨ÙŠ | Ø³Ù†Ø§Ø¨Ø§ Ù„ÙƒØ³ÙŠÙ†"},"/settings.html":{sv:"InstÃ¤llningar - SnabbaLexin",ar:"Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - Ø³Ù†Ø§Ø¨Ø§ Ù„ÙƒØ³ÙŠÙ†"},"/learn.html":{sv:"LÃ¤r dig - SnabbaLexin",ar:"ØªØ¹Ù„Ù… - Ø³Ù†Ø§Ø¨Ø§ Ù„ÙƒØ³ÙŠÙ†"},"/games/games.html":{sv:"Spel - SnabbaLexin",ar:"Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ - Ø³Ù†Ø§Ø¨Ø§ Ù„ÙƒØ³ÙŠÙ†"},"/":{sv:"Svensk-Arabiskt Lexikon | SnabbaLexin",ar:"Ø§Ù„Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ø³ÙˆÙŠØ¯ÙŠ Ø§Ù„Ø¹Ø±Ø¨ÙŠ | Ø³Ù†Ø§Ø¨Ø§ Ù„ÙƒØ³ÙŠÙ†"}},n=Object.keys(e).find(o=>t.endsWith(o))||"/",s=e[n]||e["/"];r==="sv"?document.title=s.sv:r==="ar"?document.title=s.ar:document.title=`${s.sv} - ${s.ar}`}function rt(r){const t=document.getElementById("searchInput");if(t){const e={sv:"SÃ¶k ord...",ar:"Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒÙ„Ù…Ø©...",both:"SÃ¶k / Ø¨Ø­Ø«..."};t.placeholder=e[r]||e.both}}function lt(r){Object.values({home:{el:'.nav-link[href*="index"] .nav-text',sv:"Hem",ar:"Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"},games:{el:'.nav-link[href*="games"] .nav-text',sv:"Spel",ar:"Ø£Ù„Ø¹Ø§Ø¨"},learn:{el:'.nav-link[href*="learn"] .nav-text',sv:"LÃ¤r dig",ar:"ØªØ¹Ù„Ù…"},settings:{el:'.nav-link[href*="settings"] .nav-text',sv:"Mer",ar:"Ø§Ù„Ù…Ø²ÙŠØ¯"}}).forEach(e=>{if(e.el){const n=document.querySelector(e.el);n&&(r==="sv"?n.textContent=e.sv:r==="ar"?n.textContent=e.ar:n.textContent=`${e.sv}`)}})}function ct(r,t){var n;const e=A(r)||t||r;(n=window.showToast)==null||n.call(window,e)}function dt(){const r=window.showToast;r&&(window.showToastTranslated=(t,e)=>{const n=A(t);r(n,{type:e||"success"})})}function ht(r,t){const e=L.getLanguage();return e==="sv"?r:e==="ar"?t:`${r} / ${t}`}if(typeof document<"u"){const r=()=>{M(),L.onLanguageChange(()=>{M()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r):r()}typeof window<"u"&&(window.applyPageTranslations=M,window.showTranslatedToast=ct,window.getTranslatedText=ht);class ut{constructor(){u(this,"isLoading",!0);u(this,"searchIndex",[]);u(this,"currentResults",[]);u(this,"BATCH_SIZE",20);u(this,"renderedCount",0);u(this,"activeFilterMode","all");u(this,"activeTypeFilter","all");u(this,"activeSortMethod","relevance");this.init()}async init(){L.init(),J(),Q.checkCacheAndLoad(),this.initStreaks(),this.setupSearchListeners(),this.setupThemeListener(),this.initQuickActions(),this.setupInfiniteScroll(),this.setupGlobalHandlers(),this.setupFilters(),this.setupVoiceSearch(),this.setupVoiceSelection(),this.updateDailyChallenge(),this.updateDailyProgressBar();const e=new URLSearchParams(window.location.search).get("s");if(e){const n=document.getElementById("searchInput");n&&(n.value=e)}window.addEventListener("dictionaryLoaded",()=>{console.log("[App] Data loaded event received"),this.handleDataLoaded()}),window.dictionaryData&&window.dictionaryData.length>0&&this.handleDataLoaded(),window.addEventListener("pageshow",n=>{if(n.persisted&&(console.log("[App] Restoring from BFCache"),window.dictionaryData&&window.dictionaryData.length>0)){const o=new URLSearchParams(window.location.search).get("s"),i=document.getElementById("searchInput");o&&i&&(i.value=o,this.performSearch(o))}})}initStreaks(){const t="lastVisitDate",e="dailyStreak",n=new Date().toISOString().split("T")[0],s=localStorage.getItem(t);let o=parseInt(localStorage.getItem(e)||"0");if(s!==n){const a=new Date;a.setDate(a.getDate()-1);const c=a.toISOString().split("T")[0];s===c?o++:o=1,localStorage.setItem(t,n),localStorage.setItem(e,o.toString())}const i=document.getElementById("currentStreak");i&&(i.innerHTML=o.toString())}setupThemeListener(){const t=document.getElementById("themeToggle");t&&t.addEventListener("click",()=>{W.toggle()})}setupSearchListeners(){const t=document.getElementById("searchInput");if(!t)return;t.addEventListener("input",n=>this.handleSearch(n)),t.addEventListener("keydown",n=>{if(n.key==="Enter"){const s=t.value.trim();s&&I.add(s)}});const e=document.getElementById("clearSearch");t.addEventListener("input",()=>{e&&(e.style.display=t.value.length>0?"flex":"none")}),e&&e.addEventListener("click",()=>{t.value="",e.style.display="none",this.performSearch("")})}setupFilters(){const t=document.getElementById("filterModeSelect"),e=document.getElementById("typeSelect"),n=document.getElementById("sortSelect"),s=document.getElementById("categorySelect"),o=document.getElementById("quickFavBtn"),i=()=>{t&&(this.activeFilterMode=t.value),e&&(this.activeTypeFilter=e.value),n&&(this.activeSortMethod=n.value);const h=document.getElementById("searchInput");this.performSearch((h==null?void 0:h.value)||"")};t&&t.addEventListener("change",i),e&&e.addEventListener("change",i),n&&n.addEventListener("change",i),s&&s.addEventListener("change",i),o&&o.addEventListener("click",()=>{t&&(t.value=t.value==="favorites"?"all":"favorites",i())});const a=document.getElementById("filterToggleBtn"),c=document.getElementById("filterChipsContainer");a&&c&&a.addEventListener("click",()=>{c.classList.toggle("hidden"),a.classList.toggle("active")})}handleDataLoaded(){if(!this.isLoading)return;this.isLoading=!1,console.log("[App] Data loaded, initializing...");const t=document.getElementById("loader");t&&(t.style.display="none");const e=window.dictionaryData;if(!e)return;this.searchIndex=e.map(c=>`${c[2]} ${c[3]}`.toLowerCase()),this.initWordOfTheDay();const s=new URLSearchParams(window.location.search).get("s"),o=sessionStorage.getItem("snabbaLexin_lastSearch"),i=document.getElementById("searchInput"),a=s||o||(i==null?void 0:i.value.trim())||"";if(console.log("[Debug] Persistence | URL:",s,"| Session:",o,"| Input:",i==null?void 0:i.value,"| Using:",a),a){if(console.log("[Debug] Restoring search:",a),i&&(i.value=a),!s&&o&&window.history.replaceState){const c=`${window.location.pathname}?s=${encodeURIComponent(o)}`;window.history.replaceState({path:c},"",c)}this.performSearch(a)}else console.log("[Debug] No search state found, showing landing page."),this.performSearch("");this.updateDailyChallenge(),this.updateTypeCounts(e)}updateTypeCounts(t){const e={};t.forEach(s=>{const o=C.getCategory(s[1],s[2],s[6],s[13]||"",s[3]||"");let i=o;o==="noun"&&(i="subst"),o==="conj"&&(i="konj"),o==="pronoun"&&(i="pron"),(o==="phrase"||o==="phrasal")&&(i="fras"),o==="prep"&&(i="prep"),o==="adj"&&(i="adj"),o==="adv"&&(i="adv");const a=(s[1]||"").toLowerCase();a.includes("interj")&&(i="interj"),(a.includes("rÃ¤kne")||a.includes("num"))&&(i="num"),e[i]=(e[i]||0)+1,a.includes("juridik")&&(e.juridik=(e.juridik||0)+1),a.includes("medicin")&&(e.medicin=(e.medicin||0)+1),(a.includes("data")||a.includes("dator")||a.includes("it")||a.includes("teknik"))&&(e.it=(e.it||0)+1),(a.includes("politik")||a.includes("samhÃ¤ll"))&&(e.politik=(e.politik||0)+1),(a.includes("religion")||a.includes("islam")||a.includes("krist")||a.includes("bibel")||a.includes("koran"))&&(e.religion=(e.religion||0)+1)});const n=document.getElementById("typeSelect");n&&Array.from(n.querySelectorAll("option")).forEach(s=>{var i;const o=s.value;if(o==="all"){s.textContent=`Alla (${t.length})`;return}if(e[o]){const a=(i=s.textContent)==null?void 0:i.split(" (")[0].trim();s.textContent=`${a} (${e[o]})`}})}initWordOfTheDay(){const t=window.dictionaryData;if(!t||t.length===0)return;let e=null,n=0;for(;n<500;){const s=Math.floor(Math.random()*t.length),o=t[s],i=o[9]&&o[9].length>0||o[10]&&o[10].length>0,a=o[7]&&o[7].split(" ").length>5;if(i||a){e=o;break}n++}e||(e=t[Math.floor(Math.random()*t.length)]),m.recordStudy(e[0].toString()),this.renderWod(e)}renderWod(t){const e=document.getElementById("wordOfTheDay");if(!e)return;e.classList.remove("hidden");const n=e.querySelector(".wod-swe"),s=e.querySelector(".wod-arb"),o=e.querySelector(".wod-type-badge");n&&(n.textContent=t[2],x.apply(n,t[2])),s&&(s.textContent=t[3],x.apply(s,t[3])),o&&(o.textContent=t[1]),[".wod-forms-preview",".wod-def-preview",".wod-example-preview",".wod-example-arb-preview",".wod-idiom-preview"].forEach(d=>{const g=e.querySelector(d);g&&g.classList.add("hidden")});const a=document.getElementById("wodTTSBtn");a&&(a.onclick=()=>{var d;return(d=window.TTSManager)==null?void 0:d.speak(t[2],"sv")});const c=document.getElementById("wodDetailsBtn");c&&(c.onclick=()=>window.location.href=`details.html?id=${t[0]}`);const h=document.getElementById("wodLoopBtn");h&&(h.onclick=()=>this.initWordOfTheDay());const l=document.getElementById("wodFavBtn");if(l){const d=t[0].toString(),g=k.has(d);k.updateButtonIcon(l,g),l.onclick=()=>{const p=k.toggle(d);k.updateButtonIcon(l,p)}}}initQuickActions(){const t=document.getElementById("quickWodBtn");t&&t.addEventListener("click",()=>{const e=document.getElementById("wordOfTheDay");e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("pulse-animation"),setTimeout(()=>e.classList.remove("pulse-animation"),500))})}handleSearch(t){const e=t.target,n=e.value.trim();if(window.history.replaceState){const s=n?`${window.location.pathname}?s=${encodeURIComponent(n)}`:window.location.pathname;window.history.replaceState({path:s},"",s)}sessionStorage.setItem("snabbaLexin_lastSearch",n),this.performSearch(e.value)}performSearch(t){const e=t.toLowerCase().trim();if(window.history.replaceState){const l=e?`${window.location.pathname}?s=${encodeURIComponent(e)}`:window.location.pathname;window.history.replaceState({path:l},"",l)}const n=window.dictionaryData||[];if(!n)return;const s=document.getElementById("landingPageContent"),o=document.getElementById("searchResults"),i=document.getElementById("emptyState");this.renderedCount=0;let a=n;this.activeFilterMode==="favorites"&&(a=a.filter(l=>k.has(l[0].toString()))),e&&(a=a.filter(l=>{const d=l[2].toLowerCase(),g=B(l[3]||"").toLowerCase(),p=B(e);return this.activeFilterMode==="start"?d.startsWith(p)||g.startsWith(p):this.activeFilterMode==="end"?d.endsWith(p)||g.endsWith(p):this.activeFilterMode==="exact"?d===p||g===p:d.includes(p)||g.includes(p)})),this.updateTypeCounts(a),this.activeTypeFilter!=="all"&&(a=a.filter(l=>C.getCategory(l[1],l[2],l[6],l[13]||"",l[3]||"")===this.activeTypeFilter));const c=document.getElementById("categorySelect");if(c&&c.value!=="all"){const l=c.value;a=a.filter(d=>(d[11]||"").toLowerCase().includes(l))}this.activeSortMethod==="az"||this.activeSortMethod==="alpha_asc"?a=[...a].sort((l,d)=>l[2].localeCompare(d[2],"sv")):this.activeSortMethod==="za"||this.activeSortMethod==="alpha_desc"?a=[...a].sort((l,d)=>d[2].localeCompare(l[2],"sv")):this.activeSortMethod==="richness"?a=[...a].sort((l,d)=>{const g=(l[5]||"").length+(l[7]||"").length;return(d[5]||"").length+(d[7]||"").length-g}):a=[...a].sort((l,d)=>{const g=l[2].toLowerCase(),p=d[2].toLowerCase(),f=B(l[3]||"").toLowerCase(),y=B(d[3]||"").toLowerCase(),w=B(e),b=g===w||f===w,z=p===w||y===w;if(b&&!z)return-1;if(!b&&z)return 1;const q=g.startsWith(w)||f.startsWith(w),$=p.startsWith(w)||y.startsWith(w);return q&&!$?-1:!q&&$?1:0}),this.currentResults=a,!e&&this.activeFilterMode==="all"?(s&&(s.style.display="block"),o&&(o.style.display="none",o.innerHTML=""),i&&(i.style.display="block"),this.renderSearchHistory()):(s&&(s.style.display="none"),o&&(o.style.display="grid",o.innerHTML=""),i&&(i.style.display=a.length===0?"block":"none"),this.renderNextBatch()),this.updateResultCount()}renderNextBatch(){if(this.renderedCount>=this.currentResults.length)return;const t=document.getElementById("searchResults");if(!t)return;const e=this.currentResults.slice(this.renderedCount,this.renderedCount+this.BATCH_SIZE),n=e.map(s=>this.createCard(s)).join("");t.insertAdjacentHTML("beforeend",n),this.renderedCount+=e.length,x.autoApply()}createCard(t){const e=t[0],n=t[2],s=t[3],o=t[1],i=t[6]||"",a=t[13]||"",c=C.generateBadge(o,n,i,a,s),h=C.getDataType(o,n,i,a,s),l=k.has(e.toString()),d=l?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#F59E0B" stroke="#F59E0B" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>',g='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>',p='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>',f=i?`<div class="ghost-forms">${i}</div>`:"",y=parseInt(e)%4*33;return`
            <div class="card card-link compact-card" data-type="${h}" onclick="if(!event.target.closest('button')) window.location.href='details.html?id=${e}'">
                <div class="card-top-row">
                    ${c}
                    <div class="card-actions">
                        <button class="action-button audio-btn" onclick="speakText('${n.replace(/'/g,"\\'")}', 'sv'); event.stopPropagation();" title="Lyssna">
                            ${p}
                        </button>
                        <button class="copy-btn action-button" onclick="copyWord('${n.replace(/'/g,"\\'")}', event)" title="Kopiera">
                            ${g}
                        </button>
                        <button class="fav-btn action-button ${l?"active":""}" onclick="toggleFavorite('${e}', this, event)" title="Spara">
                            ${d}
                        </button>
                    </div>
                </div>
                <div class="card-main-content">
                    <h2 class="word-swe" dir="ltr" data-auto-size data-max-lines="1">${n}</h2>
                    ${f}
                    <p class="word-arb" dir="rtl" data-auto-size data-max-lines="1">${s}</p>
                </div>
                <div class="mastery-bar-container"><div class="mastery-fill" style="width: ${y}%"></div></div>
            </div>
        `}setupInfiniteScroll(){window.addEventListener("scroll",()=>{if(this.currentResults.length===0)return;const{scrollTop:t,scrollHeight:e,clientHeight:n}=document.documentElement;t+n>=e-300&&this.renderNextBatch()})}setupGlobalHandlers(){window.copyWord=(t,e)=>{e.stopPropagation(),navigator.clipboard.writeText(t).then(()=>E(A("toast.copied")+" ğŸ“‹"))},window.toggleFavorite=(t,e,n)=>{n.stopPropagation();const s=t.toString(),o=k.toggle(s);e.classList.toggle("active",o),e.innerHTML=o?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#F59E0B" stroke="#F59E0B" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>'}}updateResultCount(){const t=document.getElementById("resultCount");t&&(t.textContent=this.currentResults.length.toLocaleString())}updateDailyChallenge(){const t=parseInt(localStorage.getItem("dailyGoal")||"10"),e=m.getTodayStats(),n=e.correct+(e.studied||0),s=Math.min(100,n/t*100),o=document.getElementById("challengeProgressBar");o&&(o.style.width=`${s}%`,n>=t&&o.classList.add("completed"));const i=document.getElementById("challengeProgressText");i&&(i.textContent=`${n}/${t}`,n>=t&&i.classList.add("completed"));const a=document.getElementById("dailyChallengeCard");a&&n>=t&&a.classList.add("completed"),console.log(`[App] Daily challenge: ${n}/${t} (${s.toFixed(0)}%)`),this.updateDailyProgressBar()}updateDailyProgressBar(){const t=parseInt(localStorage.getItem("dailyGoal")||"10"),e=m.getTodayStats(),n=e.correct+(e.studied||0),s=Math.min(100,n/t*100),o=document.getElementById("dailyProgressCount");o&&(o.textContent=n.toString());const i=document.getElementById("dailyWordsCount");i&&(i.textContent=n.toString());const a=document.getElementById("dailyProgressFill");a&&(a.style.width=`${s}%`,n>=t&&a.classList.add("completed"));const c=document.getElementById("progressRingValue");c&&(c.textContent=n.toString());const h=document.getElementById("progressRingGoal");h&&(h.textContent=t.toString());const l=document.querySelector(".progress-ring-circle");if(l){const g=314.159-s/100*314.159;l.style.strokeDashoffset=g.toString()}console.log(`[App] Daily progress: ${n}/${t} (${s.toFixed(0)}%)`)}setupVoiceSearch(){const t=document.getElementById("voiceSearchBtn"),e=document.getElementById("searchInput");!t||!e||(t.addEventListener("click",()=>{F.toggle()}),F.onResult=(n,s)=>{e.value=n,s&&(this.performSearch(n),E(`ğŸ¤ "${n}"`))})}setupVoiceSelection(){const t=document.querySelectorAll(".voice-selector-inline .voice-btn"),e=localStorage.getItem("ttsVoicePreference")||"natural";t.forEach(n=>{n.classList.toggle("active",n.getAttribute("data-voice")===e),n.addEventListener("click",s=>{s.stopPropagation();const o=n.getAttribute("data-voice");t.forEach(i=>i.classList.remove("active")),n.classList.add("active"),localStorage.setItem("ttsVoicePreference",o),E(`ğŸ—£ï¸ ${A("settings.voiceChanged")||"RÃ¶sttyp Ã¤ndrad"}`)})})}renderSearchHistory(){const t=document.getElementById("searchHistoryContainer"),e=document.getElementById("searchHistoryList"),n=document.getElementById("clearHistoryBtn");if(!t||!e)return;const s=I.get();if(s.length===0){t.classList.add("hidden");return}t.classList.remove("hidden"),e.innerHTML=s.map(o=>`
            <button class="history-chip" onclick="window.location.href='?s=${encodeURIComponent(o)}'">
                <span class="history-icon">ğŸ•’</span>
                <span class="history-text">${o}</span>
            </button>
        `).join(""),n&&(n.onclick=()=>{I.clear(),this.renderSearchHistory()})}}typeof window<"u"&&(window.app=new ut);
