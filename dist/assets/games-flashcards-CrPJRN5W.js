import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              *//* empty css              *//* empty css                       */import"./games-utils-HTOXTqfV.js";console.log("flashcardsGame.ts LOADED - Professional Edition");let p=[],c=0,g=0,l=0,k=0,u={correct:0,wrong:0,totalTime:0},x=0,T=0,B=0,L=0,f=localStorage.getItem("fc_autoplay")!=="false";const M=0,W=1,b=2,N=3,X=7,z=8,d={STORAGE_KEY:"flashcard_leitner_data",BOX_INTERVALS:[1,3,7,14,30],getData(){try{return JSON.parse(localStorage.getItem(this.STORAGE_KEY)||"{}")}catch{return{}}},saveData(e){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))},getWordBox(e){var n;return((n=this.getData()[e])==null?void 0:n.box)||1},promoteWord(e){var a;const t=this.getData(),n=((a=t[e])==null?void 0:a.box)||1,o=Math.min(n+1,5);return t[e]={box:o,lastReview:Date.now(),nextReview:Date.now()+this.BOX_INTERVALS[o-1]*24*60*60*1e3},this.saveData(t),o},demoteWord(e){const t=this.getData();return t[e]={box:1,lastReview:Date.now(),nextReview:Date.now()+24*60*60*1e3},this.saveData(t),1},getBoxIcon(e){const t=["â„ï¸","ğŸŒ±","ğŸŒ¿","ğŸŒ³","ğŸ”¥"];return t[e-1]||t[0]},getDueWords(){const e=this.getData(),t=Date.now();return Object.entries(e).filter(([,n])=>n.nextReview<=t).map(([n])=>n)}};function K(){const e=document.getElementById("flashcardsGame");if(!e)return;const t=["#6366f1","#8b5cf6","#22c55e","#f59e0b","#ef4444"],n=50;for(let o=0;o<n;o++){const a=document.createElement("div");a.className="confetti-piece",a.style.cssText=`
            position: fixed;
            width: 10px;
            height: 10px;
            background: ${t[Math.floor(Math.random()*t.length)]};
            left: ${Math.random()*100}%;
            top: -10px;
            border-radius: ${Math.random()>.5?"50%":"2px"};
            animation: confettiFall ${2+Math.random()*2}s linear forwards;
            animation-delay: ${Math.random()*.5}s;
            z-index: 9999;
            pointer-events: none;
        `,e.appendChild(a),setTimeout(()=>a.remove(),4e3)}}function O(e=0){const t=document.getElementById("flashcardTypeFilter"),n=(t==null?void 0:t.value)||"all";if(typeof dictionaryData>"u"||!Array.isArray(dictionaryData)||dictionaryData.length===0){if(e<5)console.log(`Data not ready, retrying... (${e+1}/5)`),typeof showToast=="function"&&e===0&&showToast("Laddar data... / Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...","default"),setTimeout(()=>O(e+1),500);else{console.error("dictionaryData failed to load."),typeof showToast=="function"&&showToast("Kunde inte ladda data. Kontrollera din anslutning. / ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.","error");const o=document.getElementById("flashcardWord");o&&(o.innerHTML='<span style="color:red; font-size: 1rem;">Datafel / Error</span>')}return}try{let o=[...dictionaryData];if(n!=="all"&&(o=o.filter(i=>i?(i[W]||"").toLowerCase().includes(n):!1)),o=o.filter(i=>i&&i[b]&&i[b].length>0),o.length===0){console.warn("No words found for filter:",n),typeof showToast=="function"&&showToast("Inga ord hittades fÃ¶r detta filter.","error");return}o.sort((i,m)=>{const y=d.getWordBox(String(i[M])),E=d.getWordBox(String(m[M]));return y-E}),p=o.sort(()=>.5-Math.random()).slice(0,50),c=0,g=0,l=p.length,u={correct:0,wrong:0,totalTime:0};const a=document.getElementById("flashcardsGame");a&&a.style.display!=="block"&&(a.style.display="block"),F(0),j();const s=document.getElementById("flashcardProgress");s&&(s.textContent=`0/${l}`);const r=document.getElementById("flashcard");r&&r.classList.remove("flipped"),q(),C(),U(),console.log("Flashcards initialized successfully with",l,"cards.")}catch(o){console.error("Critical error starting Flashcards:",o),typeof showToast=="function"&&showToast("Ett fel uppstod. / Ø­Ø¯Ø« Ø®Ø·Ø£.","error")}}function j(){const e=document.getElementById("fcSegmentedProgress");if(e){e.innerHTML="";for(let t=0;t<l;t++){const n=document.createElement("div");n.className="fc-progress-segment",n.id=`fc-seg-${t}`,e.appendChild(n)}}}function D(e,t){const n=document.getElementById(`fc-seg-${e}`);n&&(document.querySelectorAll(".fc-progress-segment").forEach(o=>o.classList.remove("active")),t?(n.classList.add("completed"),n.classList.add(t)):n.classList.add("active"))}function F(e){const t=document.querySelector(".fc-progress-ring-circle");if(!t)return;const n=2*Math.PI*45,o=n-e/100*n;t.style.strokeDashoffset=String(o)}function q(){const e=document.getElementById("flashcard");e&&(e.addEventListener("touchstart",t=>{x=t.changedTouches[0].screenX,T=x,B=Date.now()},{passive:!0}),e.addEventListener("touchmove",t=>{T=t.changedTouches[0].screenX;const n=T-x;Math.abs(n)>30&&(e.style.transform=`translateX(${n*.3}px) rotate(${n*.02}deg)`,e.style.opacity=String(Math.max(.5,1-Math.abs(n)/500)))},{passive:!0}),e.addEventListener("touchend",()=>{const t=T-x,n=Date.now()-B;e.style.transform="",e.style.opacity="",Math.abs(t)>100?(typeof HapticManager<"u"&&HapticManager.trigger("medium"),t>0?v(4):v(0)):Math.abs(t)<30&&n<500&&H()}),e.addEventListener("click",()=>{Date.now()-L<300||B>0&&Date.now()-B<500||H()}))}function H(){if(Date.now()-L<300)return;L=Date.now();const e=document.getElementById("flashcard");e&&(e.classList.toggle("flipped"),typeof HapticManager<"u"&&HapticManager.trigger("selection"),typeof SoundManager<"u"&&SoundManager.play("flip"))}function C(){if(c>=p.length){Q();return}const e=p[c],t=e[b]||"",n=e[N]||"",o=e[X]||"",a=e[W]||"",s=String(e[M]),r=d.getWordBox(s);k=Date.now(),D(c,null);const i=document.getElementById("flashcardWord");i&&(i.textContent=t,typeof TextSizeManager<"u"&&TextSizeManager.apply(i,t,"flashcard"));const m=document.getElementById("flashcardTranslation");m&&(m.textContent=n);const y=document.getElementById("flashcardMastery");y&&(y.innerHTML=`${d.getBoxIcon(r)} Box ${r}`);const E=document.getElementById("flashcardType");E&&(E.textContent=a);const I=document.getElementById("flashcard");I&&(r>=5?I.classList.add("shimmering"):I.classList.remove("shimmering"));const R=document.getElementById("flashcardBackWord");R&&(R.textContent=t);const w=document.getElementById("flashcardBackSentence");w&&(o?(w.textContent=o,w.style.display="block"):w.style.display="none");const $=e[z]||"",S=document.getElementById("flashcardExampleArb");S&&($?(S.textContent=$,S.style.display="block"):S.style.display="none");const G=c/l*100;F(G);const A=document.getElementById("flashcardProgress");A&&(A.textContent=`${c+1}/${l}`);const h=document.getElementById("flashcard");h&&(h.classList.remove("flipped"),h.classList.remove("swiping-left","swiping-right","slide-out-right","slide-out-left"),h.style.transform="",h.style.opacity=""),setTimeout(()=>{typeof TTSManager<"u"&&f&&TTSManager.speak(t,"sv")},500),setTimeout(Y,50)}function Y(){const e=document.querySelector(".fc-front-pro"),t=document.querySelector(".fc-back-pro"),n=document.getElementById("flashcard");if(!e||!t||!n)return;const o=e.scrollHeight,a=t.scrollHeight,s=Math.max(o,a,320);n.style.height=`${s}px`}function V(){f=!f,localStorage.setItem("fc_autoplay",String(f)),P(),typeof showToast=="function"&&showToast(f?"Auto-play: PÃ… ğŸ”Š":"Auto-play: AV ğŸ”‡")}function P(){const e=document.getElementById("fcAutoPlayToggle");e&&(e.textContent=f?"ğŸ”Š":"ğŸ”‡",e.classList.toggle("muted",!f))}function _(e,t){if(typeof showToast!="function")return;const o=[1,3,7,14,30][e-1]||1,a=t?`Bra! NÃ¤sta repetition om ${o} dagar (Box ${e})`:"Repetition imorgon (Box 1)";showToast(a)}function v(e){try{console.log("HandleRating CALLED with:",e),J(e)}catch(t){console.error("CRITICAL ERROR in handleFlashcardRating:",t)}}function J(e){const t=p[c];if(!t){console.error("No card found at index",c);return}const n=String(t[M]),o=Date.now()-k;if(u.totalTime+=o,e>=3){d.promoteWord(n),g++,u.correct++,typeof HapticManager<"u"&&HapticManager.trigger("success"),typeof SoundManager<"u"&&SoundManager.play("success"),D(c,"correct");const s=d.getWordBox(n);_(s,!0)}else d.demoteWord(n),u.wrong++,typeof HapticManager<"u"&&HapticManager.trigger("error"),typeof SoundManager<"u"&&SoundManager.play("error"),D(c,"wrong"),_(1,!1);if(e===0&&typeof FavoritesManager<"u"){const s=String(n);FavoritesManager.isFavorite(s)||FavoritesManager.toggle(s)}const a=document.getElementById("flashcard");if(a){const s=a.classList.contains("flipped");let r="";s?r=e>=3?"slide-out-right":"slide-out-left":r=e>=3?"slide-out-right-front":"slide-out-left-front",a.classList.add(r),setTimeout(()=>{a.classList.remove("slide-out-right","slide-out-left","slide-out-right-front","slide-out-left-front"),c++,C()},300)}else c++,C()}function Q(){const e=Math.round(g/l*100),t=Math.round(u.totalTime/l/1e3);e>=70&&(K(),typeof HapticManager<"u"&&HapticManager.trigger("success"),typeof SoundManager<"u"&&SoundManager.play("success"));const n=document.getElementById("flashcard");n&&(n.classList.remove("flipped"),n.onclick=null);const o=document.getElementById("flashcardWord");o&&(o.innerHTML=`
            <span style="font-size: 3rem;">${e>=80?"ğŸ†":e>=60?"ğŸ‘":"ğŸ’ª"}</span>
            <div style="font-size: 2.5rem; font-weight: 700; margin-top: 0.5rem;">${e}%</div>
        `);const a=document.getElementById("flashcardTranslation");a&&(a.innerHTML=`
            <div style="margin-bottom: 1rem;">Du kunde ${g} av ${l} ord!</div>
            <div style="display: flex; gap: 1rem; justify-content: center; font-size: 0.9rem;">
                <span>âœ… ${u.correct}</span>
                <span>âŒ ${u.wrong}</span>
                <span>â±ï¸ ${t}s/kort</span>
            </div>
        `);const s=document.getElementById("flashcardExample");s&&(s.innerHTML=`
            <div style="margin-top: 1rem; display: flex; gap: 0.5rem; justify-content: center;">
                <button onclick="initFlashcards()" class="fc-action-btn">ğŸ”„ Igen</button>
                <button onclick="showGameMenu()" class="fc-action-btn secondary">ğŸ  Meny</button>
            </div>
        `,s.style.display="block");const r=document.getElementById("flashcardRatingBtns");r&&(r.style.display="none"),F(100),typeof saveScore=="function"&&saveScore("flashcards",g),typeof updateGamesStats=="function"&&updateGamesStats(e>=70,g),Z()}function U(){const e=document.getElementById("flashcardsGame");e&&window.innerWidth<768&&e.classList.add("fullscreen-mode")}function Z(){const e=document.getElementById("flashcardsGame");e&&e.classList.remove("fullscreen-mode")}document.addEventListener("DOMContentLoaded",P);window.initFlashcards=O;window.handleFlashcardResult=v;window.handleFlashcardRating=v;window.LeitnerSystem=d;window.toggleAutoPlay=V;
