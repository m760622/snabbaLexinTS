const n={DEBUG_MODE:!1,DATA_VERSION:"2025.12.22.1",DB_NAME:"snabba-lexin-db",DB_VERSION:2,DATA_PATH:{root:"/data/data.json",games:"/data/data.json"},COLUMNS:{ID:0,TYPE:1,SWEDISH:2,ARABIC:3,ARABIC_EXT:4,DEFINITION:5,FORMS:6,EXAMPLE_SWE:7,EXAMPLE_ARB:8,IDIOM_SWE:9,IDIOM_ARB:10},SPLASH:{MIN_DISPLAY_TIME:2e3,TIP_ROTATION_INTERVAL:3e3},STORAGE_KEYS:{THEME:"theme",MOBILE_VIEW:"mobileView",FAVORITES:"favorites",WORD_ASSESSMENTS:"wordAssessments",SEARCH_HISTORY:"searchHistory"},LOADING_TIPS:["üí° Visste du? Du kan s√∂ka p√• b√•de svenska och arabiska!","üéÆ Prova v√•ra l√§randespel f√∂r att √∂va ordf√∂rr√•det!","‚≠ê Spara dina favoritord f√∂r snabb √•tkomst!","üîä Tryck p√• h√∂gtalarikonen f√∂r att h√∂ra uttalet!","üì± Installera appen f√∂r offline-anv√§ndning!","üåô ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä ŸÖÿ™ÿßÿ≠ ŸÅŸä ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™!","üìù ŸäŸÖŸÉŸÜŸÉ ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸÑŸÖÿßÿ™ŸÉ ÿßŸÑÿÆÿßÿµÿ©!"]},E={log:(...t)=>n.DEBUG_MODE&&console.log(...t),warn:(...t)=>n.DEBUG_MODE&&console.warn(...t),error:(...t)=>console.error(...t),info:(...t)=>n.DEBUG_MODE&&console.info(...t)};typeof window<"u"&&(window.AppConfig=n,window.Logger=E);const c={DB_NAME:n.DB_NAME,DB_VERSION:n.DB_VERSION,STORE_NAME:"words",META_STORE:"meta",db:null,isReady:!1,async init(){return this.db?!0:new Promise((t,s)=>{const r=indexedDB.open(this.DB_NAME,this.DB_VERSION);r.onerror=e=>{console.error("[DB] Error opening database:",e.target.error),s(e.target.error)},r.onsuccess=e=>{this.db=e.target.result,this.isReady=!0,console.log("[DB] Database opened successfully"),t(!0)},r.onupgradeneeded=e=>{const a=e.target.result;if(!a.objectStoreNames.contains(this.STORE_NAME)){const o=a.createObjectStore(this.STORE_NAME,{keyPath:"id"});o.createIndex("swedish","swe",{unique:!1}),o.createIndex("arabic","arb",{unique:!1}),o.createIndex("type","type",{unique:!1}),console.log("[DB] Words store created")}a.objectStoreNames.contains(this.META_STORE)||(a.createObjectStore(this.META_STORE,{keyPath:"key"}),console.log("[DB] Meta store created"))}})},async getDataVersion(){return this.db||await this.init(),this.db?new Promise(t=>{try{const e=this.db.transaction([this.META_STORE],"readonly").objectStore(this.META_STORE).get("dataVersion");e.onsuccess=()=>{var a;t(((a=e.result)==null?void 0:a.value)||null)},e.onerror=()=>t(null)}catch{t(null)}}):null},async setDataVersion(t){return this.db||await this.init(),this.db?new Promise((s,r)=>{const e=this.db.transaction([this.META_STORE],"readwrite");e.objectStore(this.META_STORE).put({key:"dataVersion",value:t}),e.oncomplete=()=>s(!0),e.onerror=o=>r(o)}):!1},async getWordCount(){return this.db||await this.init(),this.db?new Promise(t=>{try{const e=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).count();e.onsuccess=()=>t(e.result),e.onerror=()=>t(0)}catch{t(0)}}):0},async saveWords(t,s=null){this.db||await this.init();const r=1e3,e=Math.ceil(t.length/r);console.log(`[DB] Saving ${t.length} words in ${e} batches...`);for(let a=0;a<e;a++){const o=a*r,i=Math.min(o+r,t.length),d=t.slice(o,i);if(await this._saveBatch(d),s){const l=Math.round((a+1)/e*100);s(l)}}return console.log("[DB] All words saved successfully"),!0},async _saveBatch(t){return this.db?new Promise((s,r)=>{const e=this.db.transaction([this.STORE_NAME],"readwrite"),a=e.objectStore(this.STORE_NAME);t.forEach(o=>{const i={id:o[n.COLUMNS.ID],type:o[n.COLUMNS.TYPE],swe:o[n.COLUMNS.SWEDISH],arb:o[n.COLUMNS.ARABIC],arbExt:o[n.COLUMNS.ARABIC_EXT],sweDef:o[n.COLUMNS.DEFINITION],forms:o[n.COLUMNS.FORMS],sweEx:o[n.COLUMNS.EXAMPLE_SWE],arbEx:o[n.COLUMNS.EXAMPLE_ARB],idiomSwe:o[n.COLUMNS.IDIOM_SWE],idiomArb:o[n.COLUMNS.IDIOM_ARB],raw:o};a.put(i)}),e.oncomplete=()=>s(!0),e.onerror=o=>r(o)}):!1},async getAllWords(t=null){return this.db||await this.init(),this.db?new Promise((s,r)=>{const o=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).getAll();o.onsuccess=()=>{const i=o.result.map(d=>d.raw);t&&t(100),console.log(`[DB] Retrieved ${i.length} words from cache`),s(i)},o.onerror=i=>{console.error("[DB] Error getting words:",i),r(i)}}):[]},async hasCachedData(){return await this.getWordCount()>0},async clearCache(){return this.db||await this.init(),this.db?new Promise((t,s)=>{const r=this.db.transaction([this.STORE_NAME,this.META_STORE],"readwrite");r.objectStore(this.STORE_NAME).clear(),r.objectStore(this.META_STORE).clear(),r.oncomplete=()=>{console.log("[DB] Cache cleared"),t(!0)},r.onerror=e=>s(e)}):!1},async getWordById(t){return this.db||await this.init(),this.db?new Promise(s=>{try{const a=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).get(t);a.onsuccess=()=>{a.result&&a.result.raw?s(a.result.raw):s(null)},a.onerror=()=>s(null)}catch(r){console.error("[DB] getWordById error:",r),s(null)}}):null},async saveWord(t){return this.db||await this.init(),this.db?new Promise((s,r)=>{const e=this.db.transaction([this.STORE_NAME],"readwrite");e.objectStore(this.STORE_NAME).put(t),e.oncomplete=()=>s(!0),e.onerror=o=>r(o)}):!1},async deleteWord(t){return this.db||await this.init(),this.db?new Promise((s,r)=>{const e=this.db.transaction([this.STORE_NAME],"readwrite");e.objectStore(this.STORE_NAME).delete(t),e.oncomplete=()=>s(!0),e.onerror=o=>r(o)}):!1}},h={async loadDictionary(t=null,s=null){try{await c.init();const r=await c.getDataVersion();if(await c.hasCachedData()&&r===n.DATA_VERSION)return s&&s("Laddar fr√•n cache... / ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÜ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ©..."),console.log("[DataLoader] Using cached data (version:",r,")"),await c.getAllWords(t);s&&s("Laddar ordbok... / ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇÿßŸÖŸàÿ≥..."),console.log("[DataLoader] Loading fresh data from data.js");const a=window.dictionaryData;if(typeof a>"u"||!a.length)throw new Error("dictionaryData not loaded from data.js");return s&&s("Sparar i cache... / ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ≠ŸÅÿ∏..."),await c.saveWords(a,t),await c.setDataVersion(n.DATA_VERSION),console.log("[DataLoader] Data cached successfully"),a}catch(r){console.error("[DataLoader] Error:",r);const e=window.dictionaryData;if(typeof e<"u")return e;throw r}},async refreshCache(t=null){return await c.clearCache(),this.loadDictionary(t)}};typeof window<"u"&&(window.DictionaryDB=c,window.DataLoader=h,window.DATA_VERSION=n.DATA_VERSION);export{n as A,c as D};
