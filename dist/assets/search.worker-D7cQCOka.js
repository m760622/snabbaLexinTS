var X=Object.defineProperty;var q=(f,c,y)=>c in f?X(f,c,{enumerable:!0,configurable:!0,writable:!0,value:y}):f[c]=y;var j=(f,c,y)=>q(f,typeof c!="symbol"?c+"":c,y);(function(){"use strict";function f(n){if(!n)return"";let e=n.replace(/[\u064B-\u065F\u0670]/g,"");return e=e.replace(/[أإآ]/g,"ا"),e=e.replace(/ؤ/g,"و"),e=e.replace(/ئ/g,"ي"),e=e.replace(/ة/g,"ه"),e=e.replace(/ى/g,"ي"),e}class c{constructor(){j(this,"children",{});j(this,"wordIds",[])}}class y{constructor(){j(this,"root",new c)}insert(e,s){let t=this.root;const r=e.toLowerCase();for(const i of r)t.children[i]||(t.children[i]=new c),t=t.children[i],t.wordIds.length<50&&t.wordIds.push(s)}search(e){let s=this.root;const t=e.toLowerCase();for(const r of t){if(!s.children[r])return[];s=s.children[r]}return s.wordIds}}const v=new y;function R(n){if(!n||n.length<3)return n;let e=n.replace(/[ال|بال|وال|لل|ي|ت|ا|م|ون|ين|ات|ه|ة]/g,"");return e.length>3&&(e=e.substring(0,3)),e.length<3?n.substring(0,3):e}function L(n){if(!n)return"";let e=n.toLowerCase();return e=e.replace(/(sj|stj|skj|sch|sh|ch)/g,"X"),e=e.replace(/sk(?=[eiyäö])/g,"X"),e=e.replace(/(dj|gj|hj|lj|j)/g,"J"),e=e.replace(/g(?=[eiyäö])/g,"J"),e=e.replace(/ck/g,"K"),e=e.replace(/ph/g,"F"),e=e.replace(/th/g,"T"),e=e.replace(/wr/g,"R"),e=e.replace(/(.)\1+/g,"$1"),e}function x(n){const e=[n],s=n.toLowerCase();s.endsWith("er")||s.endsWith("ar")?e.push(s.slice(0,-2)):s.endsWith("ade")||s.endsWith("ede")?e.push(s.slice(0,-3)):(s.endsWith("te")||s.endsWith("de"))&&e.push(s.slice(0,-2)),s.endsWith("arna")||s.endsWith("erna")?e.push(s.slice(0,-4)):(s.endsWith("en")||s.endsWith("et"))&&e.push(s.slice(0,-2));const t=[...e];return e.forEach(r=>{r.length>2&&!r.endsWith("a")&&t.push(r+"a")}),Array.from(new Set(t))}function I(n,e){if(n.length===0)return e.length;if(e.length===0)return n.length;const s=[];for(let t=0;t<=e.length;t++)s[t]=[t];for(let t=0;t<=n.length;t++)s[0][t]=t;for(let t=1;t<=e.length;t++)for(let r=1;r<=n.length;r++)e.charAt(t-1)===n.charAt(r-1)?s[t][r]=s[t-1][r-1]:s[t][r]=Math.min(s[t-1][r-1]+1,s[t][r-1]+1,s[t-1][r]+1);return s[e.length][n.length]}let p=[];self.onmessage=n=>{try{const{type:e,payload:s}=n.data;if(e==="INIT_DATA"){const t=s;self.dictionaryData=t,console.log("[SearchWorker] Building optimized index and Trie for "+t.length+" words"),p=new Array(t.length);for(let r=0;r<t.length;r++){const i=(t[r][2]||"").toLowerCase(),u=f(t[r][3]||"").toLowerCase();p[r]={s:i,a:u,ps:L(i),ar:R(u)},i&&v.insert(i,r)}self.postMessage({type:"DATA_LOADED"})}else if(e==="SEARCH"){const{options:t,favIds:r}=s,i=self.dictionaryData||[];if(i.length===0){self.postMessage({type:"SEARCH_RESULT",payload:{results:[],stats:{total:0,types:{}}}});return}if(!p||p.length!==i.length){p=new Array(i.length);for(let l=0;l<i.length;l++){const g=(i[l][2]||"").toLowerCase(),a=f(i[l][3]||"").toLowerCase();p[l]={s:g,a,ps:L(g),ar:R(a)}}}const u=_(i,t,r);self.postMessage({type:"SEARCH_RESULT",payload:u})}}catch(e){console.error("Worker Search Error:",e),self.postMessage({type:"ERROR",payload:e.message})}};function D(n,e){let s=0;const t=n,r=e.s,i=e.a,u=e.ps,l=e.ar;if(r===t||i===t?s+=1e3:r.startsWith(t)||i.startsWith(t)?s+=500:r.includes(" "+t)||i.includes(" "+t)?s+=300:t.match(/[أ-ي]/)&&t.length===3&&l===t?s+=200:(r.includes(t)||i.includes(t))&&(s+=100),s<300&&!t.match(/[أ-ي]/)){const g=L(t);u===g?s=Math.max(s,250):u.startsWith(g)&&(s=Math.max(s,150))}return s-=r.length*2,s}function _(n,e,s){const{query:t,mode:r,type:i,sort:u}=e,l=f(t.trim().toLowerCase()),g=l?x(l):[],a={total:0,types:{}},z=r==="favorites"||i!=="all",T=!!l,C=r==="favorites"?new Set(s):null;let W=[];const U=n.length;for(let o=0;o<U;o++){const w=n[o],b=p[o];if(C&&!C.has(w[0].toString()))continue;let d=0;if(T){if(d=D(l,b),d<500){for(const S of g)if(b.s===S||b.s.startsWith(S)){d=Math.max(d,400);break}}d<=0&&l.length>3&&I(l,b.s)<=1&&(d=50)}else d=1;if(d<=0)continue;const h=(w[1]||"").toLowerCase(),k=h.includes("subst")||h==="noun",E=h.includes("verb"),M=h.includes("adj");if(k&&(a.types.subst=(a.types.subst||0)+1),E&&(a.types.verb=(a.types.verb||0)+1),M&&(a.types.adj=(a.types.adj||0)+1),(h.includes("fras")||h.includes("uttin")||h.includes("idiom"))&&(a.types.fras=(a.types.fras||0)+1),!(!T&&!z)){if(i!=="all"){const S=Array.isArray(i)?i:[i];let A=!1;for(const m of S){if(m==="subst"&&k){A=!0;break}if(m==="verb"&&E){A=!0;break}if(m==="adj"&&M){A=!0;break}if(m==="fras"&&(h.includes("fras")||h.includes("uttin")||h.includes("idiom"))){A=!0;break}}if(!A)continue}W.push({row:w,score:d})}}return a.total=W.length,W.sort((o,w)=>w.score-o.score),{results:W.slice(0,500).map(o=>({id:o.row[0],type:o.row[1],swedish:o.row[2],arabic:o.row[3],forms:o.row[6],definition:o.row[5],example:o.row[7],gender:o.row[13],score:o.score})),stats:a}}})();
