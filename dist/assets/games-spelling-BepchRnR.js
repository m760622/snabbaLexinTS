import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              *//* empty css              */import"./loader-B7oZEySq.js";import{s as m,a as I}from"./games-utils-CgPy3Odt.js";import{A as n}from"./config-CfHoVMbv.js";import{generateEducationalSentence as B}from"./utils-DkwAXeNx.js";import{T as g}from"./tts-BuOrQ7kI.js";import"./db-bEbbjtoI.js";import"./i18n-1qhfGv7S.js";import"./toast-manager-CZ3snF2j.js";console.log("spellingGame.ts LOADED");let l=null,M=0,d=0;function h(i=0){if(typeof dictionaryData>"u"||dictionaryData.length===0){console.log("Data not ready for Spelling. Waiting for dictionaryLoaded event...");const t=()=>{console.log("dictionaryLoaded event received in Spelling Game"),window.removeEventListener("dictionaryLoaded",t),h(0)};window.addEventListener("dictionaryLoaded",t),i<20?setTimeout(()=>{(typeof dictionaryData>"u"||dictionaryData.length===0)&&h(i+1)},500):(console.error("Critical: Data failed to load for Spelling."),typeof m=="function"&&m("Kunde inte ladda data. Uppdatera sidan. / ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.","error"));return}M=0,d=0,C(),w()}function C(){const i=document.getElementById("spellingScore"),t=document.getElementById("spellingStreak");i&&(i.textContent=String(M)),t&&(t.textContent=String(d))}function w(){const i=document.getElementById("spellingHint"),t=document.getElementById("spellingExample"),o=document.getElementById("spellingOptions"),a=document.getElementById("spellingFeedback"),u=document.getElementById("nextSpellingBtn"),S=document.getElementById("spHintBtn");if(!i||!o||!a)return;a.innerHTML="",a.className="sp-feedback",u&&u.classList.add("hidden"),S&&S.classList.remove("hidden"),o.innerHTML='<div class="sp-loading"><div class="sp-loading-spinner"></div><span>Laddar...</span></div>';let s=null,y=0;for(;!s&&y<200;){const e=dictionaryData[Math.floor(Math.random()*dictionaryData.length)];e&&e[n.COLUMNS.SWEDISH]&&e[n.COLUMNS.ARABIC]&&e[n.COLUMNS.SWEDISH].length>2&&e[n.COLUMNS.SWEDISH].length<15&&(s=e),y++}if(!s){i.textContent="Kunde inte hitta ett ord. FÃ¶rsÃ¶k igen.",t&&(t.textContent=""),o.innerHTML='<button class="spelling-option-btn" onclick="loadSpellingQuestion()">FÃ¶rsÃ¶k igen</button>';return}l=s;const r=s[n.COLUMNS.SWEDISH],L=s[n.COLUMNS.ARABIC];i.textContent=L,t&&(t.textContent="");const c=[r];let E=0;for(;c.length<4&&E<100;){const e=dictionaryData[Math.floor(Math.random()*dictionaryData.length)];e&&e[n.COLUMNS.SWEDISH]&&e[n.COLUMNS.SWEDISH]!==r&&!c.includes(e[n.COLUMNS.SWEDISH])&&e[n.COLUMNS.SWEDISH].length>2&&c.push(e[n.COLUMNS.SWEDISH]),E++}c.sort(()=>Math.random()-.5),setTimeout(()=>{o.innerHTML="",c.forEach((e,D)=>{const f=document.createElement("button");f.className="spelling-option-btn",f.textContent=e,f.style.animationDelay=`${D*.1}s`,f.onclick=()=>{typeof soundManager<"u"&&(soundManager!=null&&soundManager.playClick)&&soundManager.playClick(),H(e,r,f)},o.appendChild(f)})},300);const p=document.getElementById("spSpeakHint");p&&(p.onclick=()=>{typeof g<"u"&&g&&g.speak(r,"sv")})}function H(i,t,o){const a=document.getElementById("spellingFeedback"),u=document.getElementById("nextSpellingBtn"),S=document.getElementById("spHintBtn"),s=document.querySelectorAll(".spelling-option-btn");if(!a||!l)return;s.forEach(e=>e.disabled=!0),S&&S.classList.add("hidden");const y=l[n.COLUMNS.ARABIC]||"",r=l[n.COLUMNS.EXAMPLE_SWE]||"",L=l[n.COLUMNS.EXAMPLE_ARB]||"",c=l[n.COLUMNS.DEFINITION]||"",E=l[n.COLUMNS.TYPE]||"ord";let p="";if(typeof B=="function"){const e=B(t,y,r,L,c,E);p+=`<div class="sp-example-sentence">
            <div class="sp-sentence-swe">ðŸ“– ${e.s}</div>
            <div class="sp-sentence-arb calc-text-size">${e.a}</div>
        </div>`}i===t?(o.classList.add("correct"),M++,d++,C(),typeof HapticManager<"u"&&HapticManager?HapticManager.trigger("success"):navigator.vibrate&&navigator.vibrate([50,30,50]),typeof soundManager<"u"&&(soundManager!=null&&soundManager.playSuccess)&&soundManager.playSuccess(),a.innerHTML=p,a.className="sp-feedback success",window.TextSizeManager&&window.TextSizeManager.applyRules(),typeof I=="function"&&I("spelling",M),d>=3&&d%3===0&&typeof m=="function"&&m(`ðŸ”¥ ${d} i rad! / ${d} Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØ§Ù„ÙŠ!`,"success")):(o.classList.add("wrong"),s.forEach(e=>{e.textContent===t&&setTimeout(()=>e.classList.add("correct"),300)}),a.innerHTML=p,a.className="sp-feedback",d=0,C(),typeof soundManager<"u"&&(soundManager!=null&&soundManager.playError)&&soundManager.playError()),typeof g<"u"&&g&&g.speak(t,"sv"),u&&u.classList.remove("hidden")}function v(){if(!l)return;const t=l[n.COLUMNS.SWEDISH].charAt(0).toUpperCase();typeof m=="function"&&m(`ðŸ’¡ FÃ¶rsta bokstaven: ${t}`,"info");const o=document.getElementById("spHintBtn");o&&(o.disabled=!0,o.style.opacity="0.5")}window.startSpellingGame=h;window.showSpellingHint=v;window.loadSpellingQuestion=w;
